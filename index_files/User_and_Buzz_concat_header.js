BF_ShareEmail=function(){this.ERR_MESS=local.t("Please enter two email addresses.");this.current_button=null;this.from_email="";this.vertical="";this.init=function(){shareEmail.current_button=null;shareEmail.assign_handlers();shareEmail.draw_catcha()};this.assign_handlers=function(){universal_dom.assign_handler({bucket:"share-email-submit",handler:shareEmail.submit,event:"click"});universal_dom.assign_handler({bucket:"share-email-cancel",handler:shareEmail.hide_email_form,event:"click"});universal_dom.assign_handler({bucket:"newsletter_checkbox",handler:shareEmail.newsletter_checkbox,event:"click"});universal_dom.assign_handler({bucket:"email-signup",handler:shareEmail.email_signup,event:"click"});Element.observe(window,"resize",shareEmail.move_to_visible_area)};this.move_to_visible_area=function(){if($("share_email")&&$("share_email").visible()){var share_box=$("share_email").up(".share-box"),share_tools_list=$("share_email").up(".share_tools_list"),inline_shares_box=$("share_email").up("#inline_shares_box"),parent=share_box||share_tools_list||inline_shares_box;if(typeof(parent)!="undefined"){var sub_buzz_email_share=parent.select(".sub-buzz-email-share"),share_icon=parent.select(".mail .share-icon"),email_button=sub_buzz_email_share.length?sub_buzz_email_share:share_icon,inline_email_button=parent.select(".email_icon.inlineShareBtn");if(email_button.length){if($("share_email").up(".buzz_superlist_item_update")){$("share_email").addClassName("top-arrow");var left_offset=(email_button[0].offsetLeft+email_button[0].getWidth()/2)-($("share_email").getWidth()/2);$("share_email").setStyle({left:left_offset+"px"});$("share_email").setStyle({top:50+"px"})}else{var top_offset=(email_button[0].offsetTop+email_button[0].getHeight()/2)-($("share_email").getHeight()/2);$("share_email").setStyle({left:65+"px"});$("share_email").setStyle({top:top_offset+"px"})}}else{if(inline_email_button){var top_offset=(inline_email_button[0].offsetTop+inline_email_button[0].getHeight()/2)-($("share_email").getHeight()/2);$("share_email").setStyle({left:77+"px"});$("share_email").setStyle({top:top_offset+"px"})}}}else{var share_email_offset=$("share_email").viewportOffset();if(share_email_offset.left<=0){if(!$("share_email").getAttribute("data:originOffset")){$("share_email_form").addClassName("hide-arrow");$("share_email").setAttribute("data:originOffset",$("share_email").offsetLeft)}$("share_email").setStyle({left:($("share_email").offsetLeft-share_email_offset.left)+"px"})}else{if($("share_email").getAttribute("data:originOffset")){if(($("share_email").offsetLeft-share_email_offset.left)>=$("share_email").getAttribute("data:originOffset")){$("share_email").setStyle({left:($("share_email").offsetLeft-share_email_offset.left)+"px"})}else{$("share_email_form").removeClassName("hide-arrow");$("share_email").setStyle({left:$("share_email").getAttribute("data:originOffset")+"px"});$("share_email").removeAttribute("data:originOffset")}}}}}};this.hide_email_form=function(){shareEmail.current_button=null;$("share_email").hide();if(typeof bf_rdio!="undefined"){bf_rdio.enable()}if(typeof bpage!="undefined"){bpage.hide_all_popups()}};this.locate_form_and_share_email=function(target,buzz_id,no_scroll){$("share_email").removeAttribute("data:originOffset");$("share_email_form").removeClassName("hide-arrow");$("newsletter_signup_form").hide();$("share_email_error").hide();$("share_email_confirm").hide();$("share_email_form").show();var emailBoxPos={top:0,left:0};if(shareEmail.current_button==target){shareEmail.hide_email_form();return false}else{shareEmail.current_button=target}var is_inline_share=target.ancestors().indexOf($("inline_shares_box"))>=0;var is_subbuzz_share=target.hasClassName("sub-buzz-email-share");var btn={left:Number($(target).offsetLeft),top:Number($(target).offsetTop),height:Number($(target).getHeight()),width:Number($(target).getWidth())};$("share_email_form").reset();if(BF_STATIC.tt_page=="Videos"&&"videopromo" in window&&videopromo!="undefined"&&videopromo.buzz_id){$("bid").value=parseInt(videopromo.buzz_id)}else{buzz_id=buzz_id.split("_");$("bid").value=buzz_id[0]}if(typeof bf_rdio!="undefined"){bf_rdio.disable()}$("share_email").show();$("share_email_form").addClassName("share-email-form");$("share_email").setOpacity(1);$("share_email_message").hide();if($("share_email_submit")){$("share_email_submit").removeAttribute("disabled")}$(target).insert({after:$("share_email")});arrow={height:is_inline_share?20:10,width:is_inline_share?20:10};var box={width:$("share_email").getWidth(),height:$("share_email").getHeight()};if(is_inline_share){emailBoxPos.top=btn.top-parseInt(box.height/2)+parseInt(btn.height/2);emailBoxPos.left=btn.left+btn.width+parseInt(arrow.width)}else{if(is_subbuzz_share){emailBoxPos.top=btn.top+btn.height+parseInt(arrow.height/2);emailBoxPos.left=btn.left-parseInt(box.width/2,10)}else{emailBoxPos.top=btn.top+btn.height+parseInt(arrow.height/2);emailBoxPos.left=btn.left-parseInt(box.width/2,10)+parseInt(btn.width/2,10)}}$("share_email").setStyle({left:emailBoxPos.left+"px",top:emailBoxPos.top+"px"});shareEmail.move_to_visible_area();if(!no_scroll){BF_Effect.ScrollIntoView("share_email")}};this.newsletter_checkbox=function(obj){if(obj.id){$(obj.id).toggleClassName("checkOff");$(obj.id).toggleClassName("checkOn");var cat=gtrack.findCatLabel(obj.id);var act=$(obj.id)[bfjs.read_attr](bfjs.gtrack_act);gtrack.track_events(cat,act+"/"+($(obj.id).hasClassName("checkOff")?"uncheck":"check"),"(no label)")}};this.email_signup=function(){var categories=[];if(shareEmail.from_email==""){return false}var email=shareEmail.from_email;$$("#newsletter_signup_form .checkBox.checkOn").each(function(el){var cat=$(el).getAttribute("id").replace("_signup","");categories.push(cat)});if(!categories.length){if($("email_sent_success_message")){$("email_sent_success_message").hide()}if($("empty_sign_up_message")){$("empty_sign_up_message").removeClassName("hidden")}return}else{if($("empty_sign_up_message")){$("empty_sign_up_message").addClassName("hidden")}}$("email_signup").setAttribute("disabled","disabled");shareEmail.move_to_visible_area();new Ajax.Request("/buzzfeed/_email/",{method:"get",parameters:{email:email,category:categories},onSuccess:function(transport){if($("email_sent_success_message")){$("email_sent_success_message").removeClassName("hidden")}if(transport.responseText.match(/Email added/)){shareEmail.confirm_message("Great! You'll get your first email soon.")}else{shareEmail.fail_message("Sorry! We weren't able to sign you up.")}$("email_signup").removeAttribute("disabled");shareEmail.move_to_visible_area()},onFailure:function(transport){if(BF_STATIC.bf_env=="dev"&&transport.responseText){shareEmail.fail_message(transport.responseText)}else{shareEmail.fail_message("Sorry! We weren't able to sign you up.")}$("email_signup").removeAttribute("disabled");shareEmail.move_to_visible_area()}})};this.submit=function(obj){if(obj.vertical){shareEmail.vertical=obj.vertical}if(shareEmail.validate()){$("share_email_submit").setAttribute("disabled","disabled");shareEmail.move_to_visible_area();var params={};params.bf=$F("bf").strip();params.b2=$F("b2").strip();params.note=$F("note").strip();params.bid=$F("bid");params.sub_buzz_id=$F("sub_buzz_id");if($("hash_tag")){params.hash_tag=$F("hash_tag")}if(typeof BF_STATIC.pound_enabled!="undefined"&&BF_STATIC.pound_enabled&&!BF_STATIC.mobile_app){params.tracking_url=pound.urls.unescaped.queryStringOnly()}(new BF_Request()).request("/buzzfeed/share_email",{method:"post",parameters:params,onSuccess:function(resp){$("share_email_submit").removeAttribute("disabled");shareEmail.share_submit_success(resp);shareEmail.move_to_visible_area()},onFailure:function(resp){$("share_email_submit").removeAttribute("disabled");shareEmail.fail(resp);shareEmail.move_to_visible_area()},onCatcha:function(resp){$("share_email_submit").removeAttribute("disabled");$("share_email_message").className="message error";$("share_email_message").innerHTML="Please enter the correct Cat-cha answer.";$("share_email_message").show();shareEmail.move_to_visible_area()}});(new BF_Targetting_Pixel()).add("email");gtrack.trackShares(22,"numSharesEmail");var gtrack_cat_label=gtrack.findCatLabel($("share_email_submit"));gtrack.track_events((gtrack_cat_label?gtrack_cat_label:""),"share/email/send","")}};this.share_submit_success=function(resp){var obj=eval("("+resp.responseText+")");obj.sent=obj.sent==true||obj.sent=="true";if(obj&&obj.sent&&obj.sent==true){if(tracker){tracker.add({type:tracker.types.SHARE_EMAIL});tracker.run()}if($("bf")){$("bf").value=""}if($("b2")){$("b2").value=""}if($("note")){$("note").value=""}if($("sub_buzz_id")){$("sub_buzz_id").value=""}if(obj.from_email){if($("newsletter_signup_form")){$("newsletter_signup_form").addClassName("share-email-form")}if($("from_address")){$("from_address").innerHTML=obj.from_email}shareEmail.from_email=obj.from_email;if($("newsletter_signup_form")){$("newsletter_signup_form").show()}if($("empty_sign_up_message")){$("empty_sign_up_message").addClassName("hidden")}if($("email_sent_success_message")){$("email_sent_success_message").show()}if($("share_email_form")){$("share_email_form").hide()}}else{BF_Effect.FadeOut("share_email",50)}shareEmail.move_to_visible_area()}else{shareEmail.fail(resp)}};this.fail=function(resp){try{var obj=eval("("+resp.responseText+")");if(obj&&obj.error&&obj.message&&(obj.error=="blacklist"||obj.error=="spam")){shareEmail.fail_message(obj.message)}}catch(e){console.log(e)}};this.fail_message=function(message){$("share_email_error_text").update(message);console.log("share email failure: "+message);$("share_email_submit").removeAttribute("disabled");$("share_email_form").hide();$("newsletter_signup_form").hide();$("share_email_error").show();shareEmail.move_to_visible_area()};this.confirm_message=function(message){$("share_email_confirm_text").update(message);console.log("share email confirm: "+message);$("share_email_submit").removeAttribute("disabled");$("share_email_form").hide();$("newsletter_signup_form").hide();$("share_email_error").hide();$("share_email_confirm").show();shareEmail.move_to_visible_area()};this.validate=function(){var status=true;$("share_email_message").hide();if($F("bf").strip()==""||$F("b2").strip()==""){$("share_email_message").className="message error";$("share_email_message").innerHTML=shareEmail.ERR_MESS;$("share_email_message").show();status=false}shareEmail.move_to_visible_area();return status};this.draw_catcha=function(){if(BFW_Util.getCookie("catcha-email_a_friend")){universal_dom.get_bucket_elements("catcha-email_a_friend").each(function(el){el.show();bf_catcha.set_image_and_question({service:"email_a_friend",image_element:el.getElementsByTagName("IMG")[0],question_element:el.getElementsByTagName("SPAN")[0]})})}}};shareEmail=new BF_ShareEmail();BuzzLoader.register(function(){shareEmail.init()},1);var BF_HashTrack=function(){this.TYPE_FN={turn:function(a){hashtrack.ping(a)},google:function(a){hashtrack.google(a)}};this.google_regex=new RegExp("/([^/]*)/([^/]*)(?:#|\\?.*fb_ref=)(H[^0-9]+)([0-9]+)??$","i");this.redir_regex=new RegExp("/ht/([^/]*)/([^/]*)/(H[^0-9]+)([0-9]+)??$","i");this.primary_regex=new RegExp("/([^/]*)/([^/]*)(?:#|\\?.*fb_ref=)(H[^0-9]+)1??$","i");this.hashtrack2_regex=new RegExp("/h2/([a-z0-9]+)/([^/]+)/([^/]+)","i");this.tracked_params=false;this.init=function(){this.oldschool_hashtrack=window.location.href.match(hashtrack.hashtrack2_regex)?false:true;var a=hashtrack.hash_tag(window.location.href);if(a){a=a.toUpperCase();var c=unescape(bfjs.read_cookie("HT_PRIMARY"));var b=2;if(c&&c.split(",").length>3){b=hashtrack._process_cookie(c,a)}else{if(hashtrack.redir_regex.test(document.referrer)||hashtrack.primary_regex.test(window.location.href)){b=1;hashtrack._process_without_cookie()}}if(b==0){return}if(a&&!("hash_track" in window)){var f=window.location.href.match(hashtrack.google_regex);if(f&&f.length==5){hashtrack.setup_google({user:f[1],uri:f[2],code:f[3].toUpperCase(),number:b})}}if(a&&!("hash_track" in window)){var e=window.location.href.match(hashtrack.hashtrack2_regex);if(e&&e.length==4){hashtrack.setup_google({user:e[2],uri:e[3],code:e[1].toUpperCase(),number:b})}}if(this.oldschool_hashtrack){a=a.replace(/\d$/,b)}else{a+=b}if(!bfjs.isMobile()){(new BF_Targetting_Pixel()).hashtrack_pixel(window.location.toString(),b)}}if(a&&typeof hash_track!="undefined"&&typeof hash_track[a]!="undefined"){var d=hashtrack.TYPE_FN[hash_track[a].type||"turn"];if(typeof d!="undefined"){var g=hash_track[a].conversion;d(g.id);if(!a.toUpperCase().match(/^H/)){a="H"+a}hashtrack.track(a);hashtrack.tracked_hash_tag=a;if(this.oldschool_hashtrack){bfjs.onPageLoad(function(){try{hashtrack.do_rewrites(a.replace(/1$/,2))}catch(h){console.error(h)}})}}}else{if(this.oldschool_hashtrack){bfjs.onPageLoad(this.fixup_share_buttons)}}};this._process_without_cookie=function(){var b=hashtrack.google_regex.exec(document.location.href);var a={user:b[1],uri:b[2],code:b[3].toUpperCase()};if(a.code.match(/^H.*/)){window.IS_HASH_WIDGET_CLICK=true}};this._process_cookie=function(f,h){var a=f.split(",");var g=a.shift();var l=a.shift();var b=a.shift();var c=new RegExp(".*/"+l+"/"+b+".*");var k=a.shift();var j=a.join(",");var e=2;var d=this.oldschool_hashtrack?"2":"";if(k&&c.exec(document.location.href)&&(k+d)==h){if(g=="UNCOUNTED"){e=1}window.IS_HASH_WIDGET_CLICK=true;if(j){window.HASH_REFER=j}bfjs.write_cookie("HT_PRIMARY",["COUNTED",l,b,k,j].join(","),600)}return e};this.setup_google=function(c){var a=c.code+c.number;var b=["_ga","hashtrack",c.user,c.uri,c.code,c.number];hash_track={};hash_track[a]={type:"google",conversion:{id:"/"+b.join("/")}}};this.hash_tag=function(a){return hashtrack.parse_hash_tag(a)};this.parse_hash_tag=function(b){var a=undefined;if(b.indexOf("/h2/")){var c=b.match("/h2/([^/]+)");if(c&&c.length>0){a=c[1]}}if(!a&&b.indexOf("#")+1>0){var c=b.substring(b.indexOf("#")+1);if(c.length>0){a=c}}if(!a&&b.indexOf("?")>-1){var d=bfjs.isMobile()?hashtrack._params_unserialize(b):b.toQueryParams();if(d.fb_ref){a=d.fb_ref}}if(!!a&&a.indexOf("?")>-1){a=a.substr(0,a.indexOf("?"))}return a};this.regex=new RegExp("(/[^/]+/[^/]+$)");this.do_rewrites=function(a,e){var b=window.location.href,f=!!e?e.getElementsByTagName("fb:like"):document.getElementsByTagName("fb:like");if(f.length==0){f=!!e?e.getElementsByTagName("like"):document.getElementsByTagName("like")}for(var c=0;c<f.length;c++){f[c].setAttribute("ref",a);hashtrack._swap_node(f[c])}var d=!!e?e.getElementsByTagName("A"):document.getElementsByTagName("A");for(var c=0;c<d.length;c++){if(d[c].className.match(/twitter-share-button/)){var b=d[c].getAttribute("data-url");if(!b||b==""){b=window.location.href}d[c].setAttribute("data-url",b+"#"+a);d[c].setAttribute("data-counturl",b);hashtrack._swap_node(d[c])}}var h=!!e?e.getElementsByTagName("IFRAME"):document.body.getElementsByTagName("IFRAME");for(var c=0;c<h.length;c++){if(!!h[c].getAttribute("bf_src")){var b=hashtrack._get_hashtrack_share_url(h[c],a);hashtrack._swap_node(h[c],"src",b)}}var b=window.location.href,f=!!e?e.getElementsByTagName("g:plusone"):document.getElementsByTagName("g:plusone");if(f.length==0){f=!!e?e.getElementsByTagName("plusone"):document.getElementsByTagName("plusone")}for(var c=0;c<f.length;c++){f[c].setAttribute("href",hashtrack._add_hashtrack_to_url(f[c].getAttribute("href"),a));hashtrack._swap_node(f[c])}if($("share_email_form")){var g=new Element("input",{type:"hidden",value:a,name:"hash_tag",id:"hash_tag"});$("share_email_form").appendChild(g)}};this._swap_node=function(c,d,b){var a=c.cloneNode(true);if(b){a.setAttribute(d,b)}c.parentNode.replaceChild(a,c)};this._params_unserialize=function(f){var c={},b=f.replace(/^\?/,"").split("&"),a=b.length,d=0,e;for(;d<a;d++){if(!b[d]){continue}e=b[d].split("=");c[e[0]]=e[1]}return c},this._get_hashtrack_share_url=function(d,a){var c=d.getAttribute("bf_src");var b=c.indexOf("?")+1;var f=c.substring(b);var e=bfjs.isMobile()?hashtrack._params_unserialize(f):f.toQueryParams();if(typeof e.url!="undefined"){e.url=hashtrack._add_hashtrack_to_url(e.url,a);c=c.replace(f,$H(e).toQueryString())}return c};this._add_hashtrack_to_url=function(d,b){var c=new RegExp("(/[^/]+/[^/]+$)");var a=d.match(c);d=d.replace(c,"/ht"+a[0]+"/"+b);return d};this.fixup_share_buttons=function(d){var e=!!d&&typeof d=="object"?d.getElementsByTagName("fb:like"):document.getElementsByTagName("fb:like");for(var c=0;c<e.length;c++){var h=document.createElement("fb:like");var a=e[c].attributes;for(var b=0;b<a.length;b++){h.setAttribute(a[b].name,a[b].value)}e[c].parentNode.replaceChild(h,e[c])}var f=!!d&&typeof d=="object"?d.getElementsByTagName("IFRAME"):document.getElementsByTagName("IFRAME");for(var c=0;c<f.length;c++){if(!!f[c].getAttribute("bf_src")){var g=f[c].cloneNode(true);g.setAttribute("src",f[c].getAttribute("bf_src"));f[c].parentNode.replaceChild(g,f[c])}}};this.ping=function(b){var a="&";if(b.indexOf("?")==-1){a="?"}a+="rnd="+(new Date()).getTime();(new Image()).src=b+a};this.track=function(g){var b=document.createElement("img");var a,f;if(bfjs.isMobile()){a=$("#buzz")[bfjs.read_attr]("data-buzz-id");f=$("#buzz")[bfjs.read_attr]("data-user-id")}else{a=$$("head meta[property=bf:buzzid]");f=$$("head meta[property=bf:userid]");if(a){a=a.first().getAttribute("content")}if(f){f=f.first().getAttribute("content")}}if(a&&f){try{var d={buzzid:a,userid:f,hp:g,referrer:(typeof window.HASH_REFER!="undefined")?window.HASH_REFER:document.referrer,z:(new Date).getTime()};hashtrack.tracked_params=d;(new Image()).src="http://"+(Cloud.servers[Math.floor(Math.random()*Cloud.servers.length)])+"/hp.gif?"+(bfjs.isMobile()?$.param(d):Object.toQueryString(d));if(Cloud.staging.sample>0&&(Math.random()<=Cloud.staging.sample)){(new Image()).src="http://"+Cloud.staging.server+"/hp.gif?"+(bfjs.isMobile()?$.param(d):Object.toQueryString(d))}}catch(c){console.error(c)}}};this.google=function(b,a){return}};var hashtrack=new BF_HashTrack();var BF_ANNOUNCEMENT={announcement:false,cookie_name:"bf_announce",set:function(c,b,a){if(typeof(a)=="undefined"){a={}}if(!a.close){a.close=false}BF_ANNOUNCEMENT.announcement={id:c,text:b,close:(close?true:false)};if(BF_ANNOUNCEMENT._get_cookie(BF_ANNOUNCEMENT.cookie_name)!=BF_ANNOUNCEMENT.announcement.id){document.write('<div id="bar_announcement"><div id="bar_announcement_area" class="c">'+(a.close?'<a id="announcement_close" class="close" href="javascript:;">'+a.close.text+"</a>":"")+"<p>"+b+"</p></div></div>");if(a.close){$("announcement_close").observe("click",function(d){if(a.close.handler){try{a.close.handler(d)}catch(d){}}else{}return false})}if($$(".react")){$$(".react").each(function(e,d){e.observe("click",function(g){var f=g.target.getAttribute("rel:reaction");if(typeof f!="undefined"){BF_ANNOUNCEMENT.react(f)}})})}if($("feedback_email")){$("feedback_email").observe("click",function(d){gtrack.track_events(BF_ANNOUNCEMENT.announcement.id+":announcement_bar","feedback/email","")})}}},react:function(a){gtrack.track_events(BF_ANNOUNCEMENT.announcement.id+":announcement_bar","feedback/"+a,"");$("announcement_bar_react").hide();$("announcement_bar_thanks").show()},close:function(a){var b=BF_ANNOUNCEMENT.announcement.expires;if(!b){b=2592000000}BF_ANNOUNCEMENT._set_cookie(BF_ANNOUNCEMENT.cookie_name,BF_ANNOUNCEMENT.announcement.id);$("bar_announcement").hide()},_get_cookie:function(b){if(BF_ANNOUNCEMENT._has_cookie(b)){var a=document.cookie.match("(^|;) ?"+b+"=([^;]*)(;|$)");return unescape(a[2])}else{return false}},_has_cookie:function(c,a){var b=document.cookie.match("(^|;) ?"+c+"=([^;]*)(;|$)");if(a&&typeof(a)=="string"){a=RegExp(RegExp.escape(a))}return(b?(a&&a!=""?unescape(b[2]).match(a):(b[2]!=this.cookies_cancel)):false)},_set_cookie:function(l,b,g,f){var c=31536000000,a="",k="";if(g||g==0){c=parseInt(g)}if(c!=0){var j=new Date();j.setTime(j.getTime()+c);a="; expires="+j.toGMTString()}k=escape(l)+"="+escape(b)+a+"; path=/; domain=."+(f?escape(f):"buzzfeed.com");document.cookie=k}};var BF_Quiz=function(){this.quizes={};this.answerResponse="#{a} is the correct answer.";this.pollHost="http://"+BF_STATIC.mango_host;this.pollUrl=this.pollHost+"/polls/service/";this.cookiePrefix="poll_result_sent_";this.messages={generic:{tally:"You got #{x} out of #{y} right!",fb:"I got #{score} out of #{total}! How do you measure up?",tw:"I got #{score} out of #{total} on #{title}!",pin:"I got #{score} out of #{total} on #{title}!",tumblr:"I got #{score} out of #{total} on #{title}!",email_subject:"#{title}",email_body:"I got #{score} out of #{total}! \n\n #{link}"},personality:{fb:local.t("I got #{result}! #{title}"),tw:local.t("I got #{result}! #{title}"),pin:local.t("I got #{result}! #{title}"),tumblr:local.t("I got #{result}! #{title}"),email_body:local.t("I got #{result}!\n\n#{link}")},checklist:{tally:local.t("You#{result_verb} #{checked} out of #{total}#{result_subject}"),fb:local.t("I#{result_verb} #{checked} out of #{total}#{result_subject} #{title}"),tw:local.t("I#{result_verb} #{checked} out of #{total}#{result_subject} #{title}"),pin:local.t("I#{result_verb} #{checked} out of #{total}#{result_subject} #{title}"),tumblr:local.t("I#{result_verb} #{checked} out of #{total}#{result_subject} #{title}"),email_body:local.t("I#{result_verb} #{checked} out of #{total}#{result_subject} \n\n #{link}")},bff_create:{fb_title:"How well do you know #{bff_quiz_creator_name}?",fb_description:"I challenge you to find out how well you really know me!",tw:"How well do you know #{bff_quiz_creator_name}?",pin:"How well do you know #{bff_quiz_creator_name}?",email_subject:"How well do you know #{bff_quiz_creator_name}?",email_body:"I challenge you to find out how well you really know me! \n\n #{link}"},bff_take:{fb_title:"I got #{score} out of #{total}!",fb_description:"How well do you know #{bff_quiz_creator_name}?",tw:"I got #{score} out of #{total}! How well do you know #{bff_quiz_creator_name}?",pin:"I got #{score} out of #{total}! How well do you know #{bff_quiz_creator_name}?",email_subject:"How well do you know #{bff_quiz_creator_name}?",email_body:"I got #{score} out of #{total}! \n\n #{link}"},"3397410":{fb_title:"I Got: #{result}! #{title}",fb_description:"#{outcome} - that’s why I’m doing Mute A Mate for Cancer Research UK! I’ve donated £3 by texting MUTE to 70200 and I promise #{fb_promise} for at least a week. Take the quiz to find out what your sin is, donate and pass it on! <b>Text costs £3 plus 1 standard rate text. CRUK receives £2.93. UK mobiles 16+ only. T&Cs @ cruk.org/text. Queries? 0300 1231861</b>",tw:"I Got #{result}! #{title} Let's #MuteAMate for Cancer Research UK! ",email_subject:"Quiz: #{title}",email_body:"I Got: #{result}! #{title}\n\n#{link}\n\n#{outcome} – that’s why I’m doing Mute A Mate for Cancer Research UK! I’ve donated £3 by texting MUTE to 70200 and I promise #{email_promise} for at least a week. Take the quiz to find out what your sin is, donate and pass it on!\nText costs £3 plus 1 standard rate text. CRUK receives £2.93. UK mobiles 16+ only. T&Cs @ cruk.org/text. Queries? 0300 1231861"},poll:{tally:local.t("You voted #{vote} #{poll_question}"),fb:local.t('I voted #{vote}! "#{poll_question}" #{link}'),tw:local.t('I voted #{vote}! "#{poll_question}"'),email_body:local.t('I voted #{vote} "#{poll_question}" \n\n #{link}')}};this.init=function(){var a=$(document.body)[bfjs.selector]("#buzz_sub_buzz .quiz");if(BF_STATIC.mobile_app){bf_quiz.user={p_editor_admin:"false"}}else{bf_quiz.user=(new BF_User()).getUserInfo()}bfjs.universal_each(a,function(d,s){var l=$(d)[bfjs.read_attr]("rel:quiz_type");var c=$(d)[bfjs.read_attr]("rel:id");var f=$(d)[bfjs.read_attr]("rel:swap")=="1"?true:false;var g=$(d)[bfjs.selector](".quiz_question");var k=(l=="single question")?".quiz_reveal":".quiz_result";var h=$(d)[bfjs.selector](k);var e=$(d)[bfjs.read_attr]("rel:question_count");var p=$(d)[bfjs.selector](".quiz_result_area").first();bf_quiz.quizes[s]={};bf_quiz.quizes[s]["id"]=c;bf_quiz.quizes[s]["type"]=l;bf_quiz.quizes[s]["swap"]=f;bf_quiz.quizes[s]["el"]=$(d);bf_quiz.quizes[s]["questions"]={};bf_quiz.quizes[s]["results"]={};bf_quiz.quizes[s]["question_count"]=e;bf_quiz.quizes[s]["quiz_result_area_el"]=p;bf_quiz.quizes[s]["completed"]=false;bf_quiz.quizes[s]["result_verb"]=$(d)[bfjs.read_attr]("rel:result_verb");bf_quiz.quizes[s]["result_subject"]=$(d)[bfjs.read_attr]("rel:result_subject");bf_quiz.quizes[s]["pound_no_track"]=false;bf_quiz.quizes[s]["answer_positions"]=[];if(bf_quiz.isChecklist(bf_quiz.quizes[s]["type"])){bf_quiz.quizes[s].el[bfjs.selector](".show_results").first()[bfjs.observer]("click",function(t){$(t.target)[bfjs.up](".show_results_container").hide();bf_quiz.show_results(bf_quiz.quizes[s]);bf_quiz.quiz_shares(bf_quiz.quizes[s]);bf_quiz.quiz_complete(bf_quiz.quizes[s]);bfjs.universal_each(bf_quiz.quizes[s].questions[0].answers,function(w,u){if($(w)[bfjs.has_class]("selected")){return}bfjs.toggleClass(w,"deactivated",true)})})}bfjs.universal_each(g,function(x,z){var t=$(x)[bfjs.read_attr]("rel:id");var B=$(x)[bfjs.selector](".quiz_answer.quiz_answer_el");var A=$(x)[bfjs.selector](".quiz_reveal");var w=$(x)[bfjs.read_attr]("rel:question_type");var y=bf_quiz.quizes[s]["questions"];var u;y[z]={};y[z]["id"]=t;y[z]["el"]=$(x);y[z]["answers"]=B;y[z]["image"]=$(x)[bfjs.selector](".quiz_img").first();y[z]["reveal"]=A;y[z]["type"]=w;y[z]["response"]=null;y[z]["correct"]=null;y[z]["personality_index"]=null;u=$(x)[bfjs.selector](".quiz_un_reveal");if(u.length>0){u.first()[bfjs.observer]("click",function(J){var D=$(y[z]["image"])[bfjs.read_attr]("rel:question_src");var H=$(y[z]["image"])[bfjs.read_attr]("rel:reveal_src");var C=$(y[z]["image"])[bfjs.read_attr]("src");var E=$(y[z]["image"])[bfjs.read_attr]("rel:attr");var G=$(y[z]["image"])[bfjs.read_attr]("rel:reveal_attr");var I=$(y[z]["image"])[bfjs.up]()[bfjs.selector](".buzz_attribution").first();var F="";if(H&&C==H){$(y[z]["image"])[bfjs.write_attr]("src",D);if(E){F=E}$(J.target)[bfjs.update_html]("Show new image")}else{if(H){if(G){F=G}$(y[z]["image"])[bfjs.write_attr]("src",H);$(J.target)[bfjs.update_html]("Show original image")}}if(I){I[bfjs.update_html](F)}})}bfjs.universal_each(B,function(D,C){var E=$(D);E[bfjs.observer]("mouseover",function(G){var F=G||window.event;if(!G.relatedTarget&&G.fromElement){G.relatedTarget=G.fromElement===G.target?G.toElement:G.fromElement}if((G.relatedTarget&&$(G.relatedTarget)[bfjs.up](".quiz_answer")==D)||D===y[z].response){return}if(D===y[z].response||(bf_quiz.isChecklist(bf_quiz.quizes[s].type)&&E[bfjs.has_class]("selected"))){return}bf_quiz.style(0,y[z],D)});E[bfjs.observer]("mouseout",function(G){var F=G||window.event;if(!G.target){G.target=G.srcElement||document}if(!G.relatedTarget&&G.fromElement){G.relatedTarget=G.fromElement===G.target?G.toElement:G.fromElement}if(bf_quiz.isChecklist(bf_quiz.quizes[s].type)&&E[bfjs.has_class]("selected")){return}if((G.relatedTarget&&$(G.relatedTarget)[bfjs.up](".quiz_answer")!=D)&&(G.target==D||$(G.target)[bfjs.up](".quiz_answer")==D)){bf_quiz.style(1,y[z],D)}});E[bfjs.observer]("click",function(F){if(F.target.nodeName.toLowerCase()=="a"&&$(F.target)[bfjs.up]()[bfjs.has_class]("sub_buzz_source_via")){return true}if(bf_quiz.isChecklist(bf_quiz.quizes[s].type)){return bf_quiz.toggleSelection(s,z,C)}bf_quiz.answered(s,z,C);if(bf_quiz.quizes[s]["type"]!=="bff_create"){bf_quiz.submit_quiz(bf_quiz.quizes[s])}})})});bfjs.universal_each(h,function(t,u){var x=$(t)[bfjs.read_attr]("rel:range_start");var z=$(t)[bfjs.read_attr]("rel:range_end");var w=bf_quiz.quizes[s]["results"];var y=$(t)[bfjs.read_attr]("rel:id");w[u]={};w[u]["id"]=y;w[u]["el"]=$(t);w[u]["range_start"]=x;w[u]["range_end"]=z;w[u]["imageEl"]=$(t)[bfjs.selector](".result_img").length?$(t)[bfjs.selector](".result_img")[0]:false});if(bf_quiz.quizes[s].type=="poll"){subbuzz_el=bfjs.getFirstEl($(bf_quiz.quizes[s].el)[bfjs.up](".buzz_superlist_item_quiz"));bf_quiz.quizes[s].close_poll=bf_quiz.quizes[s].el[bfjs.read_attr]("rel:close_poll")==1?true:false;bf_quiz.quizes[s].hide_results=bf_quiz.quizes[s].el[bfjs.read_attr]("rel:hide_results")==1?true:false;var m;if(subbuzz_el){m=subbuzz_el.id.split("_")[2]}if(m){if(bf_quiz.quizes[s].close_poll||bf_quiz.already_voted(m)){bf_quiz.quizes[s].voted=1;if(!bf_quiz.quizes[s].hide_results){bf_quiz.get_poll_agregates({poll_id:m,source:bf_quiz.get_poll_source()},bf_quiz.quizes[s])}else{bf_quiz.show_poll_results(bf_quiz.quizes[s])}var j=$(bf_quiz.quizes[s].el)[bfjs.selector](".answer_shares");if(j.length>0){j.first().hide()}bf_quiz.show_results(bf_quiz.quizes[s])}if(bf_quiz.quizes[s].hide_results&&!bf_quiz.quizes[s].voted){var o=$(bf_quiz.quizes[s].el)[bfjs.selector](".quiz_question");if(o.length>0){o.first()[bfjs.remove_class]("hidden")}}if(bf_quiz.user.p_editor_admin=="true"||!bf_quiz.quizes[s].close_poll){var n=$(bf_quiz.quizes[s].el)[bfjs.selector](".poll_view_results");if(n.length>0){if(bf_quiz.user.p_editor_admin=="true"){if(bf_quiz.quizes[s].hide_results&&!bf_quiz.quizes[s].voted){n.first()[bfjs.remove_class]("hidden")}if(bf_quiz.quizes[s].hide_results&&(bf_quiz.quizes[s].close_poll||bf_quiz.quizes[s].voted)){n.first()[bfjs.remove_class]("hidden")}}n.first()[bfjs.observer]("click",function(t){bf_quiz.get_poll_agregates({poll_id:m,source:bf_quiz.get_poll_source()},bf_quiz.quizes[s]);bf_quiz.toggle_preview_results(bf_quiz.quizes[s],true);if(bf_quiz.user.p_editor_admin=="true"&&bf_quiz.quizes[s].hide_results){if(bf_quiz.quizes[s].el[bfjs.has_class]("complete")){bf_quiz.quizes[s].el[bfjs.remove_class]("preview");n.first()[bfjs.add_class]("hidden")}}})}}}if(!bf_quiz.quizes[s].close_poll&&!bf_quiz.quizes[s].voted){var q=$(bf_quiz.quizes[s].el)[bfjs.selector](".go_back_and_vote");if(q.length>0){if(bf_quiz.user.p_editor_admin=="true"&&bf_quiz.quizes[s].hide_results){q.first()[bfjs.remove_class]("hidden")}q.first()[bfjs.observer]("click",function(t){bf_quiz.toggle_preview_results(bf_quiz.quizes[s],false)})}}}if(bf_quiz.quizes[s]["type"]==="bff_create"){var b=bf_quiz.bff_quiz_retrieve_info(bf_quiz.quizes[s],d);if(b){if(bfjs.isMobile()){$.extend(bf_quiz.quizes[s],b)}else{Object.extend(bf_quiz.quizes[s],b)}bf_quiz.bff_quiz_observe_form(bf_quiz.quizes[s])}}if(bf_quiz.quizes[s]["type"]==="bff_take"){var b=bf_quiz.bff_quiz_retrieve_info(bf_quiz.quizes[s],d);if(b){if(bfjs.isMobile()){$.extend(bf_quiz.quizes[s],b)}else{Object.extend(bf_quiz.quizes[s],b)}bf_quiz.bff_quiz_observe_fb_signin(bf_quiz.quizes[s]);bf_quiz.bff_quiz_build_take_quiz(bf_quiz.quizes[s])}}})};this.style=function(a,b,d){var c=$(b.el)[bfjs.up](".quiz")[bfjs.read_attr]("rel:quiz_type");if(bf_quiz.isChecklist(c)){if(a==2){bfjs.toggleClass(d,"selected",true)}else{if(a==1){bfjs.toggleClass(d,"selected")}}}if((a==2||a>=4)&&b.response&&d==bfjs.getFirstEl(b.response)){bfjs.toggleClass(d,"selected",true)}if(a==0){bfjs.toggleClass(d,"deactivated")}else{if(a==1){if(!bfjs.universal_compare_els($(b.response),$(d))){bfjs.toggleClass(d,"selected");bfjs.toggleClass(d,"def_answer");if((b.type=="text"||b.type=="image")&&b.correct!=null){bfjs.toggleClass(d,"deactivated",true)}else{bfjs.toggleClass(d,"deactivated")}}}else{if(a==2){$(d)[bfjs.add_class]("selected");bfjs.toggleClass(d,"deactivated")}else{if(a==4){$(d)[bfjs.add_class]("correct_answer");bfjs.toggleClass(d,"deactivated")}else{if(a==5){$(d)[bfjs.add_class]("wrong_answer");bfjs.toggleClass(d,"deactivated",true)}}}}}};this.toggleSelection=function(k,d,h){var c=bf_quiz.quizes[k];var f=c.questions[d];var g=f.answers;var j=f.answers[h];var b=$(g[h])[bfjs.read_attr]("rel:id");var e=f.id;var a=$(j)[bfjs.has_class]("selected")?1:2;bf_quiz.style(a,f,j);if(a==2){bf_quiz.gaTrack("[ttp]:content","quiz-answer",[e,b].join("="))}};this.answered=function(l,d,k){var c=bf_quiz.quizes[l];if(c.type=="poll"&&c.close_poll){return}var f=c.questions[d];var g=f.answers;var b=$(g[k])[bfjs.read_attr]("rel:id");var e=f.id;var a=1;var j,h;c.answer_positions[d]=k;f.response=$(g[k]);f.correct=$(f.response)[bfjs.read_attr]("rel:correct")=="1"?true:false;f.personality_index=$(f.response)[bfjs.read_attr]("rel:personality_index");bfjs.universal_each(g,function(m){a=m===bfjs.getFirstEl(f.response)?2:1;bf_quiz.style(a,f,m)});if(c.type=="single question"){bf_quiz.show_answers(f,c);bf_quiz.show_results(c)}else{if(c.type=="standard"||c.type=="bff_take"){bf_quiz.show_answers(f,c)}else{if(c.type=="poll"){j=bfjs.getFirstEl($(bf_quiz.quizes[l].el)[bfjs.up](".buzz_superlist_item_quiz"));if(j){h=j.id.split("_")[2];this.get_poll_agregates({poll_id:h,source:this.get_poll_source()},bf_quiz.quizes[l])}}}}bf_quiz.gaTrack("[ttp]:content","quiz-answer",[e,b].join("="))};this.submit_poll=function(b){if(this.already_voted(b.poll_id)){return}var a=this.pollUrl+b.source+"/post?poll_id="+b.poll_id+"&result_id="+b.result_id;bfjs.loadJSONP(a,function(c){return bf_quiz.submit_poll_callback(c)});this.store_voted_cookie(b.poll_id)};this.store_voted_cookie=function(b){if(isNaN(b)){return}var a=this.cookiePrefix+b;if(typeof store!=="undefined"&&store.enabled){store.set(a,1)}else{createCookie(a,1,365)}};this.already_voted=function(b){var a=this.cookiePrefix+b;if(typeof store!=="undefined"&&store.enabled){return !!store.get(a)}else{return !!readCookie(a)}};this.submit_poll_callback=function(a){};this.get_poll_source=function(){return"editorial"};this.get_poll_agregates_callback=function(p,m){var a,b,l,g,o,h,c,f,e,d,n=this;if(p&&p.error==1){g=p.message.match(/Key (.*?) not found/);if(g){p.data={poll_id:m.poll_id,source:m.source,results:{}}}else{console.debug("Poll get results error",p.message);this.show_poll_error(m.poll_obj);return false}}if(!p.callbackSuccess){this.show_poll_error(m.poll_obj);return false}if(p&&p.data){b=$(document.getElementById("superlist_"+BF_STATIC.campaignid+"_"+p.data.poll_id))[bfjs.selector](".quiz")[0];start:for(f in this.quizes){if(!this.quizes.hasOwnProperty(f)){continue}a=this.quizes[f];if(a.type!="poll"||bfjs.getFirstEl(a.el)!=bfjs.getFirstEl(b)){continue}for(e in a.questions){if(!a.questions.hasOwnProperty(e)){continue}l=a.questions[e];o=$(l.el)[bfjs.selector](".quiz_answer.selected")[0];h=$(l.el)[bfjs.selector](".quiz_answer");c=bfjs.indexOf(o,h);for(d in l.answers){if(!l.answers.hasOwnProperty(d)||isNaN(d)){continue}if(typeof p.data.results[d]==="undefined"){p.data.results[d]=0}}break start}}if(o){this.submit_poll({source:m.source,poll_id:p.data.poll_id,result_id:c})}if(typeof p.data.results[c]!=="undefined"){p.data.results[c]++}this.show_poll_results(a);if(!a.hide_results||bf_quiz.user.p_editor_admin=="true"){setTimeout(function(){n.fill_poll_agregates(p.data,a)},1)}}};this.get_poll_agregates=function(e,d){var a=this,b={poll_id:e.poll_id,poll_obj:d,source:e.source},c=this.pollUrl+"aggregate/"+e.source+"/get/?poll_id="+e.poll_id,f;if(typeof e==="undefined"||!e.poll_id||!e.source){return}f=setTimeout(function(){a.show_poll_error(d)},10*1000);bfjs.loadJSONP(c,function(g){clearTimeout(f);if(g.callbackSuccess){return a.get_poll_agregates_callback(g,b)}else{return a.show_poll_error(d)}},{retries:3})};this.show_poll_error=function(b){if(!b){return}var a=b.el?$(b.el):$(b);if(a[bfjs.has_class]("filled")){return}$(a[bfjs.selector](".results_spinner")[0])[bfjs.add_class]("hidden");$(a[bfjs.selector](".results_content")[0])[bfjs.add_class]("hidden");$(a[bfjs.selector](".error_content")[0])[bfjs.remove_class]("hidden");$(a[bfjs.selector](".answer_shares_poll")[0])[bfjs.add_class]("hidden")};this.show_poll_results=function(b){if(!b){return}var a=$(b.el);$(a[bfjs.selector](".results_spinner")[0])[bfjs.add_class]("hidden");$(a[bfjs.selector](".error_content")[0])[bfjs.add_class]("hidden");$(a[bfjs.selector](".results_content")[0])[bfjs.remove_class]("hidden")};this.fill_poll_agregates=function(f,b){if(!f||!b){return}var j=0,g,p,c,s;$(b.el)[bfjs.add_class]("filled");for(g in f.results){if(!f.results.hasOwnProperty(g)||isNaN(f.results[g])){continue}j+=f.results[g]}var q=[];var o=[];for(g in f.results){q[g]=f.results[g]*100/(j||1)}var m=this.getLargestRemainder(q,100);for(g in f.results){c=b.el[bfjs.selector](".poll_result")[g];if(!c){continue}s=$(c);o.push({id:g,result:f.results[g],percentage:m[g]||0,el:c})}var d;if(b.questions[0]&&b.questions[0].answers){for(g in b.questions[0].answers){if(!b.questions[0].answers.hasOwnProperty(g)||isNaN(g)){continue}c=b.questions[0].answers[g];if(!c){continue}s=$(c);if(s[bfjs.has_class]("selected")){d=g;o[g].selected=true;break}}}var l=false;var h=b.el[bfjs.selector](".poll_results");if(h.length>0){h=h[0];l=$(h)[bfjs.read_attr]("rel:reorder_results")==1?true:false}if(l){var n=o.length;for(var g=0;g<n;g++){c=b.el[bfjs.selector](".poll_result")[g];if(!c){continue}s=$(c);var e=s[bfjs.read_attr]("rel:poll_result_num")-1;o[g].id=e;o[e].el=c}o.sort(function(u,t){return t.result-u.result});var a=b.el[bfjs.selector](".results_content ol");if(a.length>0){a=a[0];for(g in o){if(!o.hasOwnProperty(g)){continue}c=o[g].el;a.appendChild(c);window.getComputedStyle(c).background}}}for(g in o){if(!o.hasOwnProperty(g)){continue}if(l&&o[g].selected){d=g}p=o[g].result;q=o[g].percentage;c=o[g].el;if(!c){continue}window.getComputedStyle(c).width;s=$(c);s[bfjs.selector](".poll_percentage")[0].innerHTML=q+"%";s[bfjs.selector](".poll_votes .num")[0].innerHTML=bfjs.formatNumber(p);if(p!==1){$(s[bfjs.selector](".poll_votes")[0])[bfjs.add_class]("plural")}$(s[bfjs.selector](".poll_bar_inner")[0])[bfjs.write_attr]("style","width:"+q+"%;")}if(d){var k=$(b.el[bfjs.selector](".poll_result")[d]);if(k){k[bfjs.add_class]("selected");setTimeout(function(){$(k[bfjs.selector](".poll_result_wrapper")[0])[bfjs.write_attr]("style","background: white;")},1500)}}};this.getLargestRemainder=function(h,j){var f=0;var c=[];for(i in h){if(!h.hasOwnProperty(i)){continue}var e=h[i]|0;var d=h[i]%1;f+=e;c.push({integer:e,decimal:d,originalIndex:i})}if(f>0&&f!=j){c.sort(function(l,k){return k.decimal-l.decimal});var g=j-f;var b=0;while(b<g){c[b++].integer++;f++}c.sort(function(l,k){return l.originalIndex-k.originalIndex})}var a=bfjs.map(c,function(k){return k.integer});return a};this.submit_quiz=function(c){var a,d,b,e;if(bf_quiz.quiz_complete(c)&&!c.completed){a=bf_quiz.get_completed_quiz_result(c);if(c.answer_positions.length==c.question_count){d=c.answer_positions}if(typeof a=="undefined"||typeof a.el=="undefined"){a={el:false}}if(bfjs.isMobile()){b=$.Event("quiz_submit");b.answer_data=c.answer_positions;b.el=a.el;$(document).trigger(b)}else{EventManager.fire("quiz_submit",d,a.el)}bf_quiz.show_results(c);if(c.type!="single question"&&!(c.type=="poll"&&c.hide_results)){bf_quiz.quiz_shares(c)}c.completed=true;if(bfjs.isMobile()){e=$.Event("quiz_complete");e.answer_data=c.answer_positions;e.el=a.el;$(document).trigger(e)}else{EventManager.fire("quiz_complete",d,a.el)}}};this.show_answers=function(a,c){var d=a.answers;var b=c?c.type:null;bf_quiz.disable_question(a);bfjs.universal_each(d,function(e){if(c.type=="single question"&&d.length<=1){return}if(b!="personality"&&b!=="bff_create"){if($(e)[bfjs.read_attr]("rel:correct")=="1"){bf_quiz.style(4,a,e)}else{if(e===bfjs.getFirstEl(a.response)){bf_quiz.style(5,a,e)}}}});if(b=="single question"||b=="standard"||b=="bff_take"){bf_quiz.reveal(a,c)}};this.save=function(d){if(typeof BF_Pixel=="undefined"){return false}var g={},f=new Array,a,h,b,e,c;g.quiz=d.id;if(bf_quiz.isChecklist(d.type)){for(a in d.questions){b=d.questions[a];for(h in b.answers){e=b.answers[h];if(typeof e=="object"){c=$(e)[bfjs.has_class]("selected"),id=$(e)[bfjs.read_attr]("rel:id");if(c){f.push(id)}}}}g.answers=f.join()}else{for(a in d.questions){b=d.questions[a];g[b.id]=$(b.response)[bfjs.read_attr]("rel:id")}}BF_Pixel.save({dir:"quiz",params:g})};this.show_results=function(d){var f=d.swap;var h=d.questions;var j=d.results;var p=bf_quiz.get_completed_quiz_result(d);var c=p?$(p.el)[bfjs.selector](".answer_response").first():null;var g,m,n,a,l,k,e,b;for(b in h){bf_quiz.disable_question(h[b])}if($(d.quiz_result_area_el)){$(d.quiz_result_area_el).show()}if(d.type=="personality"){if(p){$(d.el)[bfjs.selector](".quiz_tally_results").first().show();$(d.el)[bfjs.selector](".quiz_tally").first().hide();$(p.el).show();if(typeof window.BF_Effect!="undefined"){BF_Effect.ScrollIntoView($(p.el))}if(p){c.hide()}}}else{if(d.type=="single question"){if(d.questions[0].answers.length>1){g=d.questions[0];m=$(g.el)[bfjs.selector](".answer_response");n=bf_quiz.correct_answer(g);a=g.correct?"Correct! ":"Wrong! ";if(m.size()>0){$(m[0])[bfjs.add_class](g.correct?"correct":"wrong")[bfjs.selector](".message_text").first()[bfjs.update_html](a)}else{if(p){c.hide()}}}}else{if(bf_quiz.isChecklist(d.type)){l=bf_quiz.get_message("checklist","tally",{"#{result_verb}":d.result_verb,"#{result_subject}":d.result_subject});l=local.t(l,{variables:{total:d.questions[0].answers.length,checked:bf_quiz.number_selected(d)}});k=$(d.el)[bfjs.selector](".quiz_tally").first();$(k)[bfjs.update_html](l);$(d.el)[bfjs.selector](".quiz_tally_results").first().show();if(p){$(p.el).show();if(typeof window.BF_Effect!="undefined"){BF_Effect.ScrollIntoView($(p.el))}c.hide()}}else{if(d.type=="poll"){d.el[bfjs.add_class]("complete");if(d.hide_results&&bf_quiz.user.p_editor_admin=="true"){var o=d.el[bfjs.selector](".poll_view_results");if(o.length>0){o.first()[bfjs.write_attr]("style","display: block;")}}if(!d.voted){bf_quiz.scroll_top_poll(d)}}else{if(d.type=="bff_create"){}else{l=bf_quiz.get_message("generic","tally",{"#{x}":bf_quiz.number_correct(d),"#{y}":d.question_count});k=$(d.el)[bfjs.selector](".quiz_tally").first();$(k)[bfjs.update_html](l);$(d.el)[bfjs.selector](".quiz_tally_results").first().show();if(d.type=="percentage"){for(b in d.questions){bf_quiz.show_answers(d.questions[b],d)}}if(d.type=="bff_take"){bf_quiz.bff_quiz_show_leaderboard(d.bff_quiz_leaderboard[1]);window.setTimeout(function(){bf_quiz.bff_quiz_animate_leaderboard(d.bff_quiz_leaderboard[1])},200)}if(p){c.hide();$(p.el).show()}}}}}}if(p&&p.imageEl){$(p.imageEl)[bfjs.write_attr]("src",$(p.imageEl)[bfjs.read_attr]("data:src"))}};this.toggle_preview_results=function(c,a){c.preview_results=a?true:false;if(c.hide_results&&bf_quiz.user.p_editor_admin=="true"){bf_quiz.toggle_hidden_results(c)}if($(c.quiz_result_area_el)){if(c.preview_results){$(c.quiz_result_area_el).show()}else{$(c.quiz_result_area_el).hide()}}if(c.preview_results){c.el[bfjs.add_class]("preview")}else{c.el[bfjs.remove_class]("preview");var b=c.el[bfjs.selector](".poll_result .poll_bar_inner");for(i in b){if(!b.hasOwnProperty(i)||isNaN(i)){continue}$(b[i])[bfjs.write_attr]("style","width:0;")}}bf_quiz.scroll_top_poll(c)};this.toggle_hidden_results=function(c){var b=c.el[bfjs.selector](".poll_end_voting");if(b.length>0){if(c.preview_results){b.first().hide()}else{b.first().show()}}var a=c.el[bfjs.selector](".results_content ol");if(a.length>0){if(c.preview_results){a.first().show()}else{a.first().hide()}}};this.scroll_top_poll=function(b){el=bfjs.getFirstEl(b.el);var a=0;if(!bfjs.isMobile()&&$$(".ptools-buzzpage").length){a=40}var c=(window.pageYOffset!==undefined)?window.pageYOffset:document.documentElement.scrollTop;window.scrollTo(0,c+el.getBoundingClientRect().top-10-a)};this.disable_question=function(c){var d=c.answers,b;for(b in d){if(typeof d[b]!="object"||!$(d[b])){continue}$(d[b])[bfjs.stop_observing]("mouseover");$(d[b])[bfjs.stop_observing]("mouseout");$(d[b])[bfjs.stop_observing]("click");bfjs.setStyle($(d[b]),{cursor:"default"})}};this.get_message=function(d,a,e){var c=bf_quiz.messages.generic[a],b;if(bf_quiz.messages.hasOwnProperty(d)&&bf_quiz.messages[d].hasOwnProperty(a)){c=bf_quiz.messages[d][a]}c=local.t(c);for(b in e){if(!e.hasOwnProperty(b)){continue}e[b]=typeof(e[b])=="string"?e[b].replace("$","$/"):e[b];c=c.replace(b,e[b])}c=c.replace("$/","$");return c};this.get_completed_quiz_result=function(e){var d=e.results,f,c,b,a;if(e.type=="personality"){f=bf_quiz.personality(e);return d[f[0]]}else{if(e.type=="bff_create"){return{el:e.bff_quiz_create_results[0],id:e.id,range_end:0,range_start:0}}else{if(e.type=="single question"){return d[0]}else{if(bf_quiz.isChecklist(e.type)){c=bf_quiz.percent_checked(e);for(b in d){a=d[b];if(c>=a.range_start&&c<=a.range_end){return a}}}else{c=bf_quiz.percent_correct(e);for(b in d){a=d[b];if(c>=a.range_start&&c<=a.range_end){return a}}}}}}return false};this.reveal=function(a,f){var g,d,c,h,b,e;if(a.reveal){if(a.image&&a.image[bfjs.read_attr]("rel:reveal_src")){a.image[bfjs.write_attr]("rel:question_src",a.image[bfjs.read_attr]("src"));a.image[bfjs.write_attr]("src",a.image[bfjs.read_attr]("rel:reveal_src"));c=a.image[bfjs.read_attr]("rel:reveal_attr");if(c){g=a.image[bfjs.up]()[bfjs.selector](".buzz_attribution").first();if(g){d=bfjs.getFirstEl(g).innerText||bfjs.getFirstEl(g).textContent;if(d){a.image[bfjs.write_attr]("rel:attr",d.replace('"',"&quot;"))}g[bfjs.update_html](c)}}}if($(a.el)[bfjs.selector](".reveal_embed").length>0){$(a.el)[bfjs.selector](".reveal_embed").first().show();$(a.el)[bfjs.selector](".question_embed").first().hide()}bfjs.universal_each(a.reveal,function(j){$(j).show()})}if(f.type!="single question"||(f.type=="single question"&&a.answers.length>1)){h=$(a.el)[bfjs.selector](".answer_response");b=bf_quiz.correct_answer(a);e=a.correct?local.t("Correct!"):local.t("Wrong!");if(h.size()>0){$(h[0])[bfjs.add_class](a.correct?"correct":"wrong")[bfjs.selector](".message_text").first()[bfjs.update_html](e)}}};this.correct_answer=function(a){bfjs.universal_each(a.answers,function(b){if($(b)[bfjs.read_attr]("rel:correct")=="1"){return $(b)}});return null};this.personality=function(f){var b=0,a=0,d=[],g=[],e,c;for(var e in f.results){d[e]=0}for(e in f.questions){c=f.questions[e];d[c.personality_index]++;b++}for(e=d.length-1;e>=0;e--){if(d[e]>a){a=d[e]}}for(e=d.length-1;e>=0;e--){if(d[e]==a){g.push(e)}}return g};this.percent_checked=function(c){var b=bf_quiz.number_selected(c);var a=c.questions[0].answers.length;return Math.round((b/a)*100)};this.percent_correct=function(d){var a=0,e=0,c,b;for(c in d.questions){b=d.questions[c];a++;if(b.correct==true){e++}}return Math.round((e/a)*100)};this.number_selected=function(a){return a.el[bfjs.selector](".quiz_answer.selected").length};this.number_correct=function(c){var d=0,b,a;for(b in c.questions){a=c.questions[b];if(a.correct==true){d++}}return d};this.quiz_complete=function(e){var d=bf_quiz.GALabel(e),b="quiz-complete",c;if(e.type=="single question"){b="quiz-answer"}if(!bf_quiz.isChecklist(e.type)){for(var c in e.questions){var a=e.questions[c];if(a.correct==null){return false}}}if(e.type=="personality"){if(bf_quiz.personality(e).length>1){b="quiz-complete-ties"}}if(e.type=="poll"){b="quiz-answer/poll"}if(bfjs.isMobile()){$(".answer_shares_buttons a").each(function(){$(this).attr("data-label",d)})}bf_quiz.gaTrack("[ttp]:content",b,d);bf_quiz.save(e);return true};this.GALabel=function(c){var a="",d=[],e;if(c.type=="personality"||c.type=="bff_create"){e=bf_quiz.personality(c);for(var b=0;b<e.length;b++){d.push(c.results[e[b]]["id"])}a=c.id+"="+d.join(",")}else{if(bf_quiz.isChecklist(c.type)){a=bf_quiz.number_selected(c)+" out "+c.questions[0].answers.length}else{if(c.type=="poll"){a=c.id+"="+c.el[bfjs.selector](".quiz_answer.selected")[0].getAttribute("rel:id")}else{a=bf_quiz.number_correct(c)+" out "+c.question_count}}}return a};this.isChecklist=function(a){var b=["checklist","image checklist"];return b.indexOf(a)>-1};this.quiz_shares=function(a){var l,d,g,f,k;var j,b,e,h;try{if(bf_quiz.isLegacyApp()){$(a.el)[bfjs.selector](".answer_shares").hide();return false}l=bf_quiz.get_completed_quiz_result(a);d=l&&l.el?$(l.el)[bfjs.read_attr]("rel:description"):"";g={el:$(a.el)[bfjs.selector](".answer_shares .answer_shares_buttons").first(),buzz_uri:(BF_STATIC.mobile_app?$(a.el).attr("rel:buzz_uri"):window.location),buzz_name:(bfjs.isMobile()?$("<div/>").html(BF_STATIC.buzz_name).text():BF_UI.renderEntities(BF_STATIC.buzz_name)),buzz_blurb:(bfjs.isMobile()?$("<div/>").html(BF_STATIC.buzz_blurb).text():BF_UI.renderEntities(BF_STATIC.buzz_blurb)),picture:l&&$(l.el)[bfjs.selector](".result_img").size()>0?$(l.el)[bfjs.selector](".result_img")[0].src:"",result_description:(bfjs.isMobile()?$("<div/>").html(d).text():BF_UI.renderEntities(d)),fb_title:"",fb_blurb:"",tw_blurb:"",tw_hashtags:typeof ad_tw_hashtags!="undefined"?ad_tw_hashtags:"",tw_via:$(a.el)[bfjs.selector](".quiz_tally_results").first()[bfjs.read_attr]("rel:tweet_via")||"BuzzFeed",pin_description:"",email_subject:"",email_body:"",tumblr_name:"",tumblr_description:"",pound_no_track:a.pound_no_track};if(typeof BF_STATIC.pound_enabled!="undefined"&&BF_STATIC.pound_enabled){g.buzz_uri={href:pound.urls.unescaped.queryStringOnly(),toString:pound.urls.unescaped.queryStringOnly}}f={"#{title}":g.buzz_name,"#{link}":g.buzz_uri,"#{result_verb}":a.result_verb,"#{result_subject}":a.result_subject};if(a.type=="personality"&&!bf_quiz.post_rec){f["#{result}"]=$(l.el)[bfjs.read_attr]("rel:name");g.fb_title=bf_quiz.get_message("personality","fb",f);g.fb_blurb=g.result_description?g.result_description:g.buzz_blurb;g.tw_blurb=bf_quiz.get_message("personality","tw",f);g.pin_description=bf_quiz.get_message("personality","pin",f);g.email_subject=bf_quiz.get_message("personality","email_subject",f);g.tumblr_name=bf_quiz.get_message("personality","tumblr",f);g.tumblr_description=g.result_description?g.result_description:g.buzz_blurb;if(!unescape(g.email_subject).match("Quiz:")){g.email_subject="Quiz: "+g.email_subject}g.email_body=bf_quiz.get_message("personality","email_body",f)}else{if(a.type=="personality"&&bf_quiz.post_rec){f["#{result}"]=$(l.el)[bfjs.read_attr]("rel:name");g.fb_title=g.buzz_name;g.fb_blurb=g.buzz_blurb;g.tw_blurb=g.buzz_name;g.pin_description=g.buzz_name;g.email_subject=g.buzz_name;g.tumblr_name=g.buzz_name;g.tumblr_description=g.buzz_blurb;if(!unescape(g.email_subject).match("Quiz:")){g.email_subject="Quiz: "+g.email_subject}g.email_body=g.buzz_name+"  "+(g.buzz_uri.href||g.buzz_uri)}else{if(bf_quiz.isChecklist(a.type)){f["#{checked}"]=bf_quiz.number_selected(a);f["#{total}"]=a.questions[0].answers.length;g.fb_title=bf_quiz.get_message("checklist","fb",f);g.fb_blurb=g.result_description||g.buzz_blurb;g.tw_blurb=bf_quiz.get_message("checklist","tw",f);g.pin_description=bf_quiz.get_message("checklist","pin",f);g.email_subject=bf_quiz.get_message("checklist","email_subject",f);g.tumblr_name=bf_quiz.get_message("checklist","tumblr",f);g.tumblr_description=g.result_description||g.buzz_blurb;if(!unescape(g.email_subject).match("Quiz:")){g.email_subject="Quiz: "+g.email_subject}g.email_body=bf_quiz.get_message("checklist","email_body",f)}else{if(a.type=="poll"){f["#{vote}"]=a.el[bfjs.selector](".quiz_answer.selected .quiz_answer_text")[0].innerHTML[bfjs.trim]();f["#{poll_question}"]=$(a.questions[0].el)[bfjs.selector](".quiz_question_header .headline-1")[0].innerHTML[bfjs.trim]();g.fb_title=bf_quiz.get_message("poll","fb",f);g.fb_blurb=g.result_description||g.buzz_blurb;g.tw_blurb=bf_quiz.get_message("poll","tw",f);g.email_subject=bf_quiz.get_message("poll","email_subject",f);if(!unescape(g.email_subject).match("Quiz:")){g.email_subject="Quiz: "+g.email_subject}g.email_body=bf_quiz.get_message("poll","email_body",f)}else{if(a.type=="bff_create"){f["#{bff_quiz_creator_name}"]=a.bff_quiz_creator_name;f["#{link}"]=a.bff_quiz_url;g.fb_title=bf_quiz.get_message("bff_create","fb_title",f);g.fb_blurb=bf_quiz.get_message("bff_create","fb_description",f);g.tw_blurb=bf_quiz.get_message("bff_create","tw",f);g.pin_description=bf_quiz.get_message("bff_create","pin",f);g.email_body=bf_quiz.get_message("bff_create","email_body",f);g.email_subject=bf_quiz.get_message("bff_create","email_subject",f);g.buzz_uri=a.bff_quiz_url}else{if(a.type=="bff_take"){f["#{score}"]=bf_quiz.number_correct(a);f["#{total}"]=a.question_count;f["#{bff_quiz_creator_name}"]=a.bff_quiz_creator_name;g.fb_title=bf_quiz.get_message("bff_take","fb_title",f);g.fb_blurb=bf_quiz.get_message("bff_take","fb_description",f);g.tw_blurb=bf_quiz.get_message("bff_take","tw",f);g.pin_description=bf_quiz.get_message("bff_take","pin",f);g.email_subject=bf_quiz.get_message("bff_create","email_subject",f);g.buzz_uri=a.bff_quiz_url;g.picture=$(a.quiz_result_area_el)[bfjs.selector](".result_img")[0].src}else{f["#{score}"]=bf_quiz.number_correct(a);f["#{total}"]=a.question_count;g.fb_title=g.buzz_name;g.fb_blurb=bf_quiz.get_message("generic","fb",f);g.tw_blurb=bf_quiz.get_message("generic","tw",f);g.pin_description=bf_quiz.get_message("generic","pin",f);g.email_subject=bf_quiz.get_message("generic","email_subject",f);g.tumblr_name=g.buzz_name;g.tumblr_description=bf_quiz.get_message("generic","tumblr",f);if(!unescape(g.email_subject).match("Quiz:")){g.email_subject="Quiz: "+g.email_subject}g.email_body=bf_quiz.get_message("generic","email_body",f)}}}}}}if(BF_STATIC.campaignid=="1931201"){j="Remember to eat your cereal, not your serial killers.";g.fb_blurb=j;g.tw_blurb=g.buzz_name+" "+j;g.tw_hashtags="ripperstreet";g.pin_description=g.buzz_name+" "+j;g.email_subject=bf_quiz.get_message("generic","email_subject",{"#{title}":g.buzz_name});g.email_body=j+" "+escape(g.buzz_uri);g.tumblr_name=g.buzz_name;g.tumblr_description=j}if(BF_STATIC.campaignid=="3397410"){b={"Constant Commentator":"I’m an over-sharer and proud","Too Proud Parent":"I’m all about my brilliant brood",Failosopher:"I love getting deep and meaningful",Animaniac:"I admit it, I’m all about the cute animals","Smug Couple":"I’m loved up and you’re tired of seeing it","Score Bore":"I’ve been boring you with my gym brags","Social Show-Off":"I’ve been flaunting the high life on here too long","Foodie Fanatic":"I’ve been over-sharing my food snaps",Lurker:"Okay, I spend too much time looking at other peoples’ updates"};e={"Constant Commentator":"to stop my constant updates","Too Proud Parent":"to stop boasting about my babies",Failosopher:"to stop posting deep and meaningful messages",Animaniac:"to stop all the animal pictures","Smug Couple":"to stop updating you all on my love life","Score Bore":"to stop boasting about my gym time","Social Show-Off":"to stop showing-off","Foodie Fanatic":"to stop posting food photos",Lurker:"to stop lurking"};h={"Constant Commentator":"to stop these posts","Too Proud Parent":"to stop these posts",Failosopher:"to stop these posts",Animaniac:"to stop these posts","Smug Couple":"to stop these posts","Score Bore":"to stop these posts","Social Show-Off":"to stop these posts","Foodie Fanatic":"to stop these posts",Lurker:"to stop lurking"};f["#{outcome}"]=b[f["#{result}"]];f["#{fb_promise}"]=e[f["#{result}"]];f["#{email_promise}"]=h[f["#{result}"]];g.fb_title=bf_quiz.get_message("3397410","fb_title",f);g.fb_blurb=bf_quiz.get_message("3397410","fb_description",f);g.email_subject=bf_quiz.get_message("3397410","email_subject",f);g.email_body=bf_quiz.get_message("3397410","email_body",f);f["#{title}"]="What's Your Social Media Sin?";f["#{link}"]=escape(g.buzz_uri);g.tw_blurb=bf_quiz.get_message("3397410","tw",f)}if($(g.el)){$(g.el).show()}if(bfjs.isMobile()){$(document.body)[bfjs.selector](".js-action-bar--sharing.position-lower")[bfjs.add_class]("hidden");$(a.quiz_result_area_el)[bfjs.selector](".js-action-bar--sharing.position-quiz .js-action-bar__btn--facebook")[bfjs.observer]("click",function(n){n.preventDefault();var m={name:unescape(g.fb_title),description:unescape(g.fb_blurb),link:g.buzz_uri.toString(),picture:g.picture,parent_id:"share-buttons-quiz",category:"MobileBuzz:sharing-quiz",action:$(this).data("action"),label:bf_quiz.GALabel(a)};if(a.type==="bff_create"||a.type==="bff_take"){m.redirect_uri=(document.URL.indexOf("https://")==0?"https://":"http://")+document.domain+"/static/html/fb-redirect.html"}Share.facebook(m)});$(a.quiz_result_area_el)[bfjs.selector](".js-action-bar--sharing.position-quiz .js-action-bar__btn--twitter")[bfjs.observer]("click",function(n){n.preventDefault();var m={text:bfjs.stripTags(g.tw_blurb),url:g.buzz_uri,via:g.tw_via,parent_id:"share-buttons-quiz",category:"MobileBuzz:sharing-quiz",action:$(this).data("action"),label:bf_quiz.GALabel(a)};Share.twitter(m)});$(a.quiz_result_area_el)[bfjs.selector](".js-action-bar--sharing.position-quiz .js-action-bar__btn--tumblr")[bfjs.observer]("click",function(n){n.preventDefault();var m={url:g.buzz_uri,name:g.tumblr_name,description:g.tumblr_description,parent_id:"share-buttons-quiz",legacy_url:document.URL.replace(/[?#].*$/g,"")};m.category="MobileBuzz:content";m.action=$(n).data("action");Share.tumblr(m)});$(a.quiz_result_area_el)[bfjs.selector](".js-action-bar--sharing.position-quiz.position-quiz .js-action-bar__btn--pinterest")[bfjs.observer]("click",function(n){n.preventDefault();var m={media:g.picture||$(".buzz").data("image"),description:bfjs.stripTags(g.tw_blurb),url:g.buzz_uri,parent_id:"share-buttons-quiz",category:"MobileBuzz:sharing-quiz",action:$(this).data("action"),label:bf_quiz.GALabel(a)};Share.pinterest(m)});$(a.quiz_result_area_el)[bfjs.selector](".js-action-bar--sharing.position-quiz .js-action-bar__btn--email")[bfjs.observer]("click",function(n){n.preventDefault();var m={subject:bfjs.stripTags(g.email_subject),body:bfjs.stripTags(g.email_body)+"\n\nGet the BuzzFeed App: http://bzfd.it/bfmobileapps",parent_id:"share-buttons-quiz",category:"MobileBuzz:sharing-quiz",action:$(this).data("action"),label:bf_quiz.GALabel(a)};Share.email(m)})}else{sharing.buttons.facebook_share({parentNode:g.el,url:g.buzz_uri,blurb:g.fb_blurb,picture:g.picture,title:g.fb_title,gt_label:bf_quiz.GALabel(a),pound_no_track:g.pound_no_track});sharing.buttons.twitter({parentNode:g.el,url:g.buzz_uri,blurb:bfjs.stripTags(g.tw_blurb),hashtags:g.tw_hashtags,via:g.tw_via,gt_label:bf_quiz.GALabel(a),pound_no_track:g.pound_no_track});sharing.buttons.email({method:"mailto",parentNode:g.el,subject:bfjs.stripTags(g.email_subject),body:bfjs.stripTags(g.email_body),gt_label:bf_quiz.GALabel(a),pound_no_track:g.pound_no_track});if(a.type!="poll"){sharing.buttons.pinterest({parentNode:g.el,quiz_result:true,url:g.buzz_uri,media:g.picture,description:bfjs.stripTags(g.pin_description),gt_label:bf_quiz.GALabel(a),pound_no_track:g.pound_no_track});sharing.buttons.tumblr({parentNode:g.el,url:g.buzz_uri,name:g.tumblr_name,description:g.tumblr_description,gt_label:bf_quiz.GALabel(a),pound_no_track:g.pound_no_track})}}}catch(c){console.error(c)}};this.gaTrack=function(a,b,c){if(typeof gtrack!=="undefined"){gtrack.track_events(a,b,c)}else{switch(BF_STATIC.os){case"ios":var e=$("<iframe />").attr("src","bf://analytics?category=MobileBuzz:content&action=click:"+b+"&label="+c).hide().on("load",function(){e.remove()});$("body").append(e);break;case"android":var d={category:"MobileBuzz:content",action:"click:"+b,label:c};bf.analytics("",JSON.stringify(d));break}}};this.isLegacyApp=function(){var e=false;if(BF_STATIC.mobile_app){switch(BF_STATIC.os){case"ios":var c=navigator.userAgent.toLowerCase(),a=/(buzzfeed\/)([^\s]+)/,b=33000,f,d;d=a.exec(c);f=(d)?parseInt(d[2]):0;e=f<=b;break;case"android":e=typeof buzzshare!=="undefined";break}}return e};this.submit_bff_quiz=function(e,d){var c,b={};var a=$(d.bff_quiz_form[0])[bfjs.read_attr](bfjs.gtrack_cat);if(bf_quiz.bff_quiz_create_validates(d,e)){if(d.type==="bff_create"){bf_quiz.bff_disable_form(d.bff_quiz_form[0]);d.bff_quiz_id=bf_quiz.create_bff_quiz_id();d.bff_quiz_creator_name=e.submit_name.replace(/(<([^>]+)>)/ig,"");c={bff_id:d.bff_quiz_id,bff_name:d.bff_quiz_creator_name,bff_key:d.answer_positions};bf_quiz.gaTrack(a,"[nc]submit:name","");bf_quiz.bff_quiz_create_url(d.bff_clone,c,function(h,g){var f=$(d.bff_quiz_create_results[0])[bfjs.selector](".js-bff_quiz_create_url").first();d.bff_quiz_url=h;bf_quiz.bff_quiz_name_replace(d,d.bff_quiz_creator_name);f[bfjs.update_html](h);f[bfjs.write_attr]("href",h);$(d.bff_quiz_form[0])[bfjs.add_class]("bff-quiz__form--hidden");bf_quiz.submit_quiz(d)})}}};this.bff_disable_form=function(b){var a=$(b)[bfjs.selector]("input, button");$(b)[bfjs.add_class]("bff-quiz__form--disabled");bfjs.universal_each(a,function(c){$(c)[bfjs.write_attr]("disabled","true")})};this.bff_enable_form=function(b){var a=$(b)[bfjs.selector]("input, button");$(b)[bfjs.remove_class]("bff-quiz__form--disabled");bfjs.universal_each(a,function(c){$(c)[bfjs.write_attr]("disabled","false")})};this.create_bff_quiz_id=function(){var a=new Date();return a.getTime().toString()};this.bff_quiz_all_answered=function(a){return bf_quiz.number_selected(a)===parseInt(a.question_count,10)};this.bff_quiz_create_validates=function(b,c){$(b.bff_quiz_error[0])[bfjs.add_class]("bff-quiz__error--hidden");var a="";if(typeof c.submit_name==="undefined"||!c.submit_name.length){a+="<span class='bff-quiz__error-message'>Please enter a name</span>"}if(!bf_quiz.bff_quiz_all_answered(b)){a+="<span class='bff-quiz__error-message'>Please answer all questions</span>"}if(typeof c.submit_name!=="undefined"&&c.submit_name.length>50){a+="<span class='bff-quiz__error-message'>Name is too long</span>"}if(a.length){$(b.bff_quiz_error[0])[bfjs.remove_class]("bff-quiz__error--hidden");$(b.bff_quiz_error[0])[bfjs.update_html](a)}return !a.length};this.bff_quiz_create_url=function(k,d,e){var c,j="";var h="";var b="/buzzfeed/_short_url";var g="json";var f="get";c=Base64.encode(JSON.stringify(d));if(k!==""){j=window.location.protocol+"//"+window.location.hostname+k+"?bff_data="+c}else{j=window.location.protocol+"//"+window.location.hostname+window.location.pathname+"?bff_data="+c}h={url:j,action:"direct"};var a=setTimeout(function(){return e(j,"Shorten service not available; returning original URL")},30*1000);if(bfjs.isMobile()){jQuery.ajax({dataType:g,url:b,data:h,success:function(l){clearTimeout(a);var m=l;if(m.short_url.data.url){shareurl=m.short_url.data.url;return e(shareurl,l)}},fail:function(l){clearTimeout(a);return e(j,"Shorten service not available; returning original URL")}})}else{new Ajax.Request(b,{method:f,dataType:g,parameters:h,onSuccess:function(l){clearTimeout(a);var m=l.responseText.evalJSON();if(m.short_url.data.url){shareurl=m.short_url.data.url;return e(shareurl,l)}},onFailure:function(l){clearTimeout(a);return e(j,"Shorten service not available; returning original URL")}})}};this.bff_quiz_post_leaderboard=function(c,a){var f=encodeURI(c.name);var e="http://"+BF_STATIC.mango_host;var b=e+"/quiz/service/leaderboard/post?quiz_id="+c.quiz_id+"&score="+c.score+"&name="+f;var d=setTimeout(function(){return a(false)},30*1000);bfjs.loadJSONP(b,function(g){clearTimeout(d);return a(g)})};this.bff_quiz_get_leaderboard=function(b,a){var e="http://"+BF_STATIC.mango_host;var c=e+"/quiz/service/leaderboard/get/"+b;var d=setTimeout(function(){return a(false)},30*1000);bfjs.loadJSONP(c,function(f){if(f.hasOwnProperty("success")&&!f.success){clearTimeout(d);return a(false)}else{if(f.hasOwnProperty("success")&&f.hasOwnProperty("data")&&f.success){clearTimeout(d);bfjs.universal_each(f.data,function(g){if(g.hasOwnProperty("name")){g.name=decodeURI(g.name)}});return a(bf_quiz.bff_quiz_extract_leaderboard(f.data))}}})};this.bff_quiz_takeover_answers=function(f,a){var d=f;if(parseInt(d.question_count,10)===a.length){for(var c in d.questions){if(d.questions.hasOwnProperty(c)){for(var b=0;b<d.questions[c]["answers"].length;b++){var e=d.questions[c]["answers"];if(b===a[c]){$(e[b])[bfjs.write_attr]("rel:correct",1)}else{$(e[b])[bfjs.write_attr]("rel:correct",0)}}}}}return true};this.bff_quiz_extract_leaderboard=function(c){var b=[];for(var a=c.length-1;a>=0;a--){if(c[a].hasOwnProperty("score")){b.push({name:c[a]["name"],score:c[a]["score"]})}}return b};this.bff_quiz_build_leaderboard=function(h,e){var k="";var a=0;var f=20;var g=$(h);var b=g[bfjs.selector](".js-bff-leaderboard__container");var j=g[bfjs.selector](".js-bff-leaderboard__reveal");var c="";var d=false;if(!b.length){console.error(".js-bff-leaderboard__container cannot be found!");return false}e.sort(function(m,l){if(m.score>l.score){return -1}if(m.score<l.score){return 1}return 0});d=(e.length>5)?g[bfjs.selector](".js-bff-leaderboard__show"):false;bfjs.universal_each(e,function(m,l){if(l<f){var n=l+1;c+=bf_quiz.bff_quiz_build_player(m,n)}});if(j.length){$(j[0])[bfjs.remove_class]("hidden");$(j[0])[bfjs.observer]("click",function(l){l.preventDefault();bf_quiz.bff_quiz_show_leaderboard(g);$(this)[bfjs.add_class]("hidden");window.setTimeout(function(){bf_quiz.bff_quiz_animate_leaderboard(b[0])},200)})}if(d.length){$(d[0])[bfjs.observer]("click",function(n){var m=$(this);var o=$(m[bfjs.selector](".js-bff-leaderboard__show-text"));var l="";n.preventDefault();if(m[bfjs.has_class]("bff-leaderboard__show--more")){m[bfjs.add_class]("bff-leaderboard__show--less");m[bfjs.remove_class]("bff-leaderboard__show--more");bf_quiz.bff_quiz_show_more_leaderboard(b[0]);bf_quiz.bff_quiz_animate_leaderboard(b[0])}else{m[bfjs.remove_class]("bff-leaderboard__show--less");m[bfjs.add_class]("bff-leaderboard__show--more");bf_quiz.bff_quiz_show_less_leaderboard(b[0])}if(o.length){l=$(o[0])[bfjs.read_attr]("rel:message");$(o[0])[bfjs.write_attr]("rel:message",o[0].innerHTML);$(o[0])[bfjs.update_html](l)}})}$(b[0])[bfjs.update_html](c);return true};this.bff_quiz_show_leaderboard=function(b){var c=$(b)[bfjs.selector](".js-bff-leaderboard__container");var d=$(b)[bfjs.selector](".js-bff-leaderboard__show");var a=$(b)[bfjs.selector](".js-bff-leaderboard__player-container");if(c.length){$(c[0])[bfjs.remove_class]("bff-leaderboard__container--hidden")}if(d.length&&a.length>5){$(d[0])[bfjs.remove_class]("bff-leaderboard__show--hidden")}};this.bff_quiz_animate_leaderboard=function(a){var c=$(a);var d=0;var b=100;bfjs.universal_each($(a)[bfjs.selector](".js-bff-leaderboard__player-container:not(.bff-leaderboard__player-container--wipe-effect-on):not(.hidden)"),function(f,e){window.setTimeout(function(){$(f)[bfjs.add_class]("bff-leaderboard__player-container--wipe-effect-on")},d);d+=b})};this.bff_quiz_show_more_leaderboard=function(a){bfjs.universal_each($(a)[bfjs.selector](".js-bff-leaderboard__player-container.hidden"),function(c,b){$(c)[bfjs.remove_class]("hidden")})};this.bff_quiz_show_less_leaderboard=function(a){bfjs.universal_each($(a)[bfjs.selector](".js-bff-leaderboard__player-container"),function(c,b){if(b>4){$(c)[bfjs.add_class]("hidden")}})};this.bff_quiz_add_to_leaderboard=function(f,h,j){var a=$(f)[bfjs.selector](".js-bff-leaderboard__container");var d;var b=1;var c="";var g=false;var e=5;if(a.length){d=$(a[0])[bfjs.selector](".js-bff-leaderboard__player-container");if(d.length===0){a[0].innerHTML=bf_quiz.bff_quiz_build_player(j,1)+a[0].innerHTML;return}else{bfjs.universal_each(d,function(m,l){var n=$(m);var o=n[bfjs.selector](".bff-leaderboard__player-position")[0];var k=parseInt(n[bfjs.read_attr]("rel:leaderboarder-score"),10);if(j.score>=k&&!g&&(e>=b)){c=bf_quiz.bff_quiz_build_player(j,b);m.insertAdjacentHTML("beforebegin",c);b++;g=true}n[bfjs.write_attr]("rel:leaderboard-position",b);$(o)[bfjs.update_html](b);b++});if(!g&&d.length<e){c=bf_quiz.bff_quiz_build_player(j,b);d[d.length-1].insertAdjacentHTML("afterend",c)}else{if(!g&&d.length>=e){c=bf_quiz.bff_quiz_build_player(j);d[0].insertAdjacentHTML("beforebegin",c)}}}}};this.bff_quiz_build_player=function(c,a){var b="";var d=(typeof a==="undefined"?"bff-leaderboard__player-container--new":(a>5?"hidden":""));a=(typeof a==="undefined"?"":a);b+="<div rel:leaderboard-position="+a+"  rel:leaderboarder-score="+c.score+' class="js-bff-leaderboard__player-container bff-leaderboard__player-container  bff-leaderboard__player-container--wipe-effect '+d+'">';b+='<span class="bff-leaderboard__player-position">'+a+"</span>";b+='<span class="bff-leaderboard__player-name">'+c.name+"</span>";b+='<span class="bff-leaderboard__player-score">'+c.score+"</span>";b+="</div>";return b};this.bff_quiz_retrieve_player_name=function(a){var b,c;var d=setTimeout(function(){return a(false)},120*1000);FB.getLoginStatus(function(e){if(e.status==="connected"){clearTimeout(d);FB.api("/me",function(f){if(f&&!f.error){return a(f.first_name+" "+f.last_name.slice(0,1)+".")}else{return a(false)}})}else{FB.login(function(f){FB.api("/me",function(g){clearTimeout(d);if(g&&!g.error){return a(g.first_name+" "+g.last_name.slice(0,1)+".")}else{return a(false)}})})}})};this.bff_quiz_name_replace=function(d,a){var b=document.createElement("div");var c=$(d.el)[bfjs.selector](".js-bff-quiz_name-replace, .quiz_tally_results h2");var f="";if(bfjs.isMobile()){f=$(document.body)[bfjs.selector]("#buzz_sub_buzz .buzz_superlist_item_image .sub_buzz_media")}else{f=$(document.body)[bfjs.selector]("#buzz_sub_buzz .buzz_superlist_item_image")}bfjs.universal_each(c,function(g){g.innerHTML=g.innerHTML.replace("#{name}",a)});if(d.type==="bff_take"){var e=$(document.body)[bfjs.selector](".bff-quiz__create-title--take");if(e.length){$(e[0])[bfjs.remove_class]("bff-quiz__create-title--take-hidden")}if(f.length){f[0].appendChild(e[0])}}};this.bff_quiz_observe_form=function(c){var b;var a;c.bff_quiz_form.first()[bfjs.observer]("submit",function(f){b=this.elements;a={};f.preventDefault();for(var d=b.length-1;d>=0;d--){if(b[d].name&&b[d].value){a[b[d].name]=b[d].value.trim()}}bf_quiz.submit_bff_quiz(a,c)})};this.bff_quiz_observe_fb_signin=function(a){$(a.bff_quiz_leaderboard_facebook_sign__button[0])[bfjs.observer]("click",function(d){d.preventDefault();var b=$(this);var c=$(a.bff_quiz_leaderboard_facebook_sign[0]);if(b[bfjs.has_class]("bff-leaderboard-facebook-sign__button--waiting")){return false}b[bfjs.add_class]("bff-leaderboard-facebook-sign__button--waiting");bf_quiz.bff_quiz_retrieve_player_name(function(e){if(e){var g=parseInt(bf_quiz.number_correct(a),10);var f={quiz_id:a.bff_quiz_id,name:e,score:g};bf_quiz.gaTrack("playstation_bbf","[nc]submit:facebook-sign-in");c[bfjs.add_class]("bff-leaderboard-facebook-sign--hidden");bf_quiz.bff_quiz_post_leaderboard(f,function(h){bfjs.universal_each(a.bff_quiz_leaderboard,function(j){if($(j)[bfjs.has_class]("bff-leaderboard--bottom")){bf_quiz.bff_quiz_add_to_leaderboard(j,a.bff_quiz_leaderboard_data,f);window.setTimeout(function(){bf_quiz.bff_quiz_animate_leaderboard(j)},500)}});a.bff_quiz_leaderboard_data.push(f)})}b[bfjs.remove_class]("bff-leaderboard-facebook-sign__button--waiting")})})};this.bff_quiz_build_take_quiz=function(d){var a=bfjs.getUrlVars();var c,b={};if(a.hasOwnProperty("bff_data")){try{b=JSON.parse(Base64.decode(a.bff_data));d.bff_quiz_creator_name=b.bff_name;d.bff_quiz_id=b.bff_id;d.bff_quiz_answer_key=b.bff_key;c={bff_id:d.bff_quiz_id,bff_name:d.bff_quiz_creator_name,bff_key:d.bff_quiz_answer_key}}catch(f){window.location=d.bff_clone;console.log(f);return}bf_quiz.bff_quiz_name_replace(d,d.bff_quiz_creator_name);bf_quiz.bff_quiz_takeover_answers(d,d.bff_quiz_answer_key);bf_quiz.bff_quiz_create_url("",c,function(e){d.bff_quiz_url=e;bf_quiz.bff_quiz_takeover_default_shares(d)});bf_quiz.bff_quiz_get_leaderboard(d.bff_quiz_id,function(e){if(e){d.bff_quiz_leaderboard_data=e;if(d.bff_quiz_leaderboard_data.length){bfjs.universal_each(d.bff_quiz_leaderboard,function(g){bf_quiz.bff_quiz_build_leaderboard(g,d.bff_quiz_leaderboard_data)})}}})}else{window.location=d.bff_clone}};this.bff_quiz_takeover_default_shares=function(c){var h="Take this quiz to see how well you really know "+c.bff_quiz_creator_name+".";var g="How well do you know "+c.bff_quiz_creator_name+"?";var m=c.bff_quiz_url;var d="Playstation";var f=c.pound_no_track;if(bfjs.isMobile()){var k=$(".share-buttons .fb-share-dialog a, .js-action-bar__btn--facebook");var o=$(".share-buttons .tweet_btn a, .js-action-bar__btn--twitter");var n=$(".share-buttons .pin a, .js-action-bar__btn--pinterest");var a=$(".share-buttons .email a, .js-action-bar__btn--email");var e=$(".share-buttons .whatsapp a");var b=$(".share-buttons .tumblr a");var j=(document.URL.indexOf("https://")==0?"https://":"http://")+document.domain+"/static/html/fb-redirect.html";$(".js-action-bar--fixed").hide();k.each(function(p,q){$(q).data("name",g);$(q).data("url",m);$(q).data("description",h);$(q).data("pound_no_track",true);$(q).data("redirect_uri",j)});o.each(function(p,q){$(q).data("text",g);$(q).data("url",m);$(q).data("pound_no_track",true)});n.each(function(p,q){$(q).data("description",g);$(q).data("url",m);$(q).data("pound_no_track",true)});a.each(function(p,q){$(q).data("text",g);$(q).data("url",m);$(q).data("legacy-url",m);$(q).data("pound_no_track",true)});e.each(function(p,q){$(q).attr("href","whatsapp://send?text="+encodeURIComponent(h)+"%20"+encodeURIComponent(m));$(q).data("pound_no_track",true)});b.each(function(p,q){$(q).attr("href","http://www.tumblr.com/share/link?url="+encodeURIComponent(m)+"&name="+encodeURIComponent(g)+"&description="+encodeURIComponent(h));$(q).data("pound_no_track",true)})}else{var l=$(document.body)[bfjs.selector]("#share_control .horizontal-share-buttons, .bottom_shares.square_shares");if(l.length){bfjs.universal_each(l,function(p){p.innerHTML="";sharing.buttons.facebook_share({parentNode:p,url:m,blurb:h,title:g,pound_no_track:f});sharing.buttons.twitter({parentNode:p,url:m,blurb:h,via:d,pound_no_track:f});sharing.buttons.email({parentNode:p,url:m,body:h+"\n\n "+m,subject:g,method:"mailto",pound_no_track:f});sharing.buttons.pinterest({parentNode:p,url:m,blurb:h,title:g,pound_no_track:f})})}}};this.bff_quiz_retrieve_info=function(h,l){var k={};var e=false;var d=$(l)[bfjs.read_attr]("rel:bff_clone"),b=$(l)[bfjs.selector](".js-bff-quiz__form"),g=$(l)[bfjs.selector](".js-bff-quiz__error"),c=$(l)[bfjs.selector](".js-bff-quiz__create-results"),f=$(l)[bfjs.selector](".js-bff-leaderboard"),j=$(l)[bfjs.selector](".js-leaderboard-facebook-sign");bff_quiz_leaderboard_facebook_sign__button=$(l)[bfjs.selector](".js-leaderboard-facebook-sign__button");h.pound_no_track=true;k.bff_quiz_id="";k.bff_quiz_leaderboard_data=[];k.bff_quiz_leaderboard_limit=20;k.bff_quiz_answer_key=[];k.bff_clone=((d===null)||(d==="")||(typeof d==="undefined"))?{error:"Quiz clone URL (Maker/Taker) doesn't exist"}:d;if(h.type==="bff_create"){k.bff_quiz_form=b.length?b:{error:"Creator form element .js-bff-quiz__form doesn't exist"};k.bff_quiz_error=g.length?g:{error:"Creator form error box .js-bff-quiz__error doesn't exist"};k.bff_quiz_create_results=c.length?c:{error:"Creator results .bff_quiz_create_results doesn't exist"}}else{if(h.type==="bff_take"){k.bff_quiz_leaderboard=f.length===2?f:{error:"Need exactly two leaderboards (.js-bff-leaderboard) elements"};k.bff_quiz_leaderboard_facebook_sign=j.length?j:{error:"Taker facebook button element does not exist (.js-leaderboard-facebook-sign)"};k.bff_quiz_leaderboard_facebook_sign__button=bff_quiz_leaderboard_facebook_sign__button.length?bff_quiz_leaderboard_facebook_sign__button:{error:"Taker facebook button element does not exist (.js-leaderboard-facebook-sign__button)"}}}for(var a in k){if(k.hasOwnProperty(a)){if(k[a].hasOwnProperty("error")){console.error(k[a]["error"]);e=true}}}return e?false:k}};var bf_quiz=new BF_Quiz();bfjs.onPageLoad(bf_quiz.init);BF_Related=function(){this.related_links_controller="/buzzfeed/_related_links";this.init=function(){if(!acl.user_can("general_admin")){return}related.assign_handlers()};this.assign_handlers=function(){universal_dom.assign_handler({bucket:"update-related",handler:related.update_related,event:"click"});universal_dom.assign_handler({bucket:"related-cancel",handler:related.related_cancel,event:"click"});universal_dom.assign_handler({bucket:"related-save",handler:related.save_related,event:"click"})};this.update_related=function(args){if(args.buzz_id){var dialog=$$(".update_related")[0];var dialogWidth=dialog.getWidth();var dialogHeight=dialog.getHeight();var topPos=args.clientY;related.show_body_overlay();dialog.show();if((topPos+dialogHeight)>BF_UTIL.browser.dimensions.height()){topPos=BF_UTIL.browser.dimensions.height()-dialogHeight}dialog.setStyle({left:args.clientX+"px",top:topPos+"px",position:"fixed"})}else{console.log("update_related: Invalid buzz id")}};this.related_cancel=function(){if($("bodyOverlay")){document.body.removeChild($("bodyOverlay"))}$("save_spinner").hide();var dialog=$$(".update_related")[0];dialog.hide()};this.show_body_overlay=function(){var bodyHeight=document.body.getHeight();var bodyWidth=document.body.getWidth();if(!$("bodyOverlay")){var overlay=document.createElement("div");overlay.setAttribute("id","bodyOverlay");overlay.setStyle({width:bodyWidth+"px",height:bodyHeight+"px"});document.body.appendChild(overlay)}};this.save_related=function(args){if(args.buzz_id){$("save_spinner").show();var newRelated=new Array();var related_input=$$(".related_input");for(var i=related_input.length;i>=1;i--){if($("related"+i)!=undefined&&$("related"+i).value!==undefined&&$("related"+i).value!=""){newRelated.push($("related"+i).value)}}var params={action:"validate_and_save",campaignid:args.buzz_id,related_urls:JSON.stringify(newRelated)};(new BF_Request()).request("/buzzfeed/_related_links",{method:"get",parameters:params,onSuccess:function(r){var obj=eval("("+r.responseText+")");console.log(obj.number);if(obj.success==0){related.error(obj.message)}else{if(obj.number==0){related.error("No urls could be validated. Must be buzzfeed.com links.")}else{if(newRelated.length>obj.number){related.error("Only "+obj.number+" out of "+newRelated.length+" urls could be validated.")}}}related.related_cancel()},onFailure:function(r){var obj=eval("("+r.responseText+")");related.error(obj.message||"save_related: validate and save failure")}})}else{console.log("save_related: Invalid buzz id")}};this.error=function(message){console.log("related.error");(new BF_Request()).alert(message)}};var related=new BF_Related();BuzzLoader.register(function(){related.init()},2);var BF_user_page=function(){this.init=function(){user_page.resize_embeds()};this.resize_embeds=function(){if(BF_STATIC.tt_page=="User"){$$(".buzz_superlist_item_embed").each(function(c){var b=c.select("iframe")[0];if(b){var d=b.getAttribute("height");var e=b.getAttribute("width");if(e>625){b.setAttribute("width",625);var a=(625/e);d=Math.floor(d*a);b.setAttribute("height",d)}}})}}};var user_page=new BF_user_page();BuzzLoader.register(user_page.init,5);var BF_bpage=function(){this.lastScrollPos=0;this.more_loaded=false;var a=10,b="bf_recently_viewed_bpages";this.init=function(){if((new BF_User()).isLoggedIn()&&$("longform_header_wrapper")&&$("longform_header_wrapper_height")&&BF_STATIC.tt_page!=="WeekendOff"){$("longform_header_wrapper").addClassName("longform-header-top");$("longform_header_wrapper_height").addClassName("longform-header-height")}if(hasLocalStorage()&&!BF_STATIC.hp_type){var p=localStorage.getItem(b),j=$$('meta[property="article:section"]'),n=$$('meta[property="bf:buzzid"]'),o=n.length?n[0].readAttribute("content"):null,k;j=j&&j[0].readAttribute("content");if(o&&j!=="Advertiser"){p=p?JSON.parse(p):[];if(~(k=p.indexOf(o))){p.splice(k,1)}else{if(p.length>=a){p.splice(0,1)}}p.push(o);localStorage.setItem(b,JSON.stringify(p))}}if($$(".graphic_image_wrapper")[0]){$$(".graphic_image_wrapper").each(function(q){bpage.set_box_blur(q)})}universal_dom.assign_handler({bucket:"bpage_tweet",event:"click",handler:bpage.tweet});universal_dom.assign_handler({bucket:"more_shares",event:"mouseover",handler:bpage.load_more_shares});universal_dom.assign_handler({bucket:"share_link",event:"click",handler:bpage.copy_link});universal_dom.assign_handler({bucket:"pinterest",event:"click",handler:bpage.pinterest});universal_dom.assign_handler({bucket:"sticky_popup_button",event:"click",handler:bpage.hide_other_popups});universal_dom.assign_handler({bucket:"print_btn",event:"click",handler:bpage.show_popup});universal_dom.assign_handler({bucket:"toggleBreakingSummary",event:"click",handler:bpage.toggleBreakingSummary});bpage.update_bottom_shares();bpage.dedupe_buzz();bpage.update_upper_shares();bpage.arrange_badges();bpage.loadSummary();var h=abtest.abVariations.split(",");if(h.indexOf("promo_var_1")!=-1){console.log(h.indexOf("promo_var_1"))}if(h.indexOf("promo_var_1")!=-1){if($("bpage-bottom-dfp")){$("bpage-bottom-dfp").removeClassName("bpage-lower-dfp");var c=$("bpage-bottom-dfp").select(".bf-image-big")[0];c.width=125;c.height=83}}var f=abtest.abVariations.split(","),e=["sharing_vertical","sharing_ref"],m,l;bpage.show_dfp(f);if(f.intersect(e)[0]!=undefined){var g=f.intersect(e)[0];if(g=="sharing_ref"){$(g).select(".share_div").each(function(q){if(!q.hasClassName("hidden")){m=q.select("#link_parent")[0];l=q.select(".link_bottom")[0]}})}else{if(g=="sharing_vertical"){m=$(g).select("#link_parent")[0];l=$(g).select(".link_bottom")[0]}}}if(f.indexOf("related_two")!=-1){bpage.related_img_reset()}if(f.indexOf("related_two")!=-1){var d=$("related_two").select(".subbuzzpromo li")[3];if(d){d.removeClassName("hidden")}}EventManager.observe("badge_vote:vote_init",function(q){bpage.custom_badge_vote(q)});if(BF_STATIC.tt_page=="Buzz"){Event.observe(window,"scroll",function(s){var q=$$(".page-footer")[0].viewportOffset().top+100;if((q<document.viewport.getHeight())&&!bpage.more_loaded){bpage._more_stuff_init()}})}if(typeof(BF_KeyControls)=="function"){bpage.keycontrols()}bpage.dedupe_sidebar();bpage.hide_indepth_buzz();bpage.load_hot_on_pinterest()};this.show_popup=function(){window.print()};this.referrer=function(c){var d=null;if(BF_STATIC.bf_test_mode){if(window.location.href.match("referrer=pinterest")){d="pinterest"}else{if(window.location.href.match("referrer=twitter")){d="tweet"}}}else{if(document.referrer.match("pinterest")){d="pinterest"}else{if(document.referrer.match("t.co")){d="tweet"}}}return d};this.update_bottom_shares=function(){if(!$$(".bottom_shares .shareBtn").length){setTimeout(function(){bpage.update_bottom_shares()},250);return}var g=$$(".bottom_shares").first();var e=$$(".bottom_shares .referrer_shares .shareBtn");var c=$$(".bottom_shares .vertical_shares .shareBtn");var m=$$(".bottom_shares .other_shares .shareBtn");var f=$$(".bottom_shares #more_shares_box .shareBtn");var h=bpage.referrer();var k=(h)?h+"_share":null;var d=objExists(BF_STATIC.vertical)?BF_STATIC.vertical:"";var l=$("buzz_sub_buzz")&&$("buzz_sub_buzz").hasClassName("suplist_long")?true:false;var j=[];if(!e||!c||!g){return false}if(g.hasClassName("hidden")){g.removeClassName("hidden")}e.each(function(o){var q=$(o).findParent("div"),n=null;if(q){if(h){n=k}else{n="fb_share"}$(q).hasClassName(n)?j.push(n):$(q).remove()}});c.each(function(o){var q=$(o).findParent("div"),n=null;if(q){if(k=="pinterest_share"||k=="tweet_share"){n="fb_share"}else{n="tweet_share"}$(q).hasClassName(n)?j.push(n):$(q).remove()}});m.each(function(n){var o=$(n).findParent("div");if(o&&k){if($(o).hasClassName(k)){$(o).remove()}}});bpage.remove_dupe_shares(f,j)};this.remove_dupe_shares=function(c,d){d.each(function(e){c.each(function(g){var f=$(g).findParent("div");if($(f).hasClassName(e)){$(f).remove()}})})};this.copy_link=function(k){var f=k.element;if(!f){return false}if($("shares-copy-link").visible()){$("shares-copy-link").hide();if(typeof bf_rdio!="undefined"){bf_rdio.enable()}return false}var j=$(f).getAttribute("rel:link");var d={left:Number($(f).positionedOffset()[0]),top:Number($(f).positionedOffset()[1]),height:Number($(f).getHeight()),width:Number($(f).getWidth())};var g={width:300};var h={height:10,width:10};var c=$$("#shares-copy-link .arrow");$(f).insert({after:$("shares-copy-link")});$("shares-copy-link").setStyle({left:(d.left-(g.width/2))+"px",top:(d.top+d.height+(h.height/2))+"px"});c.each(function(e,l){$(e).setStyle({left:(175-h.width+l)+"px",top:(l-h.height)+"px"})});$$("#shares-copy-link input")[0].setAttribute("value",j);$("shares-copy-link").show();Selector.findChildElements($("shares-copy-link"),["input"])[0].select();if(typeof bf_rdio!="undefined"){bf_rdio.disable()}BF_Effect.ScrollIntoView("shares-copy-link")};this.dedupe_buzz=function(){var e=$$('meta[property="bf:buzzid"]'),c=e.length?e[0].readAttribute("content"):null;if(c){$$(".sidebar_featured_unit .small-posts").each(function(f){if($(f).hasAttribute("rel:buzz_id")){if($(f).getAttribute("rel:buzz_id")==c){$(f).remove()}}});if($("next_on_1")){if($("next_on_1").hasAttribute("rel:buzz_id")){var d=$("next_on_1").readAttribute("rel:buzz_id");if(c==d){if($("next_on_1")){$("next_on_1").hide()}if($("next_on_2")){$("next_on_2").show()}}}}}};this.update_upper_shares=function(){var e=bpage.referrer(),c=$("pin_ref"),d=$("tweet_ref"),f=$("share_control");if(!c||!f){return}if(e=="pinterest"){c.removeClassName("hidden");f.addClassName("hidden")}else{if(e=="tweet"){d.removeClassName("hidden");f.addClassName("hidden")}else{if(!c.hasClassName("hidden")){c.addClassName("hidden")}if(f.hasClassName("hidden")){f.removeClassName("hidden")}}}};this.tweet=function(g){data=g.target;var d=g.target.getAttribute("rel:tw_url");var h=escape(g.target.getAttribute("rel:tw_text"));var c=g.target.getAttribute("rel:tw_via");var f="http://twitter.com/intent/tweet?url="+d+"&text="+h+"&via="+c;window.open(f,"_blank","width=600, height=300")};this.pinterest=function(u){var w=function(y,z){var x=200;var A=200;var e="";if(y>z){x=y/(z/200);e="margin-left: "+(0-(x-200)/2)+"px"}else{if(y<z){A=z/(y/200);e="margin-top: "+(0-(A-200)/2)+"px"}}return{img_width:x,img_height:A,img_style:e}};var q=function(){var e=document.createElement("SPAN");e.addClassName("pin_image");e.innerHTML='<span class="loading_pin_image"></span>';return e};var h=function(x){var e=0,y=0;e=x.naturalWidth;y=x.naturalHeight;return{w:e,h:y}};var f=function(F,B,H,x,E,z,G,C,e,y,A){var D=new Template($("pin_img_template").innerHTML);return D.evaluate({img_style:F,img_src:B,img_width:H,img_height:x,img_n_width:E,img_n_height:z,ieheight:G,scroll_pos:C,url:e,media:y,desc:A})};bpage.lastScrollPos=$(document.viewport).getScrollOffsets().top;window.scrollTo(0,0);var o=BF_UTIL.document.height();$("pin_bg").setStyle({height:o+"px"});$("pin_bd").setStyle({height:o+"px"});if(typeof u!="undefined"&&typeof u.target!="undefined"){if(typeof u.target.up(".upper-share-buttons")!="undefined"){$("pin_bd").setAttribute("rel:gt_cat","[ttp]:sharing-upper/pioverlay")}if(typeof u.target.up(".bottom-share-buttons")!="undefined"){$("pin_bd").setAttribute("rel:gt_cat","[ttp]:sharing-bottom/pioverlay")}}document.body.appendChild($("pin_bg").show());document.body.appendChild($("pin_bd").show());var g=BF_STATIC.page="Videos"&&typeof videopromo!="undefined"?videopromo:$("post-"+BF_STATIC.campaignid).readAttribute("rel:data").evalJSON();var j=undefined;if(typeof BF_STATIC.pound_enabled!="undefined"&&BF_STATIC.pound_enabled){j=pound.urls.queryStringOnly()}else{if(BF_STATIC.tt_page=="Videos"&&videopromo!=undefined&&videopromo.uri){j="http://www.buzzfeed.com/"+videopromo.uri}else{j="http://www.buzzfeed.com/"+BF_STATIC.username+"/"+g.uri}}if($("pin_img_container").innerHTML){$("pin_img_container").innerHTML=""}var t=Prototype.Browser.IE?636:336;var k=$s("title").innerHTML.replace(/'/g,"%27").replaceAll("&nbsp;"," ").unescapeHTML().stripTags().trim();var n=function(e,y,x){e.remove()};var d=function(){if($("pin_bg")){$("pin_bg").hide()}if($("pin_bd")){$("pin_bd").hide()}};var p=function(e,C,y,B){var D=h(this);var z=w(D.w,D.h);var F=z.img_width,x=z.img_height,E=z.img_style;var A=f(E,C,F,x,D.w,D.h,t,bpage.lastScrollPos,y,C,B);e.innerHTML=A.replaceAll("&lt;","<").replaceAll("&gt;",">");if(typeof BF_STATIC.pound_enabled!="undefined"&&BF_STATIC.pound_enabled){if(e.select("a").length){e.select("a")[0].observe("click",d)}}};var l=$$(".buzz_superlist_item_image,.buzz_superlist_item_grid_row,.buzz_superlist_item_video.video_instagram,.buzz_superlist_item_photoslider,#optimized_image_wrapper");if(l.length&&BF_STATIC.page!="Videos"){l.each(function(y){var e,x;var z=y.id;if(z){e=z.split("superlist_")[1];y=y.select("img")}if(j.indexOf("?")>-1){x=encodeURIComponent(j+(e?"&sub="+e:""))}else{x=encodeURIComponent(j+(e?"?sub="+e:""))}y.each(function(C){if(typeof C.up(".catcha_service")!="undefined"){return}var D="";var B=q();$("pin_img_container").appendChild(B);var A=new Image();A.onload=function(){var F=z?C.readAttribute("rel:bf_image_src"):$$('link[rel="image_src"]')[0].href;if(C.up(".buzz_superlist_item")&&C.up(".buzz_superlist_item").select("h2").length){var E=Element.clone(C.up(".buzz_superlist_item").select("h2")[0],true);if(E.select("span.buzz_superlist_number_inline").length){E.select("span.buzz_superlist_number_inline")[0].remove()}D=E.innerHTML.stripTags().unescapeHTML().trim()}if(k){D=D?D+" | "+k:k}if(C.hasAttribute("rel:bf_image_desc")){D=C.readAttribute("rel:bf_image_desc")}D=encodeURIComponent(D);p.apply(this,[B,F,x,D])};A.onabort=n.bind(null,B,m,1);A.onerror=n.bind(null,B,m,2);if(C.readAttribute("rel:bf_image_src")){A.src=C.readAttribute("rel:bf_image_src")}else{A.src=C.src}})})}else{var m=BF_STATIC.big_image_root+"/static/images/global/buzzfeed-logo.png";if($$('meta[property="og:image"]').length>0){m=$$('meta[property="og:image"]')[0].attributes.content.value}if(BF_STATIC.tt_page=="Videos"){m=videopromo.promo_image}var c=q();$("pin_img_container").appendChild(c);var s=new Image();s.onload=function(){p.apply(this,[c,m,encodeURIComponent(j),encodeURIComponent(k)])};s.onabort=n.bind(null,c,m,1);s.onerror=n.bind(null,c,m,2);s.src=m}};this.related_img_reset=function(){var f=$$(".related_var_2 .subbuzzpromo li.wide")[0];var d=f.select("img")[0];var e=d.getAttribute("src");var c=e.replace("_wide.jpg",".jpg");d.setAttribute("src",c)};this.show_dfp=function(d){var e=["related_control","related_one","related_two"];var c=d.intersect(e)[0];if(c=="related_two"){if($("related_one")){$("related_one").select(".related_dfp")[0].remove()}}else{if(c=="related_one"){if($("related_two")){$("related_two").select(".related_dfp")[0].remove()}}}};this.load_more_shares=function(o){var m,l,g,n,d=o.element,f=function(t){try{if(t){return t.className.match("arrow")}}catch(u){console.warn(u);return false}},k=function(t){try{if(t){return t===q||t.ancestors().indexOf(q)>=0}}catch(u){console.warn(u);return false}},p=function(t){try{if(t){return t===m||t.firstChild===m||t.ancestors().indexOf(m)>=0}}catch(u){console.warn(u);return false}};if(!d){return false}bpage.hide_all_popups();var q=$("more_shares_box");d.insert({after:q});var q=$("more_shares_box");var j=q.select(".shareBtn:not(.hidden)");if(j.length){if(j.length==1){q.setStyle({width:"104px"})}else{if(Math.floor(j.length/2)==(j.length/2)&&Math.floor(j.length/3)!=(j.length/3)){q.setStyle({width:"208px"})}}}var h={width:Number(q.getWidth())};var c={left:Number($(d).positionedOffset()[0]),top:Number($(d).positionedOffset()[1]),height:Number($(d).getHeight()),width:Number($(d).getWidth())};var s=q.select(".arrow");q.setStyle({left:(c.left-(h.width/2)+(c.width/2))+"px",top:(c.top+c.height)+"px"});s.each(function(e,t){$(e).setStyle({left:((h.width/2)-10+t)+"px",top:(t-10)+"px"})});q.show();if(typeof bf_rdio!="undefined"){bf_rdio.disable()}l=$(d).on("mouseout",function(u){var t=u.toElement?u.toElement:u.relatedTarget;if(f(t)||k(t)){return}l.stop();q.hide();if(typeof bf_rdio!="undefined"){bf_rdio.enable()}});g=$(q).on("mouseout",function(u){var t=u.toElement?u.toElement:u.relatedTarget;m=$$(".gc-bubbleDefault").first();if(f(t)||k(t)){return}if(m){if(!n){n=$(m).on("mouseout",function(x){var w=x.toElement?x.toElement:x.relatedTarget;if(k(w)||p(w)){return}n.stop();q.hide();if(typeof bf_rdio!="undefined"){bf_rdio.enable()}})}if(p(t)){return}}g.stop();q.hide();if(typeof bf_rdio!="undefined"){bf_rdio.enable()}})};this.arrange_badges=function(){var d=$$(".wrap_badge");if(!d.length){return}d.each(function(h){if(h.hasClassName("disapprove")){var j=d.indexOf(h);d.splice(j,1);d.unshift(h);if(d.length>10){var g=d.length-10}}});var f=55;for(var e=0;e<=d.length;e++){if(d[e]){var c=getWidth(d[e].select("img")[0]);if(c>50){f=c+5}if(e!=0){d[e].setStyle({left:f+"px"});f+=55}}}};this.hide_other_popups=function(f){var d=f.element,c=$$(".sticky-popup"),g=d.nextSiblings(".sticky-popup")[0];if(d.getAttribute("rel:gt_act")!=="share/email"){shareEmail.current_button=null}c.each(function(e){if(e!==g){e.setStyle({display:"none"})}});if(typeof sub_links!="undefined"){sub_links.share_box_inactive()}};this.hide_all_popups=function(){shareEmail.current_button=null;$$(".sticky-popup").each(function(c){if(c.getStyle("display")==="block"){c.hide()}});if(typeof bf_rdio!="undefined"){bf_rdio.enable()}if(typeof sub_links!="undefined"){sub_links.share_box_inactive()}};this.set_quote_style=function(){$$(".buzz_superlist_item_quote").each(function(c){var d=new Element("span",{"class":"ie-quote-before"});var e=new Element("span",{"class":"ie-quote-after"});c.select("blockquote p")[0].insert({before:d});c.select("blockquote p")[(c.select("blockquote p").length-1)].insert(e);if(c.select("blockquote p").length>=2){c.addClassName("long-quote")}if(c.select("blockquote p").length<=1){c.addClassName("short-quote")}})};this.set_box_blur=function(d){var k=d.getOffsetParent(),j=k.select("div.graphic_image_warning")[0],f=d.select("img.graphic_image")[0],m=k.select(".click_to_blur")[0],c=((Prototype.Browser.WebKit&&!isSafari5())||isIE9()),e=(Prototype.Browser.Gecko&&!isIE11()),l=isIE11(),h="";if(l){j.style.top=(f.getAttribute("height")/2*-1)+"px";f.remove();f=d.select("svg")[0];f.style.display=""}if(k.hasClassName("rubbable-container")){var g=$s("#"+k.identify()+" .animatedgifs");if(g){g.addClassName("hidden")}}if(BF_STATIC.bf_env=="dev"||BF_STATIC.bf_env=="live"){h=BF_STATIC.image_root+"/static/images/public/quickpost/blur.svg#blur30"}else{if(BF_STATIC.bf_env=="stage"){h="http://stage.buzzfeed.com/static/images/public/quickpost/blur.svg#blur30"}}if(c){f.addClassName("graphic_image")}else{if(e){f.setAttribute("style","filter:url("+h+");")}else{$s("#"+k.identify()+" .image_block").removeClassName("hidden")}}if(!isIE11()){f.addClassName("box_blur")}d.observe("click",function(){if(c){f.removeClassName("graphic_image")}else{if(e){f.setAttribute("style","")}else{if(l){$$("#"+f.id+" image")[0].style.filter=""}else{$s("#"+k.identify()+" .image_block").addClassName("hidden")}}}j.addClassName("hidden");m.removeClassName("hidden");if(k.hasClassName("rubbable-container")){var o=k.select("iframe");if(!isIE11()){k.select("a.graphic_image_warning")[0].addClassName("hidden")}if(o.length){f.addClassName("hidden");o[0].removeClassName("hidden")}var n=$s("#"+k.identify()+" .animatedgifs");if(n){n.removeClassName("hidden")}}k.addClassName("no_blur")});m.observe("click",function(){if(c){f.addClassName("graphic_image")}else{if(e){f.setAttribute("style","filter:url("+h+");")}else{if(l){$$("#"+f.id+" image")[0].style.filter="url(#blur-effect-"+f.id.replace("svg-image-blur-","")+")"}else{k.select(".image_block")[0].removeClassName("hidden")}}}j.removeClassName("hidden");m.addClassName("hidden");if(k.hasClassName("rubbable-container")){var o=k.select("iframe");if(!isIE11()){k.select("a.graphic_image_warning")[0].removeClassName("hidden")}if(o.length){f.removeClassName("hidden");o[0].addClassName("hidden")}var n=k.select(".animatedgifs")[0];if(n){n.addClassName("hidden")}}k.removeClassName("no_blur")})};this.custom_badge_vote=function(c){if(c){c=c.toLowerCase();if(c=="kaching"){BFAudio.player("/sounds/kaching.mp3")}}};this._more_stuff_init=function(){if(document.location.href.match("/video/")){return}var d=$$(".Content")[0].getHeight()+200,c=$$(".Column2")[0]?$$(".Column2")[0].getHeight():0;if(d>=c&&$("lower-more-content")){bpage._more_stuff_request()}};this._more_stuff_request=function(){bpage.more_loaded=true;var d=$("lower-more-content"),g=d.getAttribute("rel:plugin_version"),c,f=new BF_Request(),e=parseInt((Math.random()*10)+1);if(!g){return}var h="";if(typeof BFW_Util=="object"&&(BFW_Util.getCookie("country")=="uk"||BFW_Util.getCookie("country")=="au")){h="/country:"+BFW_Util.getCookie("country")}c=BF_STATIC.web_root+"/plugin/infinitesidebar/v:"+g+h+"/p:"+e;if(BF_STATIC.bf_env=="dev"&&BF_STATIC.bf_test_mode==true){c=BF_STATIC.web_root+"/plugin/infinitesidebar/v:"+g+"/p:3"}f.request(c,{onSuccess:function(j){if(j.responseText){bpage.load_more_stuff(j.responseText)}},onFailure:function(j){console.error(j)}})};this.load_more_stuff=function(c){if($("lower-more-content")){$("lower-more-content").insert(c);$$("#lower-more-content .post img.thumb").each(function(e,d){e.src=e.getAttribute("rel:bf_image_src")})}};this.toggleBreakingSummary=function(e){var d=$("breaking_news_summary_content"),c=$("toggleBreakingSummary"),e=typeof e!="boolean"?(d.hasClassName("hidden")?true:false):e;if(d&&c){if(e){if(d.hasClassName("hidden")){d.removeClassName("hidden")}c.innerHTML="Hide summary"}else{if(!d.hasClassName("hidden")){d.addClassName("hidden")}c.innerHTML="Show summary";BF_Effect.ScrollIntoView(c,0)}}if(BF_STATIC.campaignid){store.set(BF_STATIC.campaignid+"_summary",e)}};this.loadSummary=function(){if(BF_STATIC.campaignid){if(store.get(BF_STATIC.campaignid+"_summary")==false){bpage.toggleBreakingSummary(false)}}};this.hide_indepth_buzz=function(){var d=BF_STATIC&&BF_STATIC.campaignid?BF_STATIC.campaignid:null,c=universal_dom&&universal_dom._bucket&&universal_dom._bucket.indepth_buzz?universal_dom._bucket.indepth_buzz.elements:[];if(!d||!c.length){return}c.each(function(e){if(e.data&&e.data.indepth_buzz_id&&e.data.indepth_buzz_id==d){e.element.addClassName("hidden")}})};this.keycontrols=function(){var c=new BF_KeyControls();c.init();if(c){c.commands.push({name:"r",keys:[82],target:"social-actions",_track:"buzz"});c.commands.push({name:"c",keys:[67],target:"respond",_track:"buzz"});c.scroll={items:"ul#top-list li",_track:"buzz"};c.scroll={items:".buzz_superlist_item",_track:"buzz",reject_items:["buzz_superlist_item_text","buzz_superlist_item_link"]}}};this.dedupe_sidebar=function(){var h=new Array("promoted");var c=window.location.href.replace(/bf2\//,"");c=c.replace(/http:\/\/.*?\/.*?\/(.*)/,"$1");var g=new Array(/#.*/,/\/.*/,/\?.*/);for(var f=0;f<g.length;f++){if(c.match(g[f])){c=c.replace(g[f],"")}}for(var f=0;f<h.length;f++){var e=$(h[f]+"-"+c);if(e){e.hide();var d=$(h[f]+"-extra-hidden");if(d){d.show()}}}};this.load_hot_on_pinterest=function(){var c=$("hotOnPinterestWrap");widget_loaded=false;if(c&&("bf_pinterest_referer" in window)&&!isMSIE()){f()}function f(){var g=["diy","food"],h=(bf_pinterest_referer&&bf_pinterest_referer.COOKIE)?readCookie(bf_pinterest_referer.COOKIE):null;if((BF_STATIC.tt_page=="Buzz"&&BF_STATIC.vertical&&g.indexOf(BF_STATIC.vertical.toLowerCase())!="-1")||(document.referrer||"").match(/pinterest.com/)||(location.search||"").match(/\?referer=pinterest.com/)||(document.referrer||"").match(/blog.pinterest.com/)||(location.search||"").match(/\?referer=blog.pinterest.com/)||h){e();Event.observe(window,"scroll",function(){e()})}}function e(){if(!widget_loaded&&((c.viewportOffset().top+100)<document.viewport.getHeight())){widget_loaded=true;d();EventManager.fire("load_hot_on_pinterest")}}function d(){var h=BF_STATIC.vertical?BF_STATIC.vertical.toLowerCase():null,g=BF_STATIC.web_root+"/plugin/pinterestunit/v:1.2"+(h?"/vt:"+h:"")+"/p:1",j=new BF_Request();c.update('<div class="hot-on-pinterest-loader"></div>');j.request(g,{onSuccess:function(l){if(!l||!l.responseText){return}c.update(l.responseText);universal_dom.update(c);if(typeof(bf_prog_load)!="undefined"){var k=c.select("ul li img");if(k.length){k.each(function(m){if(m.readAttribute("rel:bf_image_src")){bf_prog_load.load_image(m,m.readAttribute("rel:bf_image_src"))}})}}},onFailure:function(k){console.error(k)}})}}};document.observe("dom:loaded",function(){if($("buzz_sub_buzz")&&($("buzz_sub_buzz").hasClassName("suplist_long")||$("buzz_sub_buzz").hasClassName("suplist_article"))&&!bf_post_tools.is_viewdraft_page){var a=new BF_InlineSharing();a.init()}});$(document).observe("click",function(b){if(typeof(b.target)=="undefined"||!isHTMLElement(b.target)){return}var a=false,c=b.toElement?b.toElement:(b.relatedTarget||b.target),d=function(g){var j=$(g).getAttribute("rel:bf_bucket");var k=$(g).getAttribute("rel:bf_bucket_data");var f=$(g).hasClassName("sticky-popup");var e=(j&&j.match("sticky_popup_button")!==null);var h=(k&&k.match("email-share")!==null);return f||e||h};if(!c||d(c)){return}c.ancestors().each(function(e){if(!a){a=d(e)}});if(a){return}bpage.hide_all_popups()});$(document).observe("keyup",function(a){if(a.keyCode==Event.KEY_ESC){bpage.hide_all_popups()}});var bpage=new BF_bpage();BuzzLoader.register(bpage.init,5);BF_Queue=function(){var active_buzz;var active_promotion;var active_splash_page;var active_area_id;var active_area_name;var active_queue_id;var listObj={};this.draggableLists=["queue_list"];this.controller="/buzzfeed/queue";this.splash_controller="/buzzfeed/splash_queue";this.bigstory_controller="/buzzfeed/bigstory_queue";this.is_megaphone_user=false;this.init=function(){if(acl.user_can("megaphone")){this.is_megaphone_user=true}EventManager.observe("pager:load:done",this.toggle_megaphone_queue_status.bind(this));EventManager.observe("pager:load:done",this.assign_handlers.bind(this));queue.make_drag_lists(queue.draggableLists);if(queue.init_params()){queue.assign_handlers();queue.override_post_tools();queue.init_tabs();ukBackground()}};this.toggle_megaphone_queue_status=function(){if(!this.is_megaphone_user){return}$s("#post_list").addClassName("has_megaphone")};this.assign_handlers=function(){this.global_queue_handlers();this.splash_queue_handlers();universal_dom.assign_handler({bucket:"inline-edit",handler:queue.inline_edit,event:"click"});universal_dom.assign_handler({bucket:"update-queue-time",handler:queue.update_queue_time,event:"click"});universal_dom.assign_handler({bucket:"delete-from-queue",handler:queue.delete_from_queue,event:"click"});universal_dom.assign_handler({bucket:"delete-cancel",handler:queue.delete_cancel,event:"click"});universal_dom.assign_handler({bucket:"show-queue-types",handler:queue.show_queue_types,event:"click"});universal_dom.assign_handler({bucket:"tab",handler:queue.show_tab,event:"click"});$$(".schedule_form select").each(function(el){if(el.parentElement){var radioBtn=el.parentElement.select(".queue_for input")[0];el.on("change",function(){if(!radioBtn.checked){radioBtn.checked="checked"}})}})};this.splash_queue_handlers=function(){universal_dom.assign_handler({bucket:"delete-splash-from-queue",handler:queue.delete_splash_from_queue,event:"click"})};this.global_queue_handlers=function(){universal_dom.assign_handler({bucket:"confirm-delete",handler:queue.show_alert,event:"click"});universal_dom.assign_handler({bucket:"schedule-submit",handler:queue.schedule_submit,event:"click"});universal_dom.assign_handler({bucket:"schedule-cancel",handler:queue.schedule_cancel,event:"click"});universal_dom.assign_handler({bucket:"hide_alerts",handler:queue.hide_alerts,event:"click"})};this.init_params=function(){params=document.location.search.replace(/^\?/,"").toQueryParams();if(typeof params!="undefined"){if(params.tab){if(params.tab=="splash_queue"&&acl.user_can("homepage_edit")){queue.current_fieldset="splash_queue"}else{if(params.tab=="flow_suggestions"){queue.current_fieldset="flow_suggestions"}}}if(params.types){var queue_types=params.types.split("+");if(queue_types.length>0){var queue_type_form=$("queue_type_form").select("input");queue_type_form.each(function(el){$(el).checked=false;queue_types.each(function(tp){if(tp==$(el).name){$(el).checked=true}})})}}}return queue.show_queue_types()};this.show_queue_types=function(){var queueTypes=new Array();var queue_type_form=$("queue_type_form"),queue_type_form_inputs=queue_type_form?queue_type_form.select("input"):[];queue_type_form_inputs.each(function(el){if($(el).checked){queueTypes.push($(el).name)}});if(!queue_type_form_inputs.length){return false}queue.filter(queueTypes);return true};this.queue_types_string=function(){var types_string=new Array();if($("queue_type_form")){var queue_type_form=$("queue_type_form").select("input");queue_type_form.each(function(el){if($(el).checked){if(types_string==""){types_string=$(el).name}else{types_string+="+"+$(el).name}}});return types_string}else{return false}};this.override_post_tools=function(){bf_post_tools.load_flexpro=function(e){var buzz_info=e.target.getAttribute("rel:data").evalJSON();var owner=e.target.getAttribute("rel:owner");if(buzz_info.status=="draft"&&buzz_info.buzz_id){window.open("/buzzfeed/_draft/"+buzz_info.buzz_id)}else{if(buzz_info.uri&&owner){window.open(BF_STATIC.web_root+"/"+owner+"/"+buzz_info.uri,"_new")}else{alert("Invalid ID ("+buzz_info.buzz_id+")")}}};bf_post_tools.delete_quickpost=function(e,type){if(e.event){e=e.event}e.stop();var username=(new BF_User()).getUserInfo().username;var el=e.target;var owner=el.getAttribute("rel:owner");var buzz_data=el.getAttribute("rel:data");var buzz_data=eval("("+buzz_data+")");if(buzz_data.area_id){var args={area_id:buzz_data.area_id,buzz_id:buzz_data.buzz_id}}else{var args={buzz_id:buzz_data.buzz_id};if(typeof buzz_data.queue_id!=="undefined"){args.queue_id=buzz_data.queue_id}}queue.show_alert(args)}};this.make_drag_lists=function(lists){for(var i=0;i<lists.length;i++){var queueList="queueList"+i;var lastDragOrder="lastDragOrder"+i;listObj[lists[i]]={qlist:queueList,lastOrder:lastDragOrder};queue[queueList+i]=new Array();queue[lastDragOrder]=new Array()}};this.list_make_sortable=function(listName){if(!$(listName)){return false}queue.list_destroy_sortable(listName);if($$("#"+listName+" .queue_item:not(.hidden)").length>1){Sortable.create(listName,{only:"queue_item",scroll:window,onChange:function(e){queue.drag_change(listName)}});Draggables.addObserver({onStart:function(eventName,draggable,e){draggable.element.addClassName("dragging")},onEnd:function(eventName,draggable,e){draggable.element.removeClassName("dragging");queue.drag_end(listName)}});$(listName).addClassName("is_draggable")}};this.list_destroy_sortable=function(listName){if(!$(listName)){return false}$(listName).removeClassName("is_draggable");Sortable.destroy(listName)};this.drag_change=function(listName){var newDragOrder=queue.get_new_queue_order(listName);var lastDragOrder=queue.get_last_drag_order(listName);var myQueueList=queue.get_queue_list(listName);for(var i=0;i<newDragOrder.length;i++){if(newDragOrder[i]!=lastDragOrder[i]){var firstElement=$$("#"+newDragOrder[i]+" .queue_time .text")[0];var secondElement=$$("#"+myQueueList[i]+" .queue_time .text")[0];firstElement.innerHTML=secondElement.id}}queue.set_last_drag_order(listName,newDragOrder)};this.drag_end=function(listName){var newOrder=queue.get_new_queue_order(listName);var myQueueList=queue.get_queue_list(listName);var newTimesHash={};var usedTimesHash={};for(var i=0;i<newOrder.length;i++){var postId=JSON.parse($$("#"+newOrder[i])[0].getAttribute("rel:data")).queue_id;var newTime=JSON.parse($$("#"+myQueueList[i])[0].getAttribute("rel:data")).unix_time;var timeUpdated=false;var secondsTime=newTime;while(usedTimesHash[secondsTime]==1){secondsTime=parseInt(secondsTime)+1;timeUpdated=true}usedTimesHash[secondsTime]=1;if((newOrder[i]!=myQueueList[i])||timeUpdated){newTimesHash[postId]=secondsTime}}queue.set_queue_list(listName,newOrder);if(Object.keys(newTimesHash).length>0){queue.show_body_overlay();var controller=queue.get_controller(listName);var params={action:"update_times",new_times:JSON.stringify(newTimesHash)};try{var ajax=new BF_Request();ajax.request(controller,{method:"get",parameters:params,onSuccess:function(o){queue.reload_page()}})}catch(err){dumpError(err)}}};this.get_controller=function(listName){if(listName=="splash_queue_list"||listName=="bigstory_homepage_queue_list"){return queue.splash_controller}else{return queue.controller}};this.update_list_order=function(listName){var myQueueList=queue.get_new_queue_order(listName);queue.set_queue_list(listName,myQueueList);queue.set_last_drag_order(listName,myQueueList)};this.get_new_queue_order=function(listName){var newQueueList=new Array();$$("#"+listName+" .queue_item:not(.hidden)").each(function(el){newQueueList.push($(el).id)});return newQueueList};this.get_last_drag_order=function(listName){if(listObj[listName]){return queue[listObj[listName].lastOrder]}else{return 0}};this.set_last_drag_order=function(listName,newDragOrder){if(listObj[listName]){queue[listObj[listName].lastOrder]=newDragOrder}};this.get_queue_list=function(listName){if(listObj[listName]){return queue[listObj[listName].qlist]}else{return 0}};this.set_queue_list=function(listName,newQueueList){if(listObj[listName]){queue[listObj[listName].qlist]=newQueueList}};this.filter=function(queueTypes){universal_dom.get_bucket_elements("queue_item").each(function(el){el.addClassName("hidden")});universal_dom.get_bucket_elements("queue_item").each(function(el){queueTypes.each(function(qt){if(el.hasClassName(qt)){el.removeClassName("hidden")}})});for(var i=0;i<queue.draggableLists.length;i++){queue.update_list_order(queue.draggableLists[i])}};this.update_queue_time=function(args){if(args.buzz_id||args.buzz_promotion_id){var date_radio=$$(".schedule_form")[0].run_at_type[1];var post_id;var uList="";if(args.bigstory_homepage_suggestion&&args.bigstory_homepage_suggestion==1){if(args.buzz_promotion_id){post_id=args.buzz_promotion_id;uList="#bigstory_homepage_suggestions_list ";active_promotion=args.buzz_promotion_id}else{if(args.buzz_id){post_id=args.buzz_id;active_buzz=args.buzz_id}}$("current_status").innerHTML="";$$(".vertical_options")[0].hide();$$(".queue_alert_title")[0].innerHTML="Add To Big Story Queue";date_radio.show()}else{if(args.splash_page){post_id=args.buzz_promotion_id;uList="#splash_queue_list ";active_promotion=args.buzz_promotion_id;active_area_id=args.area_id;if(args.buzz_id){active_buzz=args.buzz_id}$("current_status").innerHTML="";$$(".vertical_options")[0].hide();if(queue.current_fieldset=="bigstory_homepage_queue"){$$(".queue_alert_title")[0].innerHTML="Edit Big Story Queue Status"}else{var title=(args.splash_page)?"Edit "+args.splash_page+" Splash Queue Status":"Edit Splash Queue Status";active_splash_page=(args.splash_page)?args.splash_page:"Frontpage";$$(".queue_alert_title")[0].innerHTML=title}date_radio.show()}else{if(args.buzz_id){post_id=args.buzz_id;active_buzz=args.buzz_id;active_area_id=args.area_id;if(args.vertical&&args.date){$("current_status").innerHTML="(Currently queued into the "+args.vertical+".)"}else{$("current_status").innerHTML="(Not Currently Queued)"}date_radio.checked=true;$$(".vertical_options")[0].show();var area_name=(args.area)?args.area:(args.vertical)?args.vertical:(args.vertical_name)?args.vertical_name:"Publish";active_area_name=area_name;var queue_name=(area_name=="Publish")?"Publish":(area_name.indexOf("Homepage")!=-1)?"Homepage":"Vertical";$$(".queue_alert_title")[0].innerHTML="Edit "+queue_name+" Queue Status";date_radio.show();if(queue.current_fieldset=="flow_suggestions"){$$(".queue_alert_title")[0].innerHTML="Move to Homepage Flow Queue"}}}}if(!args.date){var next=new Date();if(next.getMinutes()>=0&&next.getMinutes()<10){next.setMinutes(15)}else{if(next.getMinutes()>=10&&next.getMinutes()<25){next.setMinutes(30)}else{if(next.getMinutes()>=25&&next.getMinutes()<40){next.setMinutes(45)}else{if(next.getMinutes()>=40&&next.getMinutes()<55){next.setMinutes(60)}else{next.setMinutes(75)}}}}args.date=dateFormat(next,"yyyy-mm-dd HH:MM:ss")}if(args.date){var t=args.date.toString().split(/[- :]/);var datetime=new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]);var month=datetime.getMonth()+1;var date=datetime.getFullYear()+"/"+month+"/"+datetime.getDate();var min=(datetime.getMinutes()<=9)?"0"+datetime.getMinutes():datetime.getMinutes();var hours=datetime.getHours();var time=hours+":"+min+":0";if(date&&time){for(var i=0;i<$$("#day")[0].options.length;i++){if($$("#day")[0].options[i].value==date){$$("#day")[0].selectedIndex=i}}for(var i=0;i<$$("#time")[0].options.length;i++){if($$("#time")[0].options[i].value==time){$$("#time")[0].selectedIndex=i}}$("pin_it").checked=(args.pin&&args.pin=="true")?true:false;$("add_to_homepage").checked=(args.hp&&args.hp=="true")?true:false}date_radio.checked=true}var dialog=$$(".update_queue_time")[0];var dialogWidth=dialog.getWidth();var dialogHeight=dialog.getWidth();var editBtn=$(args.target);var editBtnHeight=editBtn.getHeight();var editBtnLeft=Math.max(editBtn.offsetLeft,dialogWidth);var editBtnTop=editBtn.offsetTop;var post=$$(""+uList+"#post-"+post_id)[0];var postTop=(post)?post.offsetTop:0;var top=(postTop+editBtnTop+editBtnHeight+5);var left=(editBtnLeft-dialogWidth);var viewport=document.viewport.getDimensions();var scroll=document.viewport.getScrollOffsets();if(!post||top>800){top=(scroll.top+(viewport.height-dialogHeight))/2;left=scroll.left+(viewport.width-dialogWidth)/2}left=scroll.left+(viewport.width-dialogWidth)/2;if(typeof args.add_to_homepage!="undefined"&&args.add_to_homepage==1){$("add_to_homepage").checked=true}queue.show_body_overlay();dialog.show();dialog.setStyle({left:left+"px",top:top+"px"})}else{}};this.show_body_overlay=function(){var bodyHeight=document.body.getHeight();var bodyWidth=document.body.getWidth();if(!$("bodyOverlay")){var overlay=document.createElement("div");overlay.setAttribute("id","bodyOverlay");overlay.setStyle({width:bodyWidth+"px",height:bodyHeight+"px",zIndex:99});document.body.appendChild(overlay)}};this.hide_alerts=function(){if($("bodyOverlay")){document.body.removeChild($("bodyOverlay"))}$$(".update_queue_time")[0].hide();$$(".alert_box").each(function(el){el.hide()})};this.schedule_cancel=function(){if($("quickpost-queue")){$("quickpost-queue").checked=false}queue.hide_alerts()};this.schedule_submit=function(){var bad_date=false;var run_at_type=$$(".schedule_form")[0].run_at_type;var run_at=getCheckedValue(run_at_type);if(run_at=="date"){run_at=$$("#day")[0].options[$$("#day")[0].selectedIndex].value+" "+$$("#time")[0].options[$$("#time")[0].selectedIndex].value;var right_now=new Date();var selected_date=new Date(run_at);if(right_now>selected_date){$$(".bad_date")[0].show();bad_date=true}run_at=""+Math.round(selected_date.getTime()/1000)}else{if(run_at="next"){run_at=""+(Math.round(Date.now()/1000)+900)}}if(!bad_date){if(queue.current_fieldset=="splash_queue"){queue.schedule_splash(run_at)}else{if(queue.current_fieldset=="bigstory_homepage_queue"){queue.schedule_bigstory(run_at)}else{queue.schedule_flow(run_at)}}queue.hide_alerts()}};this.schedule_flow=function(run_at){var current_buzz=active_buzz;bf_post_tools.current_buzz=current_buzz;if($$("#post-"+active_buzz+" .ptool_spinner")[0]){$$("#post-"+active_buzz+" .ptool_spinner")[0].show()}else{if(superlist){superlist.toggle_disable_actions()}}queue.show_body_overlay();$$(".update_queue_time")[0].hide();var params={action:"schedule",buzz_id:current_buzz,area_id:active_area_id,page:active_area_name,run_at:run_at};try{var ajax=new BF_Request();ajax.request(queue.controller,{method:"post",parameters:params,onSuccess:function(o){if(queue.current_fieldset!="flow_suggestions"){if(superlist&&superlist.query_params.id&&acl.user_can("auto_flex")){var uri="/buzzfeed/_optimize/"+superlist.query_params.id;BF_Request.location({location:uri})}else{queue.reload_page()}}else{var message="addedtoqueue";(typeof BF_STATIC!=="undefined"&&BF_STATIC.country!=="undefined"&&BF_STATIC.country=="uk")?queue.reload_page(message):queue.delete_from_flow_suggestions(message)}}})}catch(err){dumpError(err)}};this.schedule_splash=function(run_at){bf_post_tools.current_buzz=active_promotion;if($$("#splash_queue_list #post-"+active_buzz+" .ptool_spinner")[0]){$$("#splash_queue_list #post-"+active_buzz+" .ptool_spinner")[0].show()}queue.show_body_overlay();$$(".update_queue_time")[0].hide();var params={action:"schedule",buzz_id:active_buzz,area_id:active_area_id,run_at:run_at};params.splash_page=active_splash_page;try{var ajax=new BF_Request();ajax.request(queue.splash_controller,{method:"post",parameters:params,onSuccess:function(o){queue.reload_page()}})}catch(err){dumpError(err)}};this.schedule_bigstory=function(run_at){return;var params={action:"schedule",run_at:run_at};var controller=queue.bigstory_controller;if(queue.current_fieldset=="bigstory_homepage_suggestions"){bf_post_tools.current_buzz=active_buzz;if($$("#bigstory_homepage_suggestions_list #post-"+active_buzz+" .ptool_spinner")[0]){$$("#bigstory_homepage_suggestions_list #post-"+active_buzz+" .ptool_spinner")[0].show()}params.buzz_id=active_buzz}else{if(queue.current_fieldset=="bigstory_homepage_queue"){bf_post_tools.current_buzz=active_promotion;if($$("#bigstory_homepage_queue_list #post-"+active_promotion+" .ptool_spinner")[0]){$$("#bigstory_homepage_queue_list #post-"+active_promotion+" .ptool_spinner")[0].show()}params.promotion_id=active_promotion;controller=queue.splash_controller}}queue.show_body_overlay();$$(".update_queue_time")[0].hide();try{var ajax=new BF_Request();ajax.request(controller,{method:"post",parameters:params,onSuccess:function(o){queue.reload_page()}})}catch(err){dumpError(err)}};this.show_alert=function(args){if(args.buzz_id){var item;if(args.buzz_id){active_buzz=args.buzz_id;item=$$("#post-"+args.buzz_id)[0];active_area_id=args.area_id?args.area_id:0;active_queue_id=args.queue_id?args.queue_id:0}var itemTop=item.offsetTop;var dialog=$$(".alert_box")[0];var dialogWidth=dialog.getWidth();queue.show_body_overlay();dialog.show();dialog.setStyle({left:(dialogWidth)+"px",top:(itemTop)+"px"})}else{alert("Invalid ID ("+args.buzz_id+")")}};this.delete_cancel=function(){queue.hide_alerts()};this.delete_from_splash_queue=function(){queue.show_body_overlay();var params={action:"delete_from_queue",buzz_id:active_buzz,area_id:active_area_id,splash_page:active_splash_page};try{var ajax=new BF_Request();ajax.request(queue.splash_controller,{method:"get",parameters:params,onSuccess:function(o){queue.reload_page("splashdeleted")}})}catch(err){dumpError(err)}};this.delete_from_flow_queue=function(){$$("#post-"+active_buzz+" .ptool_spinner")[0].show();queue.show_body_overlay();var params={action:"delete_from_queue",buzz_id:active_buzz};if(typeof active_area_id!=="undefined"&&active_area_id!=0){params.area_id=active_area_id}else{if(typeof active_queue_id!=="undefined"&&active_queue_id!=0){params.queue_id=active_queue_id}}try{var ajax=new BF_Request();ajax.request(queue.controller,{method:"get",parameters:params,onSuccess:function(o){queue.reload_page("deleted")}})}catch(err){dumpError(err)}};this.delete_from_flow_suggestions=function(message){var reload_message=message||"removedsuggestion";var email_editor=reload_message=="removedsuggestion"?1:0;var current_buzz=active_buzz;bf_post_tools.current_buzz=current_buzz;$$("#post-"+active_buzz+" .ptool_spinner")[0].show();queue.show_body_overlay();var params={action:"delete_flow_suggestion",buzz_id:current_buzz,email_editor:email_editor};try{var ajax=new BF_Request();ajax.request(queue.controller,{method:"post",parameters:params,onSuccess:function(o){queue.reload_page(reload_message)}})}catch(err){dumpError(err)}};this.delete_from_bigstory_homepage_suggestions=function(){$$("#post-"+active_buzz+" .ptool_spinner")[0].show();queue.show_body_overlay();var params={action:"delete_bigstory_suggestion",buzz_id:active_buzz};try{var ajax=new BF_Request();ajax.request(queue.controller,{method:"get",parameters:params,onSuccess:function(o){var post=$("post-"+active_buzz);if(post){post.parentNode.removeChild(post)}queue.hide_alerts()}})}catch(err){dumpError(err)}};this.delete_from_queue=function(args){if(queue.current_fieldset=="splash_queue"){$$("#splash_queue_list #post-"+active_buzz+" .ptool_spinner")[0].show();queue.delete_from_splash_queue()}else{if(queue.current_fieldset=="bigstory_homepage_queue"){$$("#bigstory_homepage_queue_list #post-"+active_promotion+" .ptool_spinner")[0].show();queue.delete_from_splash_queue()}else{if(queue.current_fieldset=="flow_suggestions"){queue.delete_from_flow_suggestions("removedsuggestion")}else{if(queue.current_fieldset=="bigstory_homepage_suggestions"){queue.delete_from_bigstory_homepage_suggestions()}else{queue.delete_from_flow_queue()}}}}};this.publish_to_hp=function(args){if(args.buzz_id){$$("#post-"+args.buzz_id+" .ptool_spinner")[0].show();queue.show_body_overlay();var params={action:"publish_to_hp",buzz_id:args.buzz_id,country:BF_STATIC.country};if(queue.current_fieldset=="flow_suggestions"){params.is_suggestion=1}try{var ajax=new BF_Request();ajax.request(queue.controller,{method:"get",parameters:params,onSuccess:function(o){queue.reload_page("published")}})}catch(err){dumpError(err)}}else{alert("Invalid ID ("+args.buzz_id+")")}};this.reload_page=function(success_message){var params_array=new Array();var pathname=window.location.pathname;if(typeof BF_STATIC!=="undefined"&&BF_STATIC.country!=="undefined"&&BF_STATIC.country!="us"){params_array.push("country="+BF_STATIC.country)}if(queue.queue_types_string()){params_array.push("types="+queue.queue_types_string())}if(!(typeof success_message==="undefined")&&success_message.length>0){params_array.push("message="+success_message)}if(queue.current_fieldset=="flow_suggestions"||queue.current_fieldset=="bigstory_homepage_queue"||queue.current_fieldset=="splash_queue"){params_array.push("tab="+queue.current_fieldset)}if(params_array.length>0){if(pathname.indexOf("?")){pathname=pathname.substring(0,pathname.indexOf("?"))}pathname+="?"+params_array.join("&");var curr=queue.current_fieldset;BF_Request.location({location:pathname});queue.current_fieldset=curr}else{window.setTimeout(function(){var curr=queue.current_fieldset;BF_Request.location({reload_track:true});queue.current_fieldset=curr},200)}};this.init_tabs=function(){if(typeof queue.current_fieldset=="undefined"){queue.current_fieldset=(window.history.state&&window.history.state.tab)?window.history.state.tab:"flow_queue"}queue.show_tab({id:queue.current_fieldset})};this.show_tab=function(obj){$$("#queue-data>li").each(function(el){el.addClassName("hidden");if($(el.id+"_tab")){$(el.id+"_tab").removeClassName("active_tab")}});if($(obj.id)&&$(obj.id+"_tab")){$(obj.id).removeClassName("hidden");$(obj.id+"_tab").addClassName("active_tab");queue.current_fieldset=obj.id;if(!(window.history.state&&window.history.state.tab==obj.id)){history.pushState({tab:obj.id},"","")}}}.bind(this)};function getCheckedValue(b){if(!b){return""}var c=b.length;if(c==undefined){if(b.checked){return b.value}else{return""}}for(var a=0;a<c;a++){if(b[a].checked){return b[a].value}}return""}window.onload=function(){for(var a=0;a<queue.draggableLists.length;a++){queue.list_make_sortable(""+queue.draggableLists[a])}};window.onpopstate=function(a){if(a.state&&a.state.tab){queue.show_tab({id:a.state.tab})}};var queue=new BF_Queue();var bf_post_tools=new BF_Post_Tools();BuzzLoader.register(function(){queue.init()},2);var Rerankable=function(){var b=this;var a=false;this.isPinnedCTA=false;this.pinnedThreshold=0;this.username="";this.is_not_rerank_mode=false;this.removing=false;this.modeIsReady=false;this.templates={share_modal:'<div class="rerank_modal #{amazon} rerank_share_modal modal hidden" rel:gt_cat="Buzz:Re-Rank">                <a href="javascript:;" class="bf_dom fa fa-times close_btn" rel:bf_bucket="re_rank_modal_close"></a>                <div class="title_img"></div>                <div class="title">                    Thanks, <span class="wrap_text_hidden">#{name}!</span><br/>Now share your post!                </div>                <div class="help_txt">                    <a href="#{url}">#{url}</a>                </div>                <div class="share_buttons"></div>            </div>',confirm_modal:'<div class="rerank_modal #{amazon} rerank_confirm_modal modal hidden" rel:gt_cat="Buzz:Re-Rank">                <a href="javascript:;" class="bf_dom fa fa-times close_btn" rel:bf_bucket="re_rank_modal_close" rel:gt_act="cancel-abandon"></a>                <div class="title">                    OMG!<br />Want to abandon your #{label}?                </div>                <div class="help_txt">                    Your changes won\'t be saved.                </div>                <a class="bf_dom btn rerank_btn rerank_btn_big rerank_btn_white" rel:gt_act="quit-rerank" rel:bf_bucket="re_rankable_mode_close">Yep, I Quit</a>                <div class="add_help_text">                    <a href="javascript:;" class="bf_dom" rel:gt_act="cancel-abandon" rel:bf_bucket="re_rank_modal_close">No wait! I want to keep working &rarr;</a>                </div>            </div>',error_modal:'<div class="rerank_modal rerank_error_modal modal hidden">                <a href="javascript:;" class="bf_dom fa fa-times close_btn" rel:bf_bucket="re_rank_modal_close"></a>                <div class="title">ERROR</div>                <div class="help_txt">#{error}.</div>            </div>',text_subbuzz:'<div class="subbuzz bf_dom subbuzz_text" id="element_#{id}" data-id="#{id}" rel:bf_bucket_data="{\'drag_element-md\':{}}">                    <div class="rank_numbering">                        <input type="text" class="bf_dom rank_numb" rel:gt_act="number" value="#{number}" rel:bf_bucket_data="{\'re_rank_number\':{}, \'re_rank_number_blur\':{}, re_rank_number_focus: {}, re_rank_number_keypress: {}}"/>                    </div>                    <h2>#{title}</h2>                    <p class="rank_description">#{text}</p>                    <div class="arrows">                        <a href="javascript:;" class="fa fa-arrow-up up bf_dom" rel:bf_bucket="re_rank_up"></a>                        <a href="javascript:;" class="fa fa-arrow-down down bf_dom" rel:bf_bucket="re_rank_down"></a>                    </div>                    <a href="javascript:;" class="subbuzz__remove fa fa-close bf_dom" rel:bf_bucket="re_rank_remove">&#xf00d;</a>                    <a href="javascript:;" class="subbuzz__restore fa fa-plus bf_dom" rel:bf_bucket="re_rank_restore"></a>                </div>',image_subbuzz:'<div class="subbuzz bf_dom subbuzz_image" id="element_#{id}" data-id="#{id}" rel:bf_bucket_data="{\'drag_element-md\':{}}">                    <div class="rank_numbering">                        <input type="text" class="bf_dom rank_numb" rel:gt_act="number" value="#{number}" rel:bf_bucket_data="{\'re_rank_number\':{}, \'re_rank_number_blur\':{}, re_rank_number_focus: {}, re_rank_number_keypress: {}}"/>                    </div>                    <div class="rank_img_holder"><img width="100" src="#{image}"/></div>                    <h2>#{title}</h2>                    <p class="rank_description">#{text}</p>                    <div class="arrows">                        <a href="javascript:;" class=" fa fa-arrow-up up bf_dom" rel:bf_bucket="re_rank_up"></a>                        <a href="javascript:;" class="fa fa-arrow-down down bf_dom" rel:bf_bucket="re_rank_down"></a>                    </div>                    <a href="javascript:;" class="subbuzz__remove fa fa-close bf_dom" rel:bf_bucket="re_rank_remove">&#xf00d;</a>                    <a href="javascript:;" class="subbuzz__restore fa fa-plus bf_dom" rel:bf_bucket="re_rank_restore"></a>                </div>',video_subbuzz:'<div class="subbuzz bf_dom subbuzz_video" id="element_#{id}" data-id="#{id}" rel:bf_bucket_data="{\'drag_element-md\':{}}">                    <div class="rank_numbering">                        <input type="text" class="bf_dom rank_numb" value="#{number}" rel:gt_act="number" rel:bf_bucket_data="{\'re_rank_number\':{}, \'re_rank_number_blur\':{}, re_rank_number_focus: {}, re_rank_number_keypress: {}}"/> #{title}                    </div>                    <div class="rank_img_holder"><img width="100" src="#{video}"/></div>                    <h2>#{title}</h2>                    <p class="rank_description">#{text}</p>                    <div class="arrows">                        <a href="javascript:;" class=" fa fa-arrow-up up bf_dom" rel:bf_bucket="re_rank_up"></a>                        <a href="javascript:;" class="fa fa-arrow-down down bf_dom" rel:bf_bucket="re_rank_down"></a>                    </div>                    <a href="javascript:;" class="subbuzz__remove fa fa-close bf_dom" rel:bf_bucket="re_rank_remove">&#xf00d;</a>                    <a href="javascript:;" class="subbuzz__restore fa fa-plus bf_dom" rel:bf_bucket="re_rank_restore"></a>                </div>'};this.text=function(c){if(!c){return""}var d=typeof(c.innerText)=="undefined"?"textContent":"innerText";return c[d]};this.text_with_emojis=function(h){if(!h){return""}if(typeof(h.innerHTML)=="undefined"){return this.text(h)}var j=h.innerHTML;var f=j.match(/<img class=\"twitter-emoji\" src=\"[^<]*\.png\">/g);var e=j.replace(/<img class=\"twitter-emoji\" src=\"[^<]*\.png\">/g,"\u263a");var c=0;function d(){var k=f[c];c++;return(k)}var g=document.createElement("p");g.innerHTML=e;e=g.innerText;e=e.length>150?e.substr(0,147)+"...":e;return(e.replace(/\u263a/g,d))};this.init=function(){var c=this;this.defaultRerankData={tooltips:{top:false,number:false,number_enter:false},sharedUrl:""};if(!store.get("rerank_data")){this.setRerankData(this.defaultRerankData)}this.container=$$(".rerankable_container")[0];this.list=this.container.select("#reranked_list")[0];this.removable=$$(".reranked_list_holder")[0].hasClassName("removable");this.isAmazon=this.container.hasClassName("amazon-wishlist");if(this.removable){this.removedList=this.container.select("#reranked_removed_list")[0]}this.data=this.container.readAttribute("rel:data")?JSON.parse(this.container.readAttribute("rel:data")):{};this.isContinue=true;this.$cta=$$(".rerank_cta")[0];this.$submitBtn=$("re_rank_submit_btn");this.$ctaBottom=$$(".rerank_cta_bottom")[0];this.render();if(!this.isContinue){return false}this.startNum=this.list.select(".subbuzz .rank_numbering input")[0].getValue();this.ctaTop=this.$cta.cumulativeOffset().top;this.ctaLeft=this.getCtaLeft();this.ctaBottomTop=this.$ctaBottom.cumulativeOffset().top;this.initHandlers();this.initDragDrop();this.reorder();this.showShare();this.startPostOrderItems=[];this.startRerankOrderPos=[];this.fillObjOrder();this.initOrderList=this.getOrder(this.list).join(",");this.startItemNumber=0;this.checkRemoveAbility();Element.observe(window,"resize",function(){c.placeTooltips();c.showTooltips();c.onWindowResize()});Event.observe(document,"mouseup",this.onDragElMouseUp.bind(this));Event.observe(window,"scroll",this.onScroll.bind(this));this.container.select(".rerank_username")[0].observe("click",function(){c.container.select(".rerank_username")[0].removeClassName("error");c.container.select(".rerank_username_error_message")[0].hide()})};this.setCtaLeft=function(){if(b.isPinnedCTA){b.$cta.setStyle({left:b.ctaLeft+"px"})}};this.clearCtaLeft=function(){b.$cta.setStyle({left:""})};this.getCtaLeft=function(){var c=$("buzz_header");return c.cumulativeOffset().left+(c.getWidth()-this.$cta.getWidth())/2+3};this.fillObjOrder=function(){var c="";startRerankItemsOrder={};$$("#buzz_sub_buzz .buzz_superlist_item").each(function(d,e){c=($(d).id).split("_")[2];b.startPostOrderItems.push(c);b.list.select(".subbuzz").each(function(f,g){if(c==$(f).readAttribute("data-id")){b.startRerankOrderPos.push(e)}})})};this.getOrder=function(e){var c={},d=[];e.select(".subbuzz").each(function(g,h){var f=$(g).readAttribute("data-id");if(!f){return}d.push(f)});return d};this.setRerankData=function(e){var c=false,d=this.getRerankData();if(typeof e!=="undefined"&&e){if(typeof e.tooltips!=="undefined"){d.tooltips=e.tooltips;c=true}if(typeof e.sharedUrl!=="undefined"){d.sharedUrl=e.sharedUrl;c=true}if(typeof e.currentUrl!=="undefined"){d.currentUrl=e.currentUrl;c=true}}if(c){store.set("rerank_data",d)}},this.getRerankData=function(){var c=this.defaultRerankData,d=store.get("rerank_data");if(d&&typeof d.tooltips!=="undefined"){c.tooltips=d.tooltips}if(d&&typeof d.sharedUrl!=="undefined"){c.sharedUrl=d.sharedUrl}if(d&&typeof d.currentUrl!=="undefined"){c.currentUrl=d.currentUrl}return JSON.parse(JSON.stringify(c))},this.setTooltipsShown=function(d){var c=this.getRerankData();c.tooltips[d]=true;if(!this.getTooltipsShown(d)){this.setRerankData(c)}},this.getTooltipsShown=function(d){var c=this.getRerankData();return c.tooltips[d]},this.setSharedUrl=function(d){var c=this.getRerankData();c.sharedUrl=d;this.setRerankData(c)},this.setCurrentUrl=function(d){var c=this.getRerankData();c.currentUrl=d;this.setRerankData(c)},this.getCurrentUrl=function(){var c=this.getRerankData();return c.currentUrl},this.getSharedUrl=function(){var c=this.getRerankData();return c.sharedUrl},this.initDragDrop=function(){Position.includeScrollOffsets=true;Sortable.create("reranked_list",{tag:"div",onChange:this.reorder.bind(this),starteffect:this.onDragStart.bind(this),endeffect:this.onDragEnd.bind(this),scroll:window})};this.initHandlers=function(){universal_dom.assign_handler({bucket:"re_rank",event:"click",handler:this.onRerankClick.bind(this)});universal_dom.assign_handler({bucket:"re_rank_up",event:"click",handler:this.onUp.bind(this)});universal_dom.assign_handler({bucket:"re_rank_down",event:"click",handler:this.onDown.bind(this)});universal_dom.assign_handler({bucket:"re_rank_remove",event:"click",handler:this.onRemove.bind(this)});universal_dom.assign_handler({bucket:"re_rank_restore",event:"click",handler:this.onRestore.bind(this)});universal_dom.assign_handler({bucket:"re_rank_reset",event:"click",handler:this.onReset.bind(this)});universal_dom.assign_handler({bucket:"re_rank_submit",event:"click",handler:this.onSubmit.bind(this)});universal_dom.assign_handler({bucket:"re_rank_modal_close",event:"click",handler:this.closeLoginModal.bind(this)});universal_dom.assign_handler({bucket:"re_rankable_mode_close",event:"click",handler:this.closeRerankableMode.bind(this)});universal_dom.assign_handler({bucket:"rerank_sign_in",event:"click",handler:this.signin.bind(this)});universal_dom.assign_handler({bucket:"rerank_submit_name",event:"click",handler:this.submitName.bind(this)});universal_dom.assign_handler({bucket:"re_rank_number_blur",event:"blur",handler:this.onNumberBlur.bind(this)});universal_dom.assign_handler({bucket:"re_rank_number_focus",event:"focus",handler:this.onNumberFocus.bind(this)});universal_dom.assign_handler({bucket:"re_rank_number",event:"change",handler:function(c){rerankable.onNumberChangeDebounced(c)}});universal_dom.assign_handler({bucket:"re_rank_number_keypress",event:"keypress",handler:function(c){rerankable.onNumberKeyPressDebounced(c)}});universal_dom.assign_handler({bucket:"drag_element-md",event:"mousedown",handler:this.onDragElMouseDown.bind(this)});universal_dom.assign_handler({bucket:"reranked-times",handler:this.reranked_times.bind(this)});universal_dom.update(this.container)};this.reranked_times=function(c,d){new Ajax.Request(BF_STATIC.web_root+"/rerank_subbuzz/"+d.buzz_id,{method:"get",onSuccess:function(f){var e=f.responseText.evalJSON();c.innerHTML=e[d.buzz_id]}})};this.onWindowResize=function(){this.ctaTop=this.$cta.cumulativeOffset().top;this.ctaLeft=this.getCtaLeft();this.setCtaLeft()};this.render=function(){this.build();var c=this.list.select(".subbuzz");if(c.length<2){this.isContinue=false;return}this.$cta.removeClassName("hidden");this.$ctaBottom.removeClassName("hidden");universal_dom.update(this.container)};this.build=function(){this.list.update("");$$("#buzz_sub_buzz .buzz_superlist_item").each(function(c){b.buildList(c,b.list)});$$("#reranked_list .subbuzz").each(function(c){c.addClassName("active")});if(this.removable){this.removedList.update('<div class="reranked_removed_list__header">Removed Items</div>');$$("#reranked_removed_subbuzzes .buzz_superlist_item").each(function(c){b.buildList(c,b.removedList)})}this.modeIsReady=true};this.buildList=function(c,d){if(c.select('[class^="buzz_superlist_number"]').length==0){return}if(c.hasClassName("buzz_superlist_item_text")){b.parseText(c,d)}else{if(c.hasClassName("buzz_superlist_item_image")){b.parseImage(c,d)}else{if(c.hasClassName("buzz_superlist_item_video")){b.parseVideo(c,d)}}}};this.parseText=function(d,f){var e={};e.id=d.id.replace("superlist_"+BF_STATIC.campaignid+"_","");var g=this.text_with_emojis(d.select("h2")[0]);var c=this.text(d.select("h2 .buzz_superlist_number_inline")[0]);e.title=g.replace(c+" ","");e.text=this.text_with_emojis(d.select(".sub_buzz_desc")[0]);if(!e.text){e.text=this.text(d.select(".sub_buzz_desc_w_attr")[0])}e.number=d.readAttribute("rel:buzz_num");this.append(e,"text",f)};this.parseImage=function(d,f){var e={};e.id=d.id.replace("superlist_"+BF_STATIC.campaignid+"_","");var g=this.text(d.select("h2")[0]);var c=this.text(d.select("h2 .buzz_superlist_number_inline")[0]);e.title=g.replace(c+" ","");e.image=d.select(".sub_buzz_content img")[0].readAttribute("rel:bf_image_src");e.text=this.text(d.select(".sub_buzz_desc")[0]);if(!e.text){e.text=this.text(d.select(".sub_buzz_desc_w_attr")[0])}e.text=e.text.length>170?e.text.substr(0,167)+"...":e.text;e.number=d.readAttribute("rel:buzz_num");this.append(e,"image",f)};this.parseVideo=function(d,f){var e={};e.id=d.id.replace("superlist_"+BF_STATIC.campaignid+"_","");var g=this.text(d.select("h2")[0]);var c=this.text(d.select("h2 .buzz_superlist_number_inline")[0]);e.title=g.replace(c+" ","");if(d.hasClassName("video_instagram")){e.video=d.select(".sub_buzz_content img")[0].src}else{e.video=d.select(".sub_buzz_content .video-embed-big")[0].readAttribute("rel:thumb")}e.text=this.text(d.select(".sub_buzz_desc")[0]);if(!e.text){e.text=this.text(d.select(".sub_buzz_desc_w_attr")[0])}e.text=e.text.length>250?e.text.substr(0,147)+"...":e.text;e.number=d.readAttribute("rel:buzz_num");this.append(e,"video",f)};this.append=function(g,e,f){if(typeof(this.templates[e+"_subbuzz"])==undefined){console.error("Incorrect template type: "+e);return}var d=new Template(this.templates[e+"_subbuzz"]);var c=d.evaluate(g);f.insert(c)};this.onRerankClick=function(f){var d="top",c=$(f.target).up(".rerank_cta")||$(f.target);this.toggle();this.toggleSaveButton();if(f.target.hasClassName("close")){}else{d=c.hasClassName("rerank_cta_bottom")?"bottom":c.hasClassName("fixed")?"in-scroll":d;gtrack.track_events("Buzz:Re-Rank","re-rank",d,null,null)}};this.onNumberFocus=function(f){var h=$(f.target),g=this.container.select(".tooltip_number_enter")[0];this.startItemNumber=h.getValue();g.removeClassName("hidden");var d=h.cumulativeOffset().left+h.getWidth()/2-g.getWidth()/2+8,c=h.cumulativeOffset().top-g.getHeight()-5;g.setStyle({left:0,top:0});g.setStyle({left:d+"px",top:c+"px"});this.showTooltip(g)};this.onNumberBlur=function(c){if(isNaN(parseInt($(c.target).getValue(),10))||(parseInt($(c.target).getValue(),10)<0)){$(c.target).setValue(this.startItemNumber)}var d=this.container.select(".tooltip_number_enter")[0];this.hideTooltip(d)};this.onNumberChange=function(k){var l,d,f,c,h=this.list.select(".subbuzz"),j=parseInt($(k.target).getValue(),10),m=h.length,g=$(k.target).up(".subbuzz");if(isNaN(j)||(j<0)){$(k.target).setValue(this.startItemNumber);return}j=(j==0)?1:j;this.hideTooltips();if((j>=m)){if(this.startNum!=1){h[0].insert({before:g})}else{h[m-1].insert({after:g})}}else{d=h.indexOf(g)+1;c=(this.startNum!=1)?m-j:j-1;l=parseInt(h[c].select(".rank_numb").first().getValue(),10);if(this.startNum!=1){l=m-l}f=(d>l)?{before:g}:{after:g};h[c].insert(f)}this.animateRankedItem(g);this.toggleSaveButton();this.reorder();this.setTooltipsShown("number_enter")};this.onNumberKeyPress=function(d){var c=d.which||d.keyCode;if(c==Event.KEY_RETURN){this.onNumberChange(d)}};this.onNumberChangeDebounced=BF_UTIL.debounce(this.onNumberChange,300);this.onNumberKeyPressDebounced=BF_UTIL.debounce(this.onNumberKeyPress.bindAsEventListener(this),300);this.onDragElMouseUp=function(){$("reranked_list").select("div.dragging").each(function(c){c.removeClassName("dragging")})};this.onDragElMouseDown=function(d){var c=d.target;if(c.hasClassName("rank_numb")||c.hasClassName("fa-arrow-up")||c.hasClassName("fa-arrow-down")||c.hasClassName("fa-close")||c.hasClassName("fa-plus")){return}if($$("input.rank_numb:focus").length!=0){$$("input.rank_numb:focus")[0].blur();return}if(!c.hasClassName("subbuzz")){c=c.up(".subbuzz")}c.addClassName("dragging")};this.onDragStart=function(){this.hideTooltips();this.setTooltipsShown("top");this.setTooltipsShown("number")};this.onDragEnd=function(d){this.animateRankedItem(d);this.toggleSaveButton();var e=d.id.split("_")[1],c=this.list.select(".subbuzz").indexOf(d)+1;gtrack.track_events("Buzz:Re-Rank","drag/re-order",e+":"+c,null,null)};this.animateRankedItem=function(c){new Effect.Highlight(c,{startcolor:"#fff88f",endcolor:"#ffffff",restorecolor:"#ffffff"})};this.showTooltips=function(){var c=this;this.container.select(".tooltip").each(function(d){if(d.hasClassName("tooltip_number_enter")){return}c.showTooltip(d)})};this.hideTooltips=function(){var c=this;this.container.select(".tooltip").each(function(d){c.hideTooltip(d)})};this.hideTooltip=function(c){c.addClassName("fadeout");setTimeout(function(){if(!c.hasClassName("fadeout")){return}c.addClassName("hidden")},500)};this.showTooltip=function(d){var c=d.getAttribute("rel:data");if(this.getTooltipsShown(c)){return}if(d.hasClassName("fadeout")&&!d.hasClassName("hidden")){d.removeClassName("fadeout")}d.removeClassName("hidden");setTimeout(function(){d.removeClassName("fadeout")},1)};this.onSubmit=function(c){if(this.$submitBtn.hasClassName("disabled")){return false}gtrack.track_events("Buzz:Re-Rank","publish",null,null,null);if(!(new BF_User).isLoggedIn()){this.showLoginModal()}else{this.submit()}};this.submitName=function(c){this.username=this.container.select(".rerank_username")[0].getValue();if(!this.username){this.container.select(".rerank_username")[0].addClassName("error");this.container.select(".rerank_username_error_message")[0].show();return false}this.container.select(".login_modal .close_btn")[0].simulate("click");this.submit()};this.showLoginModal=function(){this.container.select(".login_modal")[0].removeClassName("hidden");this.toggleOverlay();gtrack.track_events("Buzz:Re-Rank","[nc]imp:submit")};this.toggleSaveButton=function(){if(this.getOrder(this.list).join(",")==this.initOrderList){this.$submitBtn.addClassName("disabled")}else{this.$submitBtn.removeClassName("disabled")}};this.closeLoginModal=function(d){var c=$(d.target).up(".modal");c.addClassName("hidden");$("rerank_modal_overlay").addClassName("hidden");$$(".rerank_modal_overlay")[0].addClassName("hidden")};this.closeRerankableMode=function(){this.toggleOverlay();$$(".rerank_confirm_modal")[0].addClassName("hidden");this.hide();this.onReset()};this.toggleOverlay=function(){var c=$("rerank_modal_overlay");if(this.is_not_rerank_mode){if($$(".rerank_modal_overlay")[0].hasClassName("hidden")){$$(".rerank_modal_overlay")[0].removeClassName("hidden")}else{$$(".rerank_modal_overlay")[0].addClassName("hidden")}this.is_not_rerank_mode=false}else{if(c.hasClassName("hidden")){c.removeClassName("hidden")}else{c.addClassName("hidden")}}};this.submit=function(){var d=this;var c={action:"rank",buzz_id:BF_STATIC.campaignid,ranking:this.getOrder(this.list).join(","),display_name:this.getUserName()};if(this.container.down("#reranked_removed_list")){c.unrank=this.getOrder(this.container.down("#reranked_removed_list")).join(",")}$$("#rerank_modal_overlay .loader-6")[0].removeClassName("hidden");this.toggleOverlay();new Ajax.Request("/buzzfeed/rerank_subbuzz",{method:"get",parameters:c,onSuccess:d.onSuccess.bind(d),onFailure:d.onFailure.bind(d)})};this.onSuccess=function(c){var f=JSON.parse(c.responseText),e="Something went wrong, sorry";if(!f||f.success==0){this.toggleOverlay();this.showModal(this.templates.error_modal,"rerank_error_modal",{error:e});return false}var d=this.getUrl(f.id);var g=this;new Ajax.Request("/buzzfeed/_short_url",{method:"get",dataType:"json",parameters:{url:encodeURI(d),buzz_id:11111111111},onComplete:function(j){var h=d;if(j.status=200){var k=j.responseText.evalJSON();if(k.short_url){h=k.short_url}}g.setSharedUrl(h);g.setCurrentUrl(g.getPureUrl(d));gtrack.track_events("Buzz:Re-rank","save-rerank",g.getQueryString(d));document.location.href=d}})};this.showModal=function(c,d,e){if(!$$("."+d).length){templ=new Template(c);e.amazon=this.isAmazon?"amazon-modal":"";html=templ.evaluate((e)?e:{});$(document.body).insert(html);universal_dom.update($$("."+d)[0])}this.toggleOverlay();$$("."+d)[0].removeClassName("hidden")};this.showShare=function(){var c=this.getSharedUrl();if(!c||this.getCurrentUrl()!==this.getPureUrl(document.location.href)){return}this.setSharedUrl("");if($$(".rerank_share_modal").length){this.container.select(".rerank_share_modal")[0].remove()}this.showModal(this.templates.share_modal,"rerank_share_modal",{name:this.data.display_name,url:c});this.is_not_rerank_mode=true;this.toggleOverlay();this.insertShareButtons(c);universal_dom.update($$(".rerank_share_modal")[0])};this.onScroll=function(){var g,e,c=document.viewport.getScrollOffsets().top,d=document.viewport.getHeight();if(a&&(c>0)){this.hideTooltips();this.setTooltipsShown("top");this.setTooltipsShown("number")}if(!this.$cta||a){return}var f=$$("#buzz_header .user-bg")[0]||$$("#buzz_header .reranked_info")[0];g=this.ctaTop<c&&this.ctaBottomTop+40>c+d;e=!this.pinnedThreshold||(this.pinnedThreshold&&c>this.pinnedThreshold);if(g&&e){if(!this.pinnedThreshold){this.pinnedThreshold=this.ctaTop}this.isPinnedCTA=true;this.$cta.addClassName("fixed");f.setStyle({"margin-bottom":"70px"});this.setCtaLeft()}else{this.isPinnedCTA=false;this.$cta.removeClassName("fixed");this.clearCtaLeft();f.setStyle({"margin-bottom":""})}};this.insertShareButtons=function(d){var e=$$(".rerank_share_modal .share_buttons")[0];if(!e){return}var f=this.getQueryString(d);var c={type:"ic_with_txt",divider:false,parentNode:e,url:d,blurb:this.isAmazon?"Create your own holiday wish list and tell your friends and family what you really want this year.":"I just re-ranked this BuzzFeed post. Did I nail it?",gt_label:f};sharing.buttons.facebook_share(Object.extend(Object.clone(c),{divider:true,title:this.isAmazon?"I Just Created My Perfect Holiday Wish List":"My very own take on "+BF_STATIC.buzz_name+"!",gt_act:"share-rerank-facebook"}));if(this.isAmazon){c.blurb="I just created my Amazon holiday wish list. Check it out and make your own!"}sharing.buttons.twitter(Object.extend(Object.clone(c),{hashtags:"",via:this.container.getAttribute("rel:twitter-via")||"buzzfeed",gt_act:"share-rerank-twitter"}))};this.signin=function(){var d=this;bf_login.loggedInCallbacks.push(function(){d.container.select(".login_modal .close_btn")[0].simulate("click");d.submit()});var c=this.container.select(".rerank_panel .submit a")[0].fire("click");c.signin_type="initial";c.mode="badges";c.location="rerank";c.reg_params="";signin.open(c)};this.getUserName=function(){var c=new BF_User;var d=(this.username)?this.username:"";return c.isLoggedIn()?c.getUserInfo().display_name:d};this.getUrl=function(d){var c=sub_links.get_url(),e="",f="";if(c.include("#")){f=c.split("#")[1];c=c.split("#")[0];f=f?"#"+f:""}if(c.include("?")){e=c.split("?")[1];c=c.split("?")[0]}if(e){e=document.location.search?document.location.search+"&"+e:"?"+e}else{e=document.location.search}var h=c.split("/");var g=h.indexOf(BF_STATIC.username)+2;h.splice(g,h.length-g);return h.join("/")+"/"+d+e+f};this.getQueryString=function(c){var d=c.split("/");d.splice(0,d.indexOf(BF_STATIC.username)+2);return"/"+d};this.getPureUrl=function(c){if(c.include("#")){c=c.split("#")[0]}if(c.include("?")){c=c.split("?")[0]}return c};this.onFailure=function(c){$$("#rerank_modal_overlay .loader-6")[0].addClassName("hidden");alert("error");console.debug("fail",c)};this.reorder=function(){var e=this.list.select(".subbuzz");var c=this.list.select(".subbuzz").length;var d,f;e.each(function(g,h){d=h+1;f=c--;if(b.startNum!=1){$(g).select(".rank_numbering input")[0].setValue(f)}else{$(g).select(".rank_numbering input")[0].setValue(d)}g.removeClassName("first").removeClassName("last")});e[0].addClassName("first");e[e.length-1].addClassName("last")};this.onUp=function(g){var f=$(g.target).up(".subbuzz"),e=f.previous(),d=f.readAttribute("data-id"),c;if(!e){return}this.insertBefore(e,f);this.animateRankedItem(f);c=this.list.select(".subbuzz").indexOf(f)+1;gtrack.track_events("Buzz:Re-Rank","arrow-up",d+":"+c,null,null)};this.onDown=function(g){var f=$(g.target).up(".subbuzz"),d=f.next(),e=f.readAttribute("data-id"),c;if(!d){return}this.insertBefore(f,d);this.animateRankedItem(f);c=this.list.select(".subbuzz").indexOf(f)+1;gtrack.track_events("Buzz:Re-Rank","arrow-down",e+":"+c,null,null)};this.onRemove=function(d){this.removing=true;var c=$(d.target).up(".subbuzz");c.removeClassName("dragging");var e=c.id.split("_")[1];this.animateRemoving(c);gtrack.track_events("Buzz:Re-Rank","to-remove",e,null,null)};this.onRestore=function(d){var c=$(d.target).up(".subbuzz");$("reranked_list").insert(c);var e=c.id.split("_")[1];this.reorder();this.checkRemoveAbility();this.toggleSaveButton();this.initDragDrop();gtrack.track_events("Buzz:Re-Rank","restore",e,null,null)};this.onReset=function(){this.modeIsReady=false;this.build();this.checkRemoveAbility();this.toggleSaveButton();this.initDragDrop();universal_dom.update(this.container)};this.animateRemoving=function(c){this.hideTooltips();var d=this;c.setStyle({top:c.positionedOffset().top+"px"});c.addClassName("removing");if($(".removed-hint")!==null){$("removed-hint").remove()}c.insert({before:'<div style="opacity:0;" id="removed-hint"><span>Item Removed</span><div></div></div>'});$("reranked_removed_list").down(".reranked_removed_list__header").insert({after:c});c.removeClassName("removing");c.removeClassName("dragging");c.setStyle({top:"",left:""});new Effect.Opacity("removed-hint",{from:0,to:1,duration:0.5,afterFinish:function(){new Effect.Opacity("removed-hint",{from:1,to:0,duration:0.5,afterFinish:function(){new Effect.Morph("removed-hint",{style:{height:"0px"},delay:0,duration:0.5,afterFinish:function(e){e.element.remove();d.reorder();d.checkRemoveAbility();d.toggleSaveButton();d.initDragDrop();d.removing=false}})}})}})};this.checkRemoveAbility=function(){if($$("#reranked_list .subbuzz").length>1&&this.removable){$$(".reranked_list_holder")[0].addClassName("reranked-removing")}else{$$(".reranked_list_holder")[0].removeClassName("reranked-removing")}};this.insertBefore=function(d,c){this.hideTooltips();d.insert({before:c});this.toggleSaveButton();this.reorder()};this.toggle=function(){if(a){this.showModal(this.templates.confirm_modal,"rerank_confirm_modal",{label:this.isAmazon?"wish list":"re-ranking"})}else{this.show()}};this.placeTooltips=function(){var d=this.list.select(".subbuzz")[1];var g=d.select(".rank_numbering input")[0],c=this.container.select(".tooltip_number")[0];c.setStyle({visibility:"hidden"}).removeClassName("hidden");var e=g.cumulativeOffset().left,f=g.cumulativeOffset().top+g.getHeight()+5;c.setStyle({left:e+"px",top:f+"px"});c.addClassName("hidden").setStyle({visibility:"visible"})};this.show=function(){this.render();this.initDragDrop();this.reorder();var c=["pin_bd","pin_bg","shares-copy-link"];$$("body>div").each(function(d){if(d.hasClassName("rerankable_container")||d.hasClassName("rerank_confirm_modal")||d.hasClassName("rerank_error_modal")||d.hasClassName("spinner_container")){return}if(d.id&&c.indexOf(d.id)!=-1){return}d.addClassName("hidden_by_rerank")});this.container.removeClassName("hidden");window.scrollTo(0,0);this.placeTooltips();a=true;this.showTooltips()};this.hide=function(){$$(".hidden_by_rerank").each(function(c){c.removeClassName("hidden_by_rerank")});this.container.addClassName("hidden");a=false;this.onScroll()}};if(!rerankable!="1"){var rerankable=new Rerankable;BuzzLoader.register(rerankable.init.bind(rerankable),1)}var BF_DFA=function(){this.custom_vars={"click:react/":"http://ad.doubleclick.net/activity;src=3919961;type=sitea636;cat=react674;ord=[timestamp]?","click:share/pinterest":"http://ad.doubleclick.net/activity;src=3919961;type=sitea636;cat=share783;ord=[timestamp]?","click:share/email":"http://ad.doubleclick.net/activity;src=3919961;type=sitea636;cat=share080;ord=[timestamp]?","click:share/twitter/tweet":"http://ad.doubleclick.net/activity;src=3919961;type=sitea636;cat=share802;ord=[timestamp]?","click:share/facebook/like":"http://ad.doubleclick.net/activity;src=3919961;type=sitea636;cat=share810;ord=[timestamp]?","click:share/facebook/share":"http://ad.doubleclick.net/activity;src=3919961;type=sitea636;cat=share814;ord=[timestamp]?","video:end":"http://ad.doubleclick.net/activity;src=3919961;type=video012;cat=video469;ord=[timestamp]?","video:reached:25%":"http://ad.doubleclick.net/activity;src=3919961;type=video012;cat=video827;ord=[timestamp]?","video:reached:50%":"http://ad.doubleclick.net/activity;src=3919961;type=video012;cat=video064;ord=[timestamp]?","video:reached:75%":"http://ad.doubleclick.net/activity;src=3919961;type=video012;cat=video878;ord=[timestamp]?","click:video-play":"http://ad.doubleclick.net/activity;src=3919961;type=video012;cat=video618;ord=[timestamp]?"};this.fire_event=function(a){if(!dfa.status()){return false}var b=dfa.fetch_uri(a);if(typeof b=="undefined"){return false}if(BF_STATIC.bf_env!="live"){console.log("DFA: "+b)}else{trackPixel(b)}};this.status=function(){var a=objExists(BF_STATIC.f_ad)?BF_STATIC.f_ad=="1"?true:false:false;return a};this.fetch_uri=function(b){var c;for(v in dfa.custom_vars){if(b.match(v)){c=dfa.custom_vars[v]}}return c}};var dfa=new BF_DFA();BF_comment_links=function(){this.box_id;this.init=function(){universal_dom.assign_handler({bucket:"share-social",handler:comment_links.show_share_box,event:"click"});universal_dom.assign_handler({bucket:"share-comment",handler:comment_links.show_share_box,event:"click"});universal_dom.assign_handler({bucket:"fb-share-comment",handler:comment_links.comment_share,event:"click"});universal_dom.assign_handler({bucket:"tw-share-comment",handler:comment_links.comment_share,event:"click"});universal_dom.assign_handler({bucket:"link-share-comment",handler:comment_links.comment_share,event:"click"});universal_dom.assign_handler({bucket:"em-share-comment",handler:comment_links.comment_share,event:"click"});universal_dom.assign_handler({bucket:"pin-share-comment",handler:comment_links.comment_share,event:"click"});comment_links.fix_box_height();if(document.URL.include("?comment")){var url=document.URL.toQueryParams();comment_links.highlite(url.comment)}if(document.URL.include("?commentid")){var url=document.URL.toQueryParams();comment_links.highlite(url.commentid)}document.observe("scroll",comment_links.hide_share_box);document.observe("click",comment_links.click_hide_share_box);$$(".comment-share .share-icon").each(function(share_el){share_el.observe("click",comment_links.comment_share)})};this.fix_box_height=function(){$$(".comment-share").each(function(el){if(el.select(".share-icon#pinterest").length==0){$(el).setStyle({height:"120px"})}})};this.click_hide_share_box=function(e){try{if(typeof(e.target)=="undefined"||!isHTMLElement(e.target)){console.log("Not html element. SVG fix.");return}if(!$(e.target).up(".share")&&!$(e.target).hasClassName("share")&&!$(e.target).up(".comment-share")&&!$(e.target).hasClassName("comment-share")){comment_links.hide_share_box()}}catch(e){console.error(e)}};this.hide_share_box=function(){if(comment_links.box_id){var share=$(comment_links.box_id).select(".comment-share").first(),social=$(comment_links.box_id).select(".comment-social").first(),lovehate_buttons=$(comment_links.box_id).select(".comment-lovehate-buttons").first(),copy_link=$(comment_links.box_id).select(".copy-link").first();if(share){share.addClassName("hidden")}if(social){social.addClassName("hidden")}if(lovehate_buttons){lovehate_buttons.addClassName("hidden")}if(copy_link){copy_link.remove()}comment_links.box_id=null}};this.show_share_box=function(e){var main_element=e.target.up("a");if(main_element&&typeof main_element!=undefined){var data=eval("("+main_element.getAttribute("rel:bf_bucket_data")+")")}var comment_id=data["share-comment"].id;if(!($(e.target).up("#link")||$(e.target).up(".copy-link"))){comment_links.hide_share_box()}var container=$(main_element).up("li");if(typeof container=="undefined"||!("className" in container)){return false}className=container.className;className.split(" ").each(function(item){var box=$(comment_id).select(".comment-"+item).first();if(typeof box!=="undefined"){if(!comment_links.box_id){comment_links.box_id=comment_id;box.removeClassName("hidden");if(item==="share"||item==="social"){var btn={left:Number(container.positionedOffset()[0]),top:Number(container.positionedOffset()[1]),height:Number(container.getHeight()),width:Number(container.getWidth())};box.setStyle({left:(btn.left-4)+"px",top:(btn.top+btn.height)+"px",height:"auto"})}}}})};this.highlite=function(id){var comment=$(id);if(comment){if(comment.nodeName=="DIV"){comment=comment.parentNode}comment.select("div.what")[0].style.border="2px solid yellow";comment.scrollTo();setTimeout(function(){comment.scrollTo()},2000)}else{}};this.comment_share=function(e){var main_element=e.target.up();var share_data=eval("("+main_element.getAttribute("rel:share_data")+")");var react_cam_comment=(objExists(e.react_cam)&&e.react_cam==true?true:false);var comment=$(share_data.id);var comment_id=comment.getAttribute("rel:comment_id");var url=comment_links.get_url(comment_id);var desc,title,img;var comment_data=comment.getAttribute("rel:data");comment_data=eval("("+comment_data+")");if(comment&&comment.select(".blurb")[0]){desc=comment.select(".blurb")[0].textContent}if(comment_data.type=="image"){img=comment.select(".image img")[0].src}if(comment_data.type=="react_image"){img=comment.select(".react_image img")[0].src}if(comment_data.type=="video"){if(comment.select(".video iframe").length){img=comment.select(".video iframe")[0].src}else{img=comment.select(".video embed")[0].src}}if(comment_data.type=="mixedpic"){img=comment.select(".mixedpic img")[0].src.replace(/(.+)(\.gif)/,"$1_preview$2")}if(!title&&$$('meta[property="og:title"]').length>0){title=$$('meta[property="og:title"]')[0].attributes.content.value}if(!desc&&$$('meta[property="og:description"]').length>0){desc=$$('meta[property="og:description"]')[0].attributes.content.value}if(!img&&$$('meta[property="og:image"]').length>0){img=$$('meta[property="og:image"]')[0].attributes.content.value}if(title.indexOf("Contribution To: ")<0){title="Contribution To: "+title}if(main_element.id=="facebook"){url=encodeURIComponent(url);title=encodeURIComponent(title);desc=encodeURIComponent(desc);img=encodeURIComponent(img);window.open("http://facebook.com/sharer/sharer.php?s=100&p[url]="+url+"&p[title]="+title+"&p[images][0]="+img+"&p[summary]="+desc,"_blank","width=600, height=260");comment_links.hide_share_box();if(react_cam_comment&&window.bf_react_cam){bf_react_cam.track("contrib_fb_share")}}else{if(main_element.id=="twitter"){desc=encodeURIComponent((desc.length>120)?desc.substr(0,115)+"...":desc);url=encodeURIComponent(url);if(react_cam_comment){if(objExists(BF_STATIC.username)&&BF_STATIC.username=="starbucksfrappuccino"){hashtags="sipface"}desc="I just left a reaction with the Frappuccino® Reaction Cam."}window.open("https://twitter.com/intent/tweet?text="+desc+(typeof hashtags!="undefined"?"&hashtags="+hashtags:"")+"&url="+url,"_blank","width=600,height=400");comment_links.hide_share_box();if(react_cam_comment&&window.bf_react_cam){bf_react_cam.track("contrib_tw_share")}}else{if(main_element.id=="email"){url=encodeURIComponent(url);title=encodeURIComponent(title);desc=encodeURIComponent(desc);window.open("mailto:?subject="+title+"&body="+desc+" "+url,"_self");comment_links.hide_share_box();if(react_cam_comment&&window.bf_react_cam){bf_react_cam.track("contrib_email_share")}}else{if(main_element.id=="link"){$(comment).select(".copy-link").each(function(cp){$(cp).remove()});$(comment).select(".comment-share").each(function(el){$(el).insert('<div class="copy-link"><span>Share This Link</span><input type="text" value="'+url+'" /></div>')});if(react_cam_comment&&window.bf_react_cam){bf_react_cam.track("contrib_link_share")}}else{if(main_element.id=="pinterest"){url=encodeURIComponent(url);desc=encodeURIComponent(desc);img=encodeURIComponent(img);window.open("http://pinterest.com/pin/create/button/?media="+img+"&url="+url+"&description="+desc,"_blank","width=600,height=400");comment_links.hide_share_box()}}}}}};this.get_url=function(id){if(typeof pound!="undefined"){return pound.urls.unescaped.queryStringOnly([],[["comment",id]])}var pairs=[];var searchAsObject={};if(!!document.location.search){pairs=document.location.search.substr(1,document.location.search.length).split("&");for(var i=0,len=pairs.length;i<len;i++){var pair=pairs[i].split("=");if(pair.length==2){searchAsObject[pair[0]]=pair[1]}else{searchAsObject[pair[0]]=""}}}searchAsObject.comment=id;var pairs=[];for(var i in searchAsObject){if(searchAsObject.hasOwnProperty(i)){pairs.push(i+"="+searchAsObject[i])}}var search="?"+pairs.join("&");return document.location.protocol+"//"+document.location.host+document.location.pathname+search+document.location.hash}};var comment_links=new BF_comment_links();BuzzLoader.register(comment_links.init,1);(function(aO,aN,aM){function Z(b){ag(arguments,function(a,c){b[a]===aM&&(b[a]=c)});return b}function aa(b){ag(arguments,function(a,d){b[aC][ab(b,a)||a]=d});return b}function ab(e,c){var k=e[aC],j,h;if(k[c]!==aM){return c}c=c.charAt(0).toUpperCase()+c.slice(1);for(h=0;h<aj[aK];h++){j=aj[h]+c;if(k[j]!==aM){return j}}}function ac(h,e){var m=[aF,e,~~(h*100)].join("-"),l="{"+aF+":"+h+"}",k;if(!ai[m]){for(k=0;k<aj[aK];k++){try{ad.insertRule("@"+(aj[k]&&"-"+aj[k].toLowerCase()+"-"||"")+"keyframes "+m+"{0%{"+aF+":1}"+e+"%"+l+"to"+l+"}",ad.cssRules[aK])}catch(j){}}ai[m]=1}return m}function ae(e,d,f){f&&!f[av]&&ae(e,f),e.insertBefore(d,f||null);return e}function af(b){var d=aN.createElement(b||"div");ag(arguments,function(e,c){d[e]=c});return d}function ag(f,e){var h=~~((f[aK]-1)/2);for(var g=1;g<=h;g++){e(f[g*2-1],f[g*2])}}var aL="width",aK="length",aJ="radius",aI="lines",aH="trail",aG="color",aF="opacity",aE="speed",aD="shadow",aC="style",aB="height",aA="left",az="top",ay="px",ax="childNodes",aw="firstChild",av="parentNode",au="position",at="relative",ar="absolute",aq="animation",ap="transform",ao="Origin",an="Timeout",am="coord",al="#000",ak=aC+"Sheets",aj="webkit0Moz0ms0O".split(0),ai={},ah;ae(aN.getElementsByTagName("head")[0],af(aC));var ad=aN[ak][aN[ak][aK]-1],Y=function(b){this.opts=Z(b||{},aI,12,aH,100,aK,7,aL,5,aJ,10,aG,al,aF,0.25,aE,1)},X=Y.prototype={spin:function(s){var q=this,p=q.el=q[aI](q.opts);s&&ae(s,aa(p,aA,~~(s.offsetWidth/2)+ay,az,~~(s.offsetHeight/2)+ay),s[aw]);if(!ah){var o=q.opts,k=0,j=20/o[aE],h=(1-o[aF])/(j*o[aH]/100),g=j/o[aI];(function a(){k++;for(var c=o[aI];c;c--){var d=Math.max(1-(k+c*g)%j*h,o[aF]);q[aF](p,o[aI]-c,d,o)}q[an]=q.el&&aO["set"+an](a,50)})()}return q},stop:function(){var a=this,c=a.el;aO["clear"+an](a[an]),c[av]&&c[av].removeChild(c),a.el=aM;return a}};X[aI]=function(f){function g(a,k){return aa(af(),au,ar,aL,f[aK]+f[aL]+ay,aB,f[aL]+ay,"background",a,"boxShadow",k,ap+ao,aA,ap,"rotate("+~~(360/f[aI]*d)+"deg) translate("+f[aJ]+ay+",0)","borderRadius","100em")}var e=aa(af(),au,at),j=ac(f[aF],f[aH]),d=0,h;for(;d<f[aI];d++){h=aa(af(),au,ar,az,1+~(f[aL]/2)+ay,ap,"translate3d(0,0,0)",aq,j+" "+1/f[aE]+"s linear infinite "+(1/f[aI]/f[aE]*d-1/f[aE])+"s"),f[aD]&&ae(h,aa(g(al,"0 0 4px "+al),az,2+ay)),ae(e,ae(h,g(f[aG],"0 0 1px rgba(0,0,0,.1)")))}return e},X[aF]=function(e,d,f){e[ax][d][aC][aF]=f};var W="behavior",V="url(#default#VML)",U="group0roundrect0fill0stroke".split(0);(function(){var d=aa(af(U[0]),W,V),c;if(!ab(d,ap)&&d.adj){for(c=0;c<U[aK];c++){ad.addRule(U[c],W+":"+V)}X[aI]=function(){function n(h,b,a){ae(j,ae(aa(l(),"rotation",360/g[aI]*h+"deg",aA,~~b),ae(aa(af(U[1],"arcsize",1),aL,f,aB,g[aL],aA,g[aJ],az,-g[aL]/2,"filter",a),af(U[2],aG,g[aG],aF,g[aF]),af(U[3],aF,0))))}function l(){return aa(af(U[0],am+"size",p+" "+p,am+ao,-f+" "+-f),aL,p,aB,p)}var g=this.opts,f=g[aK]+g[aL],p=2*f,j=l(),e=~(g[aK]+g[aJ]+g[aL])+ay,o;if(g[aD]){for(o=1;o<=g[aI];o++){n(o,-2,"progid:DXImage"+ap+".Microsoft.Blur(pixel"+aJ+"=2,make"+aD+"=1,"+aD+aF+"=.3)")}}for(o=1;o<=g[aI];o++){n(o)}return ae(aa(af(),"margin",e+" 0 0 "+e,au,at),j)},X[aF]=function(f,e,h,g){g=g[aD]&&g[aI]||0,f[aw][ax][e+g][aw][aw][aF]=h}}else{ah=ab(d,aq)}})(),aO.Spinner=Y})(window,document);var bf_spinner=function(e,j){var h=false;var f=null;var d;var b=function(){var k=Math.floor((document.viewport.getHeight()/3)/3.5);var l={lines:8,length:k,width:Math.floor(0.66*k),radius:Math.floor(0.9*k),color:"#333",speed:1,trail:100,shadow:true};return l};var a=j||b();if(e&&$(e)){d=$(e)}else{try{d=new Element("div",{"class":"spinner_container",id:"spinner_"+Math.floor(Math.random()*100)});document.body.insert({top:d});var g="display:none;width:100%;position:fixed;left:0;height:"+document.viewport.getHeight()+"px;z-index:9999;top:0;";d.setAttribute("style",g)}catch(c){console.error(c)}}return{active:function(){return f},start:function(){if(f){return true}else{f=true}d.show();if(h){window.document.body.addClassName("spinner-activated");h=h.spin(d);return true}d.on("click",function(k){if(f){k.stop()}});h=new Spinner(a).spin(d)},stop:function(){try{window.document.body.removeClassName("spinner-activated");d.hide();f=false;h.stop()}catch(k){}},started:function(){return f}}};Array.isArray||(Array.isArray=function(b){return"object"===typeof b&&"[object Array]"===Object.prototype.toString.call(b)});var CountView=function(){this._elems_arr=[];this._time_interval=250;this._callback=null;this._interval_id=null};CountView.prototype=(function(){function c(e){e=e||window;if(e.pageXOffset!=null){return{x:e.pageXOffset,y:e.pageYOffset}}}function d(e){e=e||window;if(e.innerWidth!=null){return{w:e.innerWidth,h:e.innerHeight}}}var a=function(j){var l=j.offsetTop;var k=j.offsetLeft;var h=j.offsetWidth;var g=j.offsetHeight;while(j.offsetParent){j=j.offsetParent;l+=j.offsetTop;k+=j.offsetLeft}var f=c();var e=d();return(l<(f.y+e.h)&&k<(f.x+e.w)&&(l+g)>f.y&&(k+h)>f.x)};var b=function(){for(var f=0,e=this._elems_arr.length;f<e;f++){var g=this._elems_arr[f];if(a.call(this,g.elem)){g.time+=this._time_interval;g.active=true}else{g.active=false}}if(this._callback){this._callback(this._elems_arr)}};return{set_elems_arr:function(f,h){if(!Array.isArray(f)){f=[f]}for(var g=0,e=f.length;g<e;g++){this._elems_arr.push({elem:$(f[g]),time:0,active:false})}},get_elems_stat:function(){return this._elems_arr},start_count:function(e,g){if(e){this._time_interval=e}if(g){this._callback=g}var f=b.bind(this);f();this._interval_id=setInterval(f,this._time_interval)},stop_count:function(){if(this._interval_id){clearInterval(this._interval_id);this._interval_id=null}}}}());var HeatMap=function(){var g,b,w,t,a={},m=250,e=1800000,o=10,f=new CountView(),k=BF_STATIC.bf_env=="dev"?"/":"/buzzfeed/",c=BF_STATIC.web_root+k+"item_stats",d=document.location.search.toQueryParams(),j=d.hasOwnProperty("heatmap_debug"),y=d.hasOwnProperty("heatmap_track"),l=d.hasOwnProperty("heatmap_display"),A=d.hasOwnProperty("selenium");var s=function(){g=BF_STATIC.campaignid;b=$$(".buzz_superlist_item");if(!acl.user_can("general_admin")){y=l=false}t=y?1:o;w=y?true:((Math.floor(Math.random()*t)+1)==t);if(w){gtrack.track_events("[ttp]:heatmap_tracking","[nc]initialized","","",true);if(BF_STATIC.bf_env!="live"){console.log("HEATMAP: Tracking stats for this visit.")}if(!A){if(window.onpagehide||window.onpagehide===null){window.onpagehide=u}else{window.onbeforeunload=u}}f.set_elems_arr(b);f.start_count(m,h)}if(l){q();p()}};var h=function(F){if(j){for(var D=0,C=F.length;D<C;D++){var E=F[D]["elem"];var H=F[D]["time"];var G=F[D]["active"];if(G){var B=z(E);console.log("unit_number: "+B);var I="green"}else{var I="#C70000"}$(E).setStyle({backgroundColor:I})}}};var z=function(D){var B=null,C=$(D.id);if(C){B=C.readAttribute("rel:buzz_num")}return B};var n=function(C){var B=C.id;if(matches=B.match(/(\w+)_(\d+)_(\d+)/)){return matches[3]}return null};var x=function(K){var E=(!K||!K.hasOwnProperty("type"))?"current":K.type;if(E!=="historical"){var H=f.get_elems_stat();var J={};for(var F=0,G=H.length;F<G;F++){var D=H[F]["elem"];var C=H[F]["time"];var B=z(D);if(B!=null){C=(C>e)?e:C;var I=n(D);J[B]={sub_buzz_id:I,time:C}}}return J}else{new BF_Request().request(c,{method:"get",parameters:{action:"get_stat",buzz_id:g},onSuccess:K.onSuccess})}};var u=function(){if(w&&g){gtrack.track_events("[ttp]:heatmap_tracking","[nc]tracking-started","","",true);var C=x();var E=Object.toJSON(C);var B={action:"save_stat",buzz_id:g,item_stat:E};var D=new BF_Request();D.request(c,{method:"post",asynchronous:false,parameters:B,onSuccess:function(F){gtrack.track_events("[ttp]:heatmap_tracking","[nc]tracking-complete","","",true);if(BF_STATIC.bf_env!="live"){console.log("HEATMAP: Successfully saved stats.",E)}},onFailure:function(F){gtrack.track_events("[ttp]:heatmap_tracking","[nc]tracking-failed","","",true);if(BF_STATIC.bf_env!="live"){console.log("HEATMAP: Error saving stats.",F)}}})}};var q=function(){var B=$("buzz_sub_buzz"),C=B.className,F=C.match("suplist"),E=C.match("suplist_none"),D=function(I){var K=[],L=0,J=(d.heatmap_display==="time")?"heatmap-time":"heatmap-views",N=function(S){var P=Math.floor(S/(60*60)),T=S%(60*60),R=Math.floor(T/60),O=T%60,U=Math.ceil(O),Q=function(V){return(V<10)?"0"+V:V};return Q(P)+":"+Q(R)+":"+Q(U)},M=function(R,T,O,Q){var U=(J==="heatmap-time")?T:O,P=(O!=0)?Math.round(parseInt(T)/10)/100/O:0,S=(Q!=0)?Math.round(parseInt(O)*100/Q):0;statsHtml='<div class="sb-stats arrow_box">                <div class="sb-views"><div class="sb-val">'+S+'%</div><div class="sb-label">VIEWED THIS</div></div>                <div class="sb-time"><div class="sb-val">'+N(P)+'</div><div class="sb-label">AVG TIME</div></div></div>';R.insert(statsHtml);L++;R.writeAttribute("rel:"+J,U);K.push(R)},H=function(){return $(this).readAttribute("rel:"+J)};var G=0;b.each(function(P,O){itemId=n(P),matchIndex=[],itemStats=I.findAll(function(R,Q){if(R.sub_buzz_id!==itemId){return false}matchIndex.push(Q);return true});if(matchIndex.length){itemStats.each(function(Q){G=(parseInt(Q.total_views)>G)?parseInt(Q.total_views):G})}});b.each(function(R,Q){var P,T=n(R),O=[],S=I.findAll(function(V,U){if(V.sub_buzz_id!==T){return false}O.push(U);return true});if(O.length){O.each(function(U){I.splice(U,1)});S.each(function(U){if(+U.position===(L+1)){M(R,U.total_time,U.total_views,G)}})}else{P=!E&&(R.select(".buzz_superlist_number_inline").length||R.select(".buzz_superlist_number").length);if(E||P){M(R,0,0,0)}}});B.addClassName(J)};if(!g||!F){return}x({type:"historical",onSuccess:function(I){var G=I.responseText.evalJSON(),H=G.stats;if(!G.success){if(BF_STATIC.bf_env!="live"){console.log("HEATMAP: Error retrieving stats.")}return}if(Object.prototype.toString.apply(H)!=="[object Array]"||!H.length){if(BF_STATIC.bf_env!="live"){console.log("HEATMAP: No stats returned for this post.")}return}D(H)}})};var p=function(){var C=document.getElementsByClassName("share-box"),B;for(var B=0;B<C.length;B++){C[B].style.display="none"}};return{init:function(){try{s()}catch(B){if(BF_STATIC.bf_env!="live"){console.error(B)}}},get_stat:function(){return x()},save_stat:function(){return u()}}}();if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.language!="undefined"&&typeof countryLangLookup!="undefined"){window.___gcfg={lang:countryLangLookup[BF_STATIC.language],}}BF_UTIL.createScript({url:"https://apis.google.com/js/client:plusone.js?onload=GCallback"});if(BF_STATIC.bf_test_mode&&BF_STATIC.bf_env=="dev"){(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="https://apis.google.com/js/client:plusone.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()}function GCallback(){EventManager.fire("gplus:api-loaded")}var HeatColor=function(e,f,b){var c={elementFunction:function(){return $(this)},minval:0,maxval:0,lightness:0.75,colorStyle:"roygbiv",reverseOrder:false};if(b){Object.extend(c,b)}var d={findcolor:function(p,l,t){var m=(l===t)?1:(p-l)/(t-l);var j=c.colorStyle=="roygbiv"?0.5*m+1.7*(1-m):m+0.2+5.5*(1-m);var k=128;var o=2*Math.PI;var s=j+m*o;s=c.colorStyle!="roygbiv"?-s:s;var h=this.process(Math.floor((Math.cos(s)+1)*k));var n=this.process(Math.floor((Math.cos(s+Math.PI/2)+1)*k));var q=this.process(Math.floor((Math.cos(s+Math.PI)+1)*k));return"#"+h+n+q},process:function(g){var j=Math.floor(g+c.lightness*(256-g));var h=j.toString(16);h=h.length==1?"0"+h:h;return h},setMaxAndMin:function(g){var h=[];g.each(function(j){h.push(f.apply(j))});h=h.sort(function(k,j){return k-j});c.maxval=!c.reverseOrder?h[h.length-1]:h[0];c.minval=!c.reverseOrder?h[0]:h[h.length-1]}};if(!c.minval&&!c.maxval){d.setMaxAndMin(e)}else{if(c.reverseOrder){var a=c.minval;c.minval=c.maxval;c.maxval=a}}e.each(function(h){var k=f.apply(h);var j=d.findcolor(k,c.minval,c.maxval);var g=c.elementFunction.apply(h);if(g.nodeType==1){g.setStyle({backgroundColor:j})}else{if(g.nodeType==3){g.setStyle({color:j})}}});return(this)};BFContribute=function(){this.ERR='Sorry, there was a problem processing your request. If it persists please <a href="http://www.buzzfeed.com/about/contact">contact support</a>.';this.ERR_DUPE="Woops. It looks like you've already contributed this response.";this.TEXT_ERR="Please add your message.";this.IMAGE_ERR="Please add your image and a description.";this.IMAGE_TOO_LARGE="Max image upload size is 2 megabytes.";this.VIDEO_ERR="Please add a valid video link and a description.";this.QUOTE_ERR="Please add a quote and an author.";this.LINK_ERR="Please add a link and a description.";this.ERR_BLIST="An error has occurred processing a request from your IP. If it continues, contact error@buzzfeed.com.";this.type_list=new Array("text","video","image","link");this.buzz_data={};this.subContributeParent=0;this.main_buzz_id;this.init=function(){bf_login.init();var user_info=(new BF_User()).getUserInfo();if(user_info&&typeof user_info.p_disable_comment!="undefined"&&user_info.p_disable_comment=="true"){$$("#contribute-box").each(function(el){el.style.display="none"});return true}if(!$("contribute-form")){return}var submit_handler=function(event){event.stop();bf_contribute.submit()}.bind(this);if($("contribute-id")){bf_contribute.main_buzz_id=$("contribute-id").value}$("add-something-interesting").observe("click",function(event){event.stop();bf_contribute.reset_contribute_box()});$$(".respond").invoke("observe","click",bf_contribute.observeRespond);$("contribute-form").observe("submit",submit_handler);$("contribute-submit").show();$("contribute-post").observe("click",function(e){$("submit-mode").value="save"});$("contribute-submit").observe("click",function(e){$("submit-mode").value="preview"});var fwipeit=function(type){return function(event){event.stop();bf_contribute_toggleTabs("on");if($("respond")){$("respond").removeClassName("previewing")}$("contribute-message").update("");$("contribute-message").hide();$("contribute-preview").hide();$("contribute-form").reset();$("contribute-cancel").hide();$("image-button").value="Select Image...";$("contribute-post").hide();$("contribute-submit").value="Preview";$("contribute-preview-content").update()}};$("contribute-cancel").observe("click",fwipeit(true));$("contribute-close-success-box").observe("click",function(e){$("contribute-success").hide()});bf_contribute.goforit_default();var switch_function=function(e){e.stop();type=e.element().id.match(/(^\w+)/)[0];bf_contribute.disableCurrent();var button_id=type+"-contribute-activate";bf_contribute.buttonToggle(button_id);var form_id="contribute-"+type+"-form";bf_contribute.enableForm(form_id);if($("big-pink-arrow")){$("big-pink-arrow").style.display="none"}return false}.bind(this);for(i=0;i<bf_contribute.type_list.length;i++){var id=bf_contribute.type_list[i]+"-contribute-activate";var element=$(id);if(element){element.observe("click",function(e){e.stop();switch_function(e);return false})}}$("create_full_post_toggle").observe("click",function(e){e.stop();$$(".full-post-field").invoke("show");$("create_full_post_toggle").hide();$("create_simple_post_toggle").show()});$("create_simple_post_toggle").observe("click",function(e){e.stop();$$(".full-post-field").invoke("hide");$("create_full_post_toggle").show();$("create_simple_post_toggle").hide()});var vid_embed=$("video-embed");if(vid_embed){$("video-embed").observe("mouseup",function(){bf_contribute.setVideo()}.bindAsEventListener(this));$("video-embed").observe("keyup",function(){bf_contribute.setVideo()}.bindAsEventListener(this))}var image_button=$("image-button");var photo_editor_button=$("photo-editor-button");if(image_button&&Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6){var image_handler=function(e){e.stop();$("image-preview-div").show();$("image-preview").hide();if($("user-loading")){$("user-loading").show()}$("user-image-edit-iframe").src="/static/images/public/spinners/big_on_eee.gif";$("user-image-edit").addClassName("bf_dialog_confirm");BF_UI.showDialog("user-image-edit");$("user-image-edit-iframe").src="/buzzfeed/_edit_user_contribution_image?action=imageform"}.bindAsEventListener(this);image_button.observe("click",image_handler);image_button.show();if(photo_editor_button){photo_editor_button.hide()}}if(photo_editor_button){var editor_handler=function(e){e.stop();if($("user-loading")){$("user-loading").show()}$("user-image-edit-iframe").src="/static/images/public/spinners/big_on_eee.gif";$("user-image-edit").removeClassName("bf_dialog_confirm");BF_UI.showDialog("user-image-edit","Edit a Photo");var over_query="";if($("photo_editor_image")){over_query="&overlay="+escape($F("photo_editor_image"))}$("user-image-edit-iframe").src="/buzzfeed/_edit_photo_editor_image?action=imageform"+over_query}.bindAsEventListener(this);photo_editor_button.observe("click",editor_handler)}if($("video-supported-text")){$("video-supported-text").update(BF_VIDEO_TYPES_STRING)}bf_contribute.update_contribs()};this.reset_contribute_box=function(){$("contribute-form").reset();bf_contribute_toggleTabs("on");$("contribute-cancel").hide();$("contribute-post").hide();$("contribute-submit").value="Preview";$("contribute-preview-content").update();$("contribute-parent-id").setValue(0);var add_interesting=$("add-something-interesting");add_interesting.parentNode.insertBefore($("contribute-box"),add_interesting.nextSibling);add_interesting.parentNode.insertBefore($("contribute-preview-content"),add_interesting.nextSibling);bf_contribute.subContributeParent=0};this.update_contribs=function(){var messages=$$(".contribution-list .what .blurb");messages.each(function(el){bf_contribute.create_list_link($(el))})};this.create_list_link=function(el){if(!el||!bf_contribute.buzz_data){return}if(!bf_contribute.fetched_buzz){bf_contribute.fetch_buzz_data()}var msg=$(el).innerHTML;var reg_p=new RegExp("(?!>)(#[0-9]+)(?!</a>)","g");var reg_m=new RegExp("[^0-9]+","g");var data=bf_contribute.buzz_data;var media_keys=[];while(msg.match(reg_p)){r=msg.match(reg_p);msg=msg.replaceAll(r[0],"");key=r[0].replace(reg_m,"");if(data.hasOwnProperty(key)){var link="";link='<a class="scroll" href="javascript:void(0);" onclick="BF_Effect.ScrollIntoView('+data[key].eid+')">';$(el).innerHTML=$(el).innerHTML.replaceAll(r[0],link+"#"+key+"</a>");if(data[key].btype.match("image|video")&&data[key].img&&media_keys.indexOf(key)<0&&!data[key].is_graphic){$(el).innerHTML=$(el).innerHTML+link+"<img src='"+data[key].img+"' class='list_img_thumb'></a>";media_keys.push(key)}else{if(data[key].btype.match("grid_row")&&data[key].img&&media_keys.indexOf(key)<0){var contrib_grid_html=link.replace('class="scroll"','class="scroll contrib_grid_row"');for(i=0;i<data[key].img.length;i++){contrib_grid_html=contrib_grid_html+"<img src='"+data[key].img[i]+"' class='list_grid_row_thumb'>";media_keys.push(key)}contrib_grid_html="<div>"+contrib_grid_html+"</div>";$(el).innerHTML=$(el).innerHTML+contrib_grid_html+"</div></a>"}}}}};this.fetch_buzz_data=function(){$$(".buzz_superlist_item").each(function(el){var down=$(el).down(".buzz_superlist_number, .buzz_superlist_number_inline");if(!down){return false}var key=down?down.innerHTML.replace(".",""):"";var content=$(el).down(".sub_buzz_content")?$(el).down(".sub_buzz_content"):"";var classname=$(el).className;var is_graphic=false;try{is_graphic=content.down(".graphic_image_wrapper")}catch(e){}bf_contribute.buzz_data[key]={eid:$(el).id,btype:classname.match("image")?"image":classname.match("video")?"video":classname.match("grid_row")?"grid_row":"na",is_graphic:is_graphic};if(bf_contribute.buzz_data[key].btype.match("image")){var img=$(content).down("img");bf_contribute.buzz_data[key].img=img.hasAttribute("rel:bf_image_src")&&!img.src.match(/_preview.gif/)?img.getAttribute("rel:bf_image_src"):img.src}else{if(bf_contribute.buzz_data[key].btype.match("video")){var embed_area=$(content).down(".video-embed-area");if(embed_area){bf_contribute.buzz_data[key].img=embed_area.getAttribute("rel:thumb")}}else{if(bf_contribute.buzz_data[key].btype.match("grid_row")){bf_contribute.buzz_data[key].img=[];$(el).select(".grid_cell img").each(function(img){bf_contribute.buzz_data[key].img.push(img.hasAttribute("rel:bf_image_src")&&!img.src.match(/_preview.gif/)?img.getAttribute("rel:bf_image_src"):img.src)})}}}});bf_contribute.fetched_buzz=1};this.getFormParams=function(type){var params={form:type,buzz_id:$F("contribute-id"),parent_id:$F("contribute-parent-id"),real_parent_id:$F("contribute-real-parent-id"),category:$F("contribute-category")};switch(type){case"text":var text=$F("text-text");if(!text){this.setErrMessage(this.TEXT_ERR);bf_contribute_toggleTabs("on");if($("contribute-post")){$("contribute-post").hide()}return false}Object.extend(params,{blurb:text});break;case"image":var text=$F("image-text").strip();var image=TT_Filters.html_noentities($F("image-image").strip());var isMixedPic=(bf_contribute.form=="mixedpic"||bf_contribute.form=="mixedpic_wide")?true:false;var credit=TT_Filters.html_noentities(TT_Filters.link($F("image-credit").strip()));if(credit&&!credit.match(/^https?:\/\//)){credit="http://"+credit}if(credit){credit=this.url_entities(credit)}if(!image||(!text&&!isMixedPic)){this.setErrMessage(this.IMAGE_ERR);if($("contribute-post")){$("contribute-post").hide()}if(image){$("image-preview-div").show()}bf_contribute_toggleTabs("on");return false}if($F("submit-mode")=="save"){$("image-preview").hide()}Object.extend(params,{blurb:text,url:image,credit_url:credit,height:this.image_height,width:this.image_width});break;case"video":var text=TT_Filters.html_noentities($F("video-text").strip());var link=TT_Filters.link($F("video-embed-url").strip());if(typeof link=="undefined"){link=""}if(typeof text=="undefined"){text=""}if(link&&!link.match(/^https?:\/\//)){link="http://"+link}if(!text||!link){this.setErrMessage(this.VIDEO_ERR);bf_contribute_toggleTabs("on");if($("contribute-post")){$("contribute-post").hide()}return false}Object.extend(params,{blurb:text,url:link});break;case"quote":var text=TT_Filters.html_noentities($F("quote-text").strip());var author=TT_Filters.html_noentities($F("quote-attribution").strip());if(!text||!author){this.setErrMessage(this.QUOTE_ERR);if($("contribute-add-your-response-heading")){$("contribute-add-your-response-heading").show()}bf_contribute_toggleTabs("on");if($("contribute-post")){$("contribute-post").hide()}return false}Object.extend(params,{blurb:text,author:author});break;case"link":var text=TT_Filters.html_noentities($F("link-text").strip());var link=TT_Filters.link($F("link-url").strip());if(!link.match(/^https?:\/\//)){link="http://"+link}link=this.url_entities(link);if(!text||!link){this.setErrMessage(this.LINK_ERR);bf_contribute_toggleTabs("on");if($("contribute-post")){$("contribute-post").hide()}return false}Object.extend(params,{blurb:text,url:link});break}return params};this.submit=function(registered,params){var user=new BF_User();if(!$("contribute-post")){return false}if(user.isLoggedIn()&&(this.type!="image"||$F("image-image"))){$("contribute-post").show()}$("contribute-message").hide();$("contribute-box").show();if(this.login_enable_form){this.login_enable_form=false;this.enableForm("contribute-"+this.type+"-form")}else{if($F("submit-mode")=="preview"){$("contribute-cancel").show();$("contribute-submit").value="Preview Again";if($("video-preview")){$("video_preview").hide()}}if(params){$("submit-mode").value="preview"}else{params=this.getFormParams(this.type)}if(params!==false){if($F("submit-mode")=="save"){this.postit(params,registered)}else{this.previewFromServer(params,registered)}}}};this.previewFromServer=function(params,registered){$("saving-status").show();var user=new BF_User();if(user.isLoggedIn()){var userInfo=user.getUserInfo();params.username=userInfo.username;params.display_name=userInfo.display_name?userInfo.display_name:userInfo.username;if(userInfo.image&&userInfo.image!=null&&userInfo.image!="null"){params.user_image=userInfo.image}else{params.user_image="/static/images/public/defaults/user_large.jpg"}}else{params.username="You";params.user_image="/static/images/public/defaults/user_large.jpg"}params.action="process";params.template="contribution";params.preview="true";params.since_minutes="1";params.static_root=BF_STATIC.static_root;params.image_root=BF_STATIC.image_root;if(bf_contribute.subContributeParent>0){params.child_comment="1"}var ajax=new BF_Request();ajax.request("/buzzfeed/_template",{method:"post",parameters:params,onSuccess:function(resp){$("contribute-post").disabled=false;var user=new BF_User();var json=resp.responseText;var obj=json.evalJSON();if(obj.success){var html=obj.snippet;if(!(user.isLoggedIn()||registered)){$("contribute-post").show()}this.preview_contribution(html,obj)}else{var errors="";for(var key in obj.errors){if(errors!=""){errors+=", "}errors+=obj.errors[key]}this.setErrMessage(errors);$("contribute-post").hide()}$("saving-status").hide();document.fire("contribute:previewFromServerOk")}.bind(this),onFailure:function(resp){ajax.alert("Error contacting server");$("saving-status").hide();document.fire("contribute:previewFromServerError")},bf_auth:true})};this.preview_contribution=function(preview,obj){var user=new BF_User();if($("big-pink-arrow")){$("big-pink-arrow").style.display="none"}if($("respond")){$("respond").addClassName("previewing")}if($("image-preview")){$("image-preview").hide()}$("contribute-preview-content").update(preview.toString());bf_contribute_toggleTabs("off");if($("who-preview")){console.warn("who-form is obsolete?")}if(user.isLoggedIn()){if(((new BF_User()).getUserInfo()).f_ad=="true"){$$("#contribute-preview-content .contrib")[0].addClassName("ad")}}if(this.type=="video"){var embedVal=$F("video-embed-url");if(embedVal){if(bf_contribute.subContributeParent>0){var so=BF_initSwfObject(embedVal,{width:575,height:375});so.write("video_buzz_element_"+obj.video_preview_uri)}else{var so=BF_initSwfObject(embedVal,{width:605,height:505});so.write("video_buzz_element_"+obj.video_preview_uri)}}}bf_contribute.create_list_link($$("#contribute-preview-content .what .blurb")[0])};this.postit=function(params,registered){var user=new BF_User();if(!user.isLoggedIn()&&!registered){$("submit-mode").value="save";bf_login.delayedLoggedInCallbacks=[];bf_login.delayedLoggedInCallbacks.push({obj:"bf_contribute",fn:"previewAndPostIt",params:[params]});signin.callbacks.onRegister.push(function(obj,json){this[this.type+"Contribution"](json)}.bind(this));signin.open({signin_type:"initial",mode:"contribution",location:"contribution"});return false}$("saving-status").show();this.params=params;var success_handler=function(resp){this._response(resp);document.fire("contribute:postitOk")}.bindAsEventListener(this);var error_handler=function(resp){this.server_error(resp);document.fire("contribute:postitError")}.bindAsEventListener(this);if(params.form=="mixedpic"&&(params.id==1860073||params.id==1927310||params.id==1984234)){this.use_minisuper(params)}else{(new BF_Targetting_Pixel()).add("comment");if(registered){params.session_key=registered.session_key}else{params.session_key=BFW_Util.getCookie(BFW_COOKIE)}params.delete_images="no";var args={method:"post",parameters:params,onSuccess:success_handler,onFailure:error_handler};var user_info=(new BF_User()).getUserInfo();if(user_info.username){args.needsToken=true}var ajax=new BF_Request();$("contribute-post").disabled=true;ajax.request("/buzzfeed/_commentribute",args);$("contribute-submit").value="Preview"}};this._response=function(resp){if($("contribwhat_")){$("contribwhat_").show()}$("saving-status").hide();this.goforit_default();var obj=eval("("+resp.responseText+")");if(obj.updated||(obj.success&&obj.success==1)){if(objExists(obj.last_active)){BFW_Util.updateInfoCookie({last_active:obj.last_active})}var react_cam_comment=(window.bf_react_cam&&objExists(bf_react_cam)&&objExists(obj.uri)&&obj.uri.match(/^reactcam-auto-title/)?true:false);if(this.params.form=="text"){this.params.form_string="responded "}if(this.params.form=="link"){this.params.form_string=" added a link "}if(this.params.form=="image"){this.params.form_string=" added an image "}if(this.params.form=="video"){this.params.form_string=" added a video "}this.params.parent_title=$F("parent_name");this.params.title_is_excerpt=$F("title_is_excerpt");this.params.parent_blurb=$F("parent_blurb");this.params.username=$F("current-username");this.params.buzz_uri=objExists(buzzDetails.uri)?buzzDetails.uri:null;this.params.buzz_username=objExists(BF_STATIC.username)?BF_STATIC.username:null;this.params.id=objExists(obj.id)?obj.id:null;contrib_uri="http://"+BFWebPath()+"/"+this.params.buzz_username+"/"+this.params.buzz_uri+"?comment="+obj.id;if(react_cam_comment&&obj.id){this.goforit_reactcam();contrib_uri="http://"+BFWebPath()+"/"+this.params.username+"/"+this.params.uri+"?comment="+obj.id}if(obj.thumb){this.params.image_src=obj.thumb}else{this.params.image_src=$("image-thumb").value}var share_pic=BFWebPath()+this.params.image_src;if(react_cam_comment){share_pic=BF_STATIC.image_root+obj.image.replace(/\.gif$/m,"_preview.gif")}social.contribute(this.params);if($("permalink-href")){$("permalink-href").setAttribute("href",contrib_uri);$("permalink-href").id+=Math.random()*100000}if($("tools-bar")){$("tools-bar").show();$("tools-bar").id+=Math.random()*100000}var html=$("contribute-preview-content").cloneNode(true);html.id+=Math.random()*100000;var element_id="highlight-"+Math.floor(Math.random()*100);var li=new Element("li",{id:element_id});li.appendChild(html);li.setOpacity(0);if(bf_contribute.subContributeParent!=0){var respond=li.getElementsByClassName("respond");if(respond[0]){respond[0].setAttribute("rel:parent_magic_id",this.params.parent_username+":"+this.params.parent_uri)+":"+html.id}$("contrib-form-container-"+bf_contribute.subContributeParent).insert({before:li})}else{var anchors=li.getElementsByTagName("A");for(var i=0;i<anchors.length;i++){if(!anchors[i].className.match("scroll")){anchors[i].setAttribute("href",contrib_uri)}}$("contribution-list").insert({top:li})}setTimeout(function(){fadeIn(element_id,0)},100);var user=new BF_User();if(user.isLoggedIn()&&!$("moderation_contribute")){removeAllCssClasses("contribute-success");$("contribute-success").addClassName(this.params.type);$("contribute-success-shares").childElements().each(function(el){$(el).remove()});var tw_desc="",fb_desc="",alt_desc=(objExists(obj.cleaned_text)?obj.cleaned_text:"");if(react_cam_comment){if(objExists(BF_STATIC.username)&&BF_STATIC.username=="starbucksfrappuccino"){hashtags="sipface"}tw_desc="I just left a reaction with the Frappuccino® Reaction Cam."}else{if(objExists(obj.cleaned_text)){tw_desc=obj.cleaned_text}}fb_desc=tw_desc;if(objExists(fb_desc)&&fb_desc.indexOf("®")){fb_desc=fb_desc.replace("®","&#174;")}var label="";if(typeof this.params.react_wtih_gif!="undefined"){share_pic="http://"+BFWebPath()+this.params.thumb;label="rwg:"+rwg.cleanGifName(this.params.thumb)}var via="buzzfeed";if(typeof this.params.category!="undefined"){var category=this.params.category.toLowerCase();if(category=="politics"||category=="world"||category=="business"||category=="tech"||category=="usnews"||category=="uknews"||category=="aunews"||category=="francenews"){via="buzzfeednews"}}bf_shares.fb_share({el:$("contribute-success-shares"),title:(objExists(BF_STATIC.buzz_name)?BF_STATIC.buzz_name:document.title),uri:contrib_uri,size:"big",picture:share_pic,description:(objExists(fb_desc)?fb_desc:alt_desc),onclick:("gtrack.track_events('[ttp]:contribution','share/facebook/comment','"+label+"');")});bf_shares.tw_tweet({el:$("contribute-success-shares"),title:(objExists(BF_STATIC.buzz_name)?BF_STATIC.buzz_name:document.title),uri:contrib_uri,size:"big",picture:share_pic,description:tw_desc,via:via,hashtags:(typeof hashtags!="undefined"?hashtags:""),onclick:("gtrack.track_events('[ttp]:contribution','share/twitter/comment','"+label+"');")});bf_shares.email_link({el:$("contribute-success-shares"),size:"big",subject:(objExists(BF_STATIC.buzz_name)?BF_STATIC.buzz_name:document.title),body:(objExists(fb_desc)?fb_desc:alt_desc)+"%0D%0A"+contrib_uri,onclick:("gtrack.track_events('[ttp]:contribution','share/email/comment','"+label+"');")});$(element_id).insert($("contribute-success"));$("contribute-success").show()}else{if(!$("moderation_contribute")){$("contribute-box").hide();if($("reg-success-message")){$("reg-success-message").update(bf_register.SUCCESS1)}$("registered-success").show()}}BF_Effect.ScrollIntoView(element_id);if($("number_of_contribs_header")){$("number_of_contribs_header").show()}$("contribute-post").hide();$("contribute-preview").hide();$("contribute-form").reset();bf_contribute.reset_contribute_box();$("contribute-preview-content").update();bf_contribute_toggleTabs("on");gtrack.trackShares(25,"numComments");gtrack.track_events(gtrack.tt_page+":contribute","contribute/submit","")}else{if(obj.error=="duplicate name"){this.setErrMessage(this.ERR_DUPE)}else{if(obj.error=="blacklist"){this.setErrMessage(this.ERR_BLIST)}else{this.setErrMessage(this.ERR)}}}};this.previewAndPostIt=function(params){var number_of_comment_pages=parseInt($F("comments-pages"));var waitfor=number_of_comment_pages?"ajax_comments:loaded":"ajax_comments:load";if(window[waitfor]){var fired=false;document.observe("contribute:previewFromServerOk",function(params){if(!fired){fired=true;this.postit.call(this,params)}}.bind(this,params));this.submit(null,params)}else{EventManager.observe(waitfor,this.previewAndPostIt.bind(this,params));$("responses").scrollIntoView()}};this.use_minisuper=function(params){var description="auto-title_"+(new Date()).getTime();var name="auto-title_"+(new Date()).getTime();if(params.caption){description=params.caption;name=truncateStr(params.caption,100)}var parameters={action:"save",name:name,description:description,image:params.url,width:params.width,height:params.height};parameters["submit-to"]=364333;parameters["auto-tag"]=params.id==1927310?"floridaoj2":params.id==1984234?"floridaoj3":"floridaoj";var success_handler=function(resp){this._response(resp)}.bindAsEventListener(this);var error_handler=function(resp){console.log(resp);this.server_error(resp)}.bindAsEventListener(this);new Ajax.Request("/buzzfeed/minisuper",{parameters:parameters,evalJSON:"force",onFailure:error_handler,onSuccess:success_handler})};this.setVideo=function(){var vd=new bf2_terminal_Video();vd.detect_type($F("video-embed"));$$("#contribute-video-form .video_privacy_warning").each(function(el){el.hide()});if(vd.type){var url=vd.src_link,so=BF_initSwfObject(url);so.write("video_preview");if($("video_preview")){$("video_preview").show()}$("video-embed-url").value=url;if(!!vd.possible_privacy_restrictions){$$("#contribute-video-form .video_privacy_warning").each(function(el){el.show()})}}else{if($("video_preview")){$("video_preview").update("")}if($("video_preview")){$("video_preview").hide()}$("video-embed-url").value=""}};this.save_image=function(image,width,height,form){$("user-image-edit").removeClassName("bf_wide_canvas");BF_UI.closeDialog("user-image-edit",{loadDefaultDiv:"quickpost-spinner"});$("image-image").value=image;bf_contribute.image_width=width;bf_contribute.image_height=height;if(form){bf_contribute.form=form}$("image-preview").show();$("image-preview").src=BF_STATIC.image_root+image;if(width>425){$("image-preview").setStyle({width:"425px",height:"auto"})}else{if(height){$("image-preview").setStyle({height:height+"px"})}}$("image-preview-div").show();$("photo-editor-button").value="Change Image..."};this.enableForm=function(id){if(!$(id)){return}$(id).show();this.currentForm=id;this.type=id.match(/\-(\w+)/)[1];this.login_enable_form=false};this.cleanup_image_registration=function(){if($("contribute-submit-fieldset")){$("contribute-submit-fieldset").show()}$("contribute-submit-fieldset").show();bf_contribute_toggleTabs("on");if($("image-preview-div")){$("image-preview-div").show()}if($("video_preview")&&$F("video-embed")){$("video_preview").show()}};this.buttonToggle=function(id){if(!$(id)){return}$(id).addClassName("current");this.currentToggle=id;if(id!="image-contribute-activate"){this.cleanup_image_registration()}};this.disableCurrent=function(){$(this.currentForm).hide();if(this.currentToggle!=undefined){$(this.currentToggle).removeClassName("current")}};this.setErrMessage=function(err){$("contribute-message").update(err);$("contribute-message").addClassName("error");$("contribute-message").show();$("contribute-submit").disabled=false};this.server_error=function(resp){$("saving-status").hide();this.setErrMessage(this.ERR)};this.addLineBreaks=function(string){string=string.replace(/(\r|\r\n|\n){2,}/gm,'<span class="line-break">&nbsp;</span>');string=string.replace(/(\r|\r\n|\n)/gm,"<br />");return string};this.url_entities=function(s){if(s){var newtext="";var chars=s.split("");for(i=0;i<chars.length;i++){var chr=chars[i].charCodeAt(0);if(chr>127){newtext+=encodeURIComponent(chars[i])}else{newtext+=chars[i]}}return newtext}};this.observeRespond=function(event){event.stop();bf_contribute.reset_contribute_box();var parent_comment_id=this.getAttribute("rel:parent_comment_id");var real_parent_id=this.getAttribute("rel:real_parent_id");if(!parent_comment_id){return}var buzz_id=this.getAttribute("rel:buzz_id");$("contribute-parent-id").setValue(parent_comment_id);$("contribute-real-parent-id").setValue(real_parent_id);$("contribute-id").setValue(buzz_id);$("contrib-form-container-"+parent_comment_id).appendChild($("contribute-preview-content"));$("contrib-form-container-"+parent_comment_id).appendChild($("contribute-box"));bf_contribute.subContributeParent=parent_comment_id;BF_Effect.ScrollIntoView("contribute-box")};this.goforit_default=function(){$("contribute-again-link").stopObserving("click");$("contribute-again-link").observe("click",function(e){e.stop();if($("contribution-types-tab")){$("contribution-types-tab").show()}if($("add-something-interesting")){$("add-something-interesting").show()}if($("respond")){$("respond").removeClassName("previewing")}$("contribute-preview").hide();$("contribute-submit-fieldset").show();bf_contribute_toggleTabs("on");$("contribute-form").reset();$("contribute-box").show();$("contribute-success").hide();$("contribute-cancel").hide();$("image-button").value="Select Image...";BF_Effect.ScrollIntoView("respond")})};this.goforit_reactcam=function(){$("contribute-again-link").stopObserving("click");$("contribute-again-link").observe("click",function(e){e.stop();$("contribute-success").hide();BF_Effect.ScrollIntoView("react_cam_button");document.fire("contribute:goforit_reactcam")})}};fadeIn=function(b,a){$(b).setOpacity(a/100);if(a<100){setTimeout("fadeIn('"+b+"',"+(a+2)+")",5)}};bf_contribute_toggleTabs=function(a){if(a=="on"){if($("contribution-types-tab")){$("contribution-types-tab").show()}if($("add-something-interesting")){$("add-something-interesting").show()}}else{if($("contribution-types-tab")){$("contribution-types-tab").hide()}}};var bf_contribute=new BFContribute();BuzzLoader.register(bf_contribute.init,1);var BF_MobilePreview=function(){this.scroll_values={wrapper_offset:300,show_threshold:0.98,hide_threshold:0.55,header_trigger:parseInt(BF_STATIC.public_draft)?825:775};this.init=function(){var a=new BF_User(),b=a.getUserInfo(),c=$s(".ptools-draftpage");$s(".draft-promo-content").appendChild(c);$s(".pt-t-edit").update('<i class="fa fa-angle-left"></i> Edit');if(acl.user_can("new_preview")){$(document).body.addClassName("new-draft");mobile_preview.default_draft=0}else{$(document).body.addClassName("default-draft");mobile_preview.default_draft=1}if(document.location.href.match("/_buzz_preview$")){mobile_preview.is_preview_page=true;$(document).body.addClassName("is-preview-page")}$$(".mobile-preview-phone").each(function(d){mobile_preview._init({back_button:$$(".browser-back-button")[0],browser_frame:d.select(".mobile-preview-browser-window")[0],home_button:d.select(".home-button")[0],preview:$("mobile-preview"),preview_url:window.location.href+"/mobile",preview_form:$("mobile-preview-form"),trigger:$$(".pt-preview-mobile")[0],user:a,userinfo:b,has_custom_header:($$(".longform_custom_header_image").length>0)})});if(!parseInt(BF_STATIC.public_draft)){mobile_preview.send_preview_init()}if(document.location.href.match("log_debug")){mobile_preview.debug=true}};this._init=function(a){this.config=a;if($("mobile-preview")&&this.config.user.isLoggedIn()&&this.config.userinfo.p_disable_quickpost!="true"&&!document.location.pathname.match(/\/_breaking_preview/)&&a.preview.hasClassName("is-auto-loaded")){this.toggle_preview()}};this.toggle_preview=function(){var a=this.config.trigger.getAttribute("rel:data").evalJSON();if(this.config.preview.hasClassName("is-inactive")){if(a.buzz_id){this.open_preview()}else{alert("Invalid ID ("+this.buzz_info.buzz_id+")")}}else{this.close_preview()}};this.load_iframe_src=function(c){var a=this.config.browser_frame,b=this.config.trigger,d=this.config.back_button;if(c.indexOf("?")!=-1){c=c.substring(0,c.indexOf("?"));c=c+"/mobile"}c=c+"?drafttools=0";if(/breaking_preview/.test(document.location)){c+="&"+document.location.search.replace(/^\?/,"")}if(!mobile_preview.preview_loaded){b.addClassName("is-loading")}a.src=c;Event.observe(a,"load",function(){b.removeClassName("is-loading");mobile_preview.preview_loaded=1;Event.observe(d,"click",function(){a.src=c})})};this.open_preview=function(g){var a=this,f=this.config.preview,b=this.config.browser_frame,c=this.config.trigger,d=this.config.preview_form;mobile_preview.no_trigger=false;if(mobile_preview.default_draft){if(this.config.preview.hasClassName("is-inactive")){this.config.preview.removeClassName("is-inactive")}this.config.preview.show()}a.mobile_safe=buzzDetails.postTags.match("--mobile_safe")?1:0;if(!mobile_preview.is_preview_page&&!mobile_preview.default_draft){a.send_overlay(true)}if(mobile_preview.is_preview_page){d.submit();c.addClassName("is-loading")}else{this.load_iframe_src(this.config.preview_url)}Event.observe(b,"load",function(){f.show();a.close_preview_overlay({load:true});mobile_preview.wrapper_height=(b.contentWindow.document.activeElement.clientHeight+300>=document.viewport.getHeight()?b.contentWindow.document.activeElement.clientHeight+300:document.viewport.getHeight());universal_dom.assign_handler({bucket:"close_info",event:"click",handler:a.close_preview_info});universal_dom.assign_handler({bucket:"bad_embed",event:"click",handler:a.close_preview_overlay});universal_dom.assign_handler({bucket:"good_embed",event:"click",handler:a.close_preview_overlay});universal_dom.assign_handler({bucket:"no_preview",event:"click",handler:a.close_preview_overlay});universal_dom.assign_handler({bucket:"phone_toggle_check",event:"click",handler:a.toggle_check});if(store.get("preview-info")!=false&&!parseInt(BF_STATIC.public_draft)){$s(".preview-info-box").removeClassName("hidden")}c.removeClassName("is-loading");f.removeClassName("is-inactive");if(!a.mobile_safe&&!mobile_preview.default_draft){a.mobile_safe_embeds(b)}if(!mobile_preview.is_preview_page&&!mobile_preview.default_draft){$s(".preview-wrapper").setStyle({height:mobile_preview.get_wrapper_height()+"px"})}if(mobile_preview.default_draft||mobile_preview.is_preview_page){$$(".preview-error-box, .preview-info-box , .keep-scrolling-box, .android").each(function(l){if(l){l.remove()}})}if(mobile_preview.debug){mobile_preview._log_debug("VIEWPORT_HEIGHT"+document.viewport.getHeight(),"open_preview");mobile_preview._log_debug("WRAPPER_HEIGHT"+$s(".preview-wrapper").getHeight(),"open_preview")}var k=new Element.Layout(f),j=k.get("top"),h=Element.getHeight(b),e;c.removeClassName("is-loading");if(a.config.has_custom_header&&mobile_preview.default_draft){a.move_preview(j)}Event.observe(window,"scroll",function(l){if(!e){e=b.contentWindow.document.body.scrollHeight}if(mobile_preview.default_draft||mobile_preview.is_preview_page){a.move_preview(j)}a.scroll_browser(h,e)});Event.observe(window,"resize",function(l){if(l.target.innerWidth<1045){$s(".back-to-mobile").addClassName("back-to-mobile--hidden")}else{$s(".back-to-mobile").removeClassName("back-to-mobile--hidden")}});if(!mobile_preview.is_preview_page&&!mobile_preview.default_draft){$$(".page-head, .PageContainer, .longform_custom_header_image").each(function(l){l.setStyle({display:"none"})})}})};this.close_preview=function(){this.config.preview.hide();this.config.preview.addClassName("is-inactive")};this.move_preview=function(b){var h=b,f=Element.getHeight($("page_container")),e=this.config.has_custom_header?Element.viewportOffset($("js-longform_custom_header_image")):Element.viewportOffset($("page_container")),g=this.config.preview,d=Element.getHeight(g),c=Element.viewportOffset(g);if(this.config.has_custom_header){b-=Element.getHeight($("js-longform_custom_header_image"))}window.clearTimeout(a);var a=setTimeout(function(){if(e.top<0){if(mobile_preview.is_preview_page){h=53}else{h=10}}else{if(e.top>0){h=b}else{return}}if(h>(f-d)&&f>d){h=f-d}g.setStyle({top:h+"px"})},1)};this.send_preview_init=function(){var a=this;if(acl.user_can("general_admin")&&!mobile_preview.is_preview_page){$s(".send-preview").removeClassName("is-disabled")}$("send-preview-form").observe("submit",function(c){c.stop();a.send_preview(this)});$("send-preview-again").observe("click",function(c){c.stop();$$(".send-preview")[0].removeClassName("is-sent")});var b=readCookie("send_preview_number");if(b){b=JSON.parse(b);$$(".send-preview-form-fields-phone-number")[0].writeAttribute("value",b.phone_number);$$(".send-preview-form-fields-phone-country")[0].select('option[value="'+b.country_code+'"]')[0].writeAttribute("selected","selected")}};this.send_preview=function(b){var a=this;ajax=new BF_Request(),container=$$(".send-preview")[0],data=b.serialize(true),url="/buzzfeed/_draft/sms_message/"+BF_STATIC.campaignid,errors=false,country_code=data.country_code,phone_number=data.phone_number,cookie_data={},onphone_preview="";if(!mobile_preview.default_draft){onphone_preview="/onphone"}container.removeClassName("is-error");container.removeClassName("is-sent");phone_number=phone_number.replace(/[^0-9]/gi,"");if(phone_number===""||((country_code==="1"&&phone_number.length!==10)||(country_code==="44"&&phone_number.length!==10)||(country_code==="61"&&phone_number.length!==9))){errors=true}if(data.save&&!errors){cookie_data.country_code=country_code;cookie_data.phone_number=data.phone_number;createCookie("send_preview_number",JSON.stringify(cookie_data),"","")}if(!errors){if(!a.mobile_safe&&!mobile_preview.default_draft){a.send_overlay()}ajax.request(url,{parameters:{phone_number:country_code+" "+phone_number,message:"Here's your mobile preview of \""+BF_STATIC.buzz_name+'" '+window.location.href+"/mobile"+onphone_preview},method:"get",onSuccess:function(c){data=JSON.parse(c.responseText);if(mobile_preview.no_embeds){$s(".preview-overlay").addClassName("hidden")}if(data.success==1){container.removeClassName("is-ready");container.addClassName("is-sent")}else{if(mobile_preview.default_draft){$s(".send-preview-message-error").update("Oh dear. Looks like you broke something. Please try again.")}else{$s(".send-preview-message-error").update("Looks like something went wrong. Please re-enter your phone number and click Send.")}container.addClassName("is-error")}}})}else{$s(".send-preview-message-error").update("Whoops! Please make sure you've entered a valid phone number.");container.addClassName("is-error")}};this.scroll_browser=function(c,f){var e=document.viewport.getHeight(),b=Element.getHeight($$("body")[0]),a=document.viewport.getScrollOffsets();if(mobile_preview.default_draft||(!mobile_preview.default_draft&&!mobile_preview.desktop_unlocked)){var g=(a.top)/(b-e)}var d=g*(f-c);$$(".mobile-preview-browser-window").each(function(o,l){if(!mobile_preview.desktop_unlocked){var h=o.contentDocument.getElementById("buzz");var k=parseInt(o.contentWindow.getComputedStyle(h,null).height.replace("px",""));o.contentWindow.scrollTo(0,d);if(k<=o.contentWindow.innerHeight){mobile_preview.small_post=true}}if(!mobile_preview.default_draft){var n=o.contentDocument.getElementsByClassName("unavail_mobile");if((g!=undefined&&g>=mobile_preview.scroll_values.show_threshold)&&!mobile_preview.is_preview_page&&!mobile_preview.default_draft&&$("mobile-preview").viewportOffset().top>0&&!mobile_preview.desktop_unlocked&&!mobile_preview.no_trigger){if(mobile_preview.debug){mobile_preview._log_debug("SHOW","scroll_browser");mobile_preview._log_debug("is_preview_page"+mobile_preview.is_preview_page,"scroll_browser");mobile_preview._log_debug("no_trigger"+mobile_preview.no_trigger,"scroll_browser")}mobile_preview.show_desktop(l)}if($("header_wrapper").viewportOffset().top>=mobile_preview.scroll_values.header_trigger&&!mobile_preview.no_trigger&&!mobile_preview.small_post){if(mobile_preview.debug){mobile_preview._log_debug("HIDE","scroll_browser")}if(!mobile_preview.desktop_hidden){window.scrollTo(0,(o.contentWindow.document.activeElement.clientHeight-500))}mobile_preview.hide_desktop();mobile_preview.desktop_unlocked=false;mobile_preview.no_trigger=true}if(mobile_preview.desktop_hidden){if(g<=mobile_preview.scroll_values.hide_threshold&&mobile_preview.no_trigger&&!mobile_preview.desktop_unlocked){mobile_preview.no_trigger=false}}if(!mobile_preview.mobile_safe){for(var j=0;j<n.length;j+=1){var m=o.parentElement.parentElement.getElementsByClassName("unsafe-embed-notice");m[j].setStyle({top:n[j].getBoundingClientRect().top+"px"});if(n[j].getBoundingClientRect().top<0){m[j].addClassName("hidden")}else{if(n[j].getBoundingClientRect().top>0&&m[j].hasClassName("hidden")){m[j].removeClassName("hidden")}}if(n[j].getBoundingClientRect().top>o.contentWindow.innerHeight){m[j].addClassName("hidden")}}}}});if($("mobile-preview").viewportOffset().top>=50&&!mobile_preview.default_draft&&!mobile_preview.is_preview_page){mobile_preview.no_trigger=false}if($("header_wrapper").viewportOffset().top<=0&&$$(".back-to-mobile").length&&$s(".back-to-mobile").hasClassName("hidden")){$s(".back-to-mobile").removeClassName("hidden")}else{if($("header_wrapper").viewportOffset().top>=1&&!mobile_preview.default_draft&&!mobile_preview.is_preview_page){$s(".back-to-mobile").addClassName("hidden")}}};this.get_wrapper_height=function(){var a=$s(".mobile-preview-browser-window").contentWindow.document.activeElement.clientHeight+mobile_preview.scroll_values.wrapper_offset>=document.viewport.getHeight()?$s(".mobile-preview-browser-window").contentWindow.document.activeElement.clientHeight+mobile_preview.scroll_values.wrapper_offset:document.viewport.getHeight();return a};this.launch_app=function(c){if(c=="home"){var a=["OMG!","WTF?","LOL","WIN!","CUTE","FAIL"];var b=Math.floor((Math.random()*(a.length-1))+1);alert(a[b])}};this.mobile_safe_embeds=function(f){var c=$(f.contentWindow.document).getElementsByClassName("unavail_mobile"),e=(buzzDetails.postTags.match("--mobile_safe"))?1:0,a=f.parentElement.parentElement;if(!c||!c.length){mobile_preview.no_embeds=1;return false}if(f&&c&&!e){this.update_error_box(false,c.length);f.contentWindow.document.getElementsByClassName("buzz")[0].className+="mobile_draft_preview"}for(var b=0;b<c.length;b++){if(b<=c.length){var d=(f.contentWindow.innerHeight<=c[b].getBoundingClientRect().top)?"hidden":"";f.parentElement.parentElement.insert('<div class="unsafe-embed-notice '+d+'" style="top:'+c[b].getBoundingClientRect().top+'px"><i class="fa fa-exclamation"></i></div>')}}};this.update_error_box=function(e,f){var a=$s(".preview-error-box"),b=a.select(".preview-error-box__header")[0],c=["is","embed"],d=["are","embeds"];if(!e){if(a.hasClassName("good")){a.removeClassName("good")}if(a.hasClassName("hidden")){a.removeClassName("hidden")}if($("embed_count")){$("embed_count").update(f);if(f>1){c.each(function(h,g){b.innerHTML=b.innerHTML.replace(" "+c[g]+" "," "+d[g]+" ")})}}}else{if(e){a.addClassName("good");$$(".confirm").each(function(g){g.removeClassName("hidden")});$$(".default").each(function(g){g.addClassName("hidden")})}}};this.close_preview_info=function(){$s(".preview-info-box").addClassName("hidden");store.set("preview-info",false)};this.show_desktop=function(d,b){if(mobile_preview.debug){mobile_preview._log_debug("SHOW","show_desktop")}try{$$(".page-head, .PageContainer, .longform_custom_header_image").each(function(e){e.show()});$s(".preview-wrapper").setStyle({height:"800px"});$s(".mobile-preview").setStyle({position:"relative"});if(d<1&&!$$(".back-to-mobile").length){var a=new Element("div",{"class":"back-to-mobile"});a.insert('<div class="back-to-mobile--arrow"></div>');a.insert("<span>Back to Mobile Preview</span>");a.addClassName("hidden");a.onclick=function(){mobile_preview.desktop_unlocked=false;mobile_preview.hide_desktop();window.scrollTo(0,0)};$s(".PageContent").insert(a)}else{if($s(".back-to-mobile")){$s(".back-to-mobile").removeClassName("hidden")}}window.scrollTo(0,50);mobile_preview.desktop_unlocked=true}catch(c){console.log(c)}};this.hide_desktop=function(){if(mobile_preview.debug){mobile_preview._log_debug("HIDE","hide_desktop")}$$(".page-head, .PageContainer, .longform_custom_header_image").each(function(a){a.hide()});$s(".preview-wrapper").setStyle({height:mobile_preview.get_wrapper_height()+"px"});$s(".mobile-preview").setStyle({position:"fixed"});$s(".back-to-mobile").addClassName("hidden");mobile_preview.desktop_hidden=true};this.send_overlay=function(b){var a=$s(".preview-overlay");a.removeClassName("hidden");if(b){$("pre-text").update("");$("main-text").update("Loading preview...")}if(!b){setTimeout(function(){mobile_preview.update_overlay(mobile_preview.no_embeds)},3000)}};this.update_overlay=function(a){if(a){if($("pre-text")){$("pre-text").removeClassName("hidden")}if($("preview-spinner")){$("preview-spinner").removeClassName("hidden")}if($("main-text")){$("main-text").update("Your mobile draft preview is on its way…")}if($("overlay-buttons")){$("overlay-buttons").addClassName("hidden")}}else{if($("pre-text")){$("pre-text").addClassName("hidden")}if($("preview-spinner")){$("preview-spinner").addClassName("hidden")}if($("main-text")){$("main-text").update("Does the embed work on your phone?")}if($("overlay-buttons")){$("overlay-buttons").removeClassName("hidden")}}};this.close_preview_overlay=function(c){var b=$s(".preview-overlay");if(b){b.addClassName("hidden")}if(!c.load){var a=c.element.getAttribute("rel:bf_bucket");if(a=="good_embed"){mobile_preview.mobile_safe=1;mobile_preview.update_error_box(true);store.set("mobile_safe",true);$$(".unsafe-embed-notice").each(function(d){if(d){d.addClassName("hidden")}});if(!c.load){mobile_preview.show_embeds()}}else{if(a=="bad_embed"){mobile_preview.update_error_box(false)}}}mobile_preview.update_overlay(true)};this.toggle_check=function(c){var b=c.target,a=$("phone-number-checkbox");if(b.hasClassName("fa-check-square-o")&&a.value){b.addClassName("fa-square-o");b.removeClassName("fa-check-square-o");a.removeAttribute("checked")}else{if(b.hasClassName("fa-square-o")&&!a.hasAttribute("checked")){b.removeClassName("fa-square-o");b.addClassName("fa-check-square-o");a.setAttribute("checked","checked")}}};this.show_embeds=function(){mobile_preview.mobile_safe=true;if($$(".unsafe-embed-notice")){$$(".unsafe-embed-notice").each(function(b){if(b){b.remove()}})}var a=function(d,c){for(var b=0;b<=(d.length-1);b++){if(c=="hide"&&d[b]!="undefined"){d[b].className+=" hidden"}if(c=="show"&&d[b]!="undefined"){d[b].className="draft-preview-safe-embed"}}};$$(".mobile-preview-phone").each(function(b){a(b.select("iframe")[0].contentWindow.document.getElementsByClassName("unavail_mobile"),"hide");a(b.select("iframe")[0].contentWindow.document.getElementsByClassName("draft-preview-safe-embed"),"show")})};this._log_debug=function(b,a){console.log("DEBUG_"+b+"FROM_"+a)}};if(document.location.href.match("/_draft|breaking_preview/|_buzz_preview")){var draft_no_scroll=1;var mobile_preview=new BF_MobilePreview();BuzzLoader.register(mobile_preview.init,1)}var BF_LF_image_bleed=function(d){this.BLEED_BLOCK_SELECTOR=".buzz_superlist_item_image.image_lffw";this.BLEED_CONTENT_SELECTOR=".sub_buzz_content";this.BLEED_DEBOUNCE_DELAY=400;Object.extend(this,d);var e=[];var a=function(f){e.each(function(h){if(h.original_width>f){h.subbuzz.removeClassName("image_lffw_bled");h.bleed_element.writeAttribute("style","")}else{var g=h.subbuzz.viewportOffset().left?h.subbuzz.viewportOffset().left:0;h.subbuzz.addClassName("image_lffw_bled");h.bleed_element.setStyle({marginLeft:-g+"px",width:f+"px",height:"auto"})}})};var c=BF_UTIL.debounce(a,this.BLEED_DEBOUNCE_DELAY);var b=this;b.initialized=false;this.init=function(){var f=$$(b.BLEED_BLOCK_SELECTOR);var g=document.viewport.getWidth();if(!f.length){return}else{f.each(function(h){if(h.hasClassName("been_bled")){return true}h.addClassName("been_bled");e.push({subbuzz:h,bleed_element:h.select(b.BLEED_CONTENT_SELECTOR).first(),original_width:h.getWidth(),})});a(g);if(!b.initialized){Event.observe(window,"resize",function(){var h=document.viewport.getWidth();c(h);EventManager.fire("BF_LF_image_bleed:resized")})}}b.initialized=true}};BF_LF_image_bleed.prototype={constructor:BF_LF_image_bleed};var bf_lf_image_bleed=new BF_LF_image_bleed();bfjs.onPageLoad(bf_lf_image_bleed.init);BF_FlagComment=function(){this.init=function(){flagComment.assign_handlers()};this.image_path="";this.assign_handlers=function(){universal_dom.assign_handler({bucket:"flag-comment-cancel",handler:flagComment.hide_flag_comment_form,event:"click"})};this.hide_flag_comment_form=function(){$("flag_comment").hide();bf_catcha.catcha_answer=""};this.move_it=function(c){$(c).appendChild($("flag_comment").remove());var b=$("flag_comment").up().getHeight();var a=$("flag_comment").up().getWidth()-$("flag_comment").getWidth()/2;$("flag_comment").setStyle({top:b+"px"});$("flag_comment").setStyle({left:a+"px"});$("flag_submit").setAttribute("comment_id",c)};this.draw_catcha=function(){if(flagComment.image_path==""){flagComment.image_path=$$("form.flag_comment_popup img")[0].src}if(BFW_Util.getCookie("catcha-anonymus_flag_comment")){bf_catcha.catcha_answer="";universal_dom.get_bucket_elements("catcha-anonymus_flag_comment").each(function(a){a.getElementsByTagName("INPUT")[0].value="";a.getElementsByTagName("IMG")[0].src=flagComment.image_path;a.getElementsByTagName("SPAN")[0].innerHTML="";bf_catcha.set_image_and_question({service:"anonymus_flag_comment",image_element:a.getElementsByTagName("IMG")[0],question_element:a.getElementsByTagName("SPAN")[0]});a.show();$("flag_comment").show()})}}};flagComment=new BF_FlagComment();BuzzLoader.register(function(){flagComment.init()},1);BF_Reactions=function(){this.data=[];this.els={};this.ready=false;this.count_height=18;this.badge_height=25;this.step_height=3;this.min_step_difference=2;this.bar_max_height=90;this.reaction_toggle="reaction_toogle";this.reactions_wrapper="reactions_wrapper";this.main_el=null;this.reaction_template=new Template('<li id="reaction-#{name}" class="reaction reaction-#{name} #{lang}-reaction">                        <div class="bar-wrapper" style="height:#{wrapper_height}px" >                            <div class="jump-bar"></div>                            <div class="bar" style="height:#{height}px">                                #{count_html}                                #{image_html}                                #{badge_html}                            </div>                        </div>                        #{button_html}                    </li>');this.count_template=new Template('<div class="reaction-count" style="margin-top: -#{margin}px;">#{count}</div>');this.image_template=new Template('<div class="reaction-image #{image.name}" style="background-image:url(#{image_path});width:#{image_width}px;height:#{image_height}px;"></div>');this.badge_template=new Template('<div class="reaction-badge #{badge.name}" style="margin-top:-#{badge_margin}px"><img src="#{badge.path}" /></div>');this.button_template=new Template('<a rel:gt_act="#{gt_act}" rel:value="#{value}" rel:abtrack_id="#{abtrack_id}" href="javascript:;" rel:message="#{message}" rel:badge_id="#{badge_id}" rel:badge_name="#{badge_name}" rel:badge_uri="#{badge_uri}" class="#{a_class} btn-reaction #{name}"><span>#{badge_wording}</span></a>');this.init=function(params){if(typeof params.reactions_id=="undefined"||!$(params.reactions_id)){return false}bf_reactions.main_el=$(params.reactions_id);bf_reactions._get_reactions_data();bf_reactions._sort();bf_reactions.main_el.innerHTML="";bf_reactions._calculate_extra_steps();var last_pinned=null;for(var i=0;i<bf_reactions.data.length;i++){bf_reactions.data[i].height=bf_reactions.calculation_reaction_height(bf_reactions.data,i);if(i==0){bf_reactions.bar_max_height=bf_reactions.data[i].height}var reaction=bf_reactions.build(bf_reactions.data[i]);if(bf_reactions.data[i].pin_reaction){if(!last_pinned){last_pinned=$("reaction-"+bf_reactions.data[0].name);if(!last_pinned){bf_reactions.main_el.insert(reaction)}else{Element.insert(last_pinned,{before:reaction})}}else{Element.insert(last_pinned,{after:reaction})}last_pinned=$("reaction-"+bf_reactions.data[i].name)}else{bf_reactions.main_el.insert(reaction)}var el=$("reaction-"+bf_reactions.data[i].name);bf_reactions.els[("reaction-"+bf_reactions.data[i].name)]={bar:el.select(".bar").first(),jump_bar:el.select(".jump-bar").first(),label:el.select(".bar .reaction-count").first(),button:el.select(".btn-reaction").first(),image:el.select(".bar .reaction-image").length?el.select(".bar .reaction-image").first():false,badge:el.select(".bar .reaction-badge").length?el.select(".bar .reaction-badge").first():false,height:bf_reactions.data[i].height,count_react:!isNaN(parseInt(bf_reactions.data[i].count,10))?parseInt(bf_reactions.data[i].count,10):0}}universal_dom.assign_handler({bucket:"reaction-toggle",event:"click",handler:bf_reactions.toggle});var options={el:$("slider"),reactions_class:"reaction"};new BF_Reactions_Slider(options);if(store.get(bf_reactions.reaction_toggle)=="closed"){bf_reactions.toggle()}bf_reactions.ready=true};this.toggle=function(){var state=$(bf_reactions.reactions_wrapper).hasClassName("open")?"closed":"open";$(bf_reactions.reactions_wrapper).className=state;$s("#reactions-normal .reactions-header").removeClassName("closed").removeClassName("open").addClassName(state);store.set(bf_reactions.reaction_toggle,state)};this.build=function(data){data.margin=0;data.wrapper_height=bf_reactions.bar_max_height;if(typeof data.image!="undefined"&&typeof data.image.height!="undefined"&&typeof data.image.width!="undefined"&&typeof data.image.path!="undefined"&&data.image.height&&typeof data.image.name!="undefined"){data.image_height=parseInt(data.image.height,10);data.image_width=parseInt(data.image.width,10);data.image_path=data.image.path;data.wrapper_height+=data.image_height;data.margin+=data.image_height;data.image_html=bf_reactions.image_template.evaluate(data)}if(typeof data.badge!="undefined"&&typeof data.badge.name!="undefined"&&typeof data.badge.path!="undefined"){data.badge_margin=0;if(typeof data.badge.height!="undefined"){data.badge_height=parseInt(data.badge.height,10)}else{data.badge_height=bf_reactions.badge_height}data.margin+=(data.badge_height)/2;data.wrapper_height+=(data.badge_height/2);if(typeof data.image_height!="undefined"){data.wrapper_height-=data.badge_height/2;data.margin-=data.badge_height/2;data.badge_margin=data.badge_height/2}data.badge_html=bf_reactions.badge_template.evaluate(data)}data.wrapper_height+=bf_reactions.count_height;data.margin+=bf_reactions.count_height;data.count_html=bf_reactions.count_template.evaluate(data);data.button_html=bf_reactions.button_template.evaluate(data);data.wrapper_height+=10;return bf_reactions.reaction_template.evaluate(data)};this._get_reactions_data=function(){if(bf_reactions.main_el){bf_reactions.main_el.select(".reaction").each(function(el){var bf_reaction_data=eval("("+el.getAttribute("reaction_data")+")");if(bf_reaction_data.name!="love"&&bf_reaction_data.name!="hate"){if(BFW_Util.getCookie("country")!=null&&BFW_Util.getCookie("country")=="uk"){if(bf_reaction_data.lang=="us"){return}}else{if(bf_reaction_data.lang=="uk"){return}}}bf_reactions.data.push(bf_reaction_data)})}};this._sort=function(){function compare(a,b){var count1=!isNaN(parseInt(a.count,10))?parseInt(a.count,10):0;var count2=!isNaN(parseInt(b.count,10))?parseInt(b.count,10):0;var order1=!isNaN(parseInt(a.order,10))?parseInt(a.order,10):1000;var order2=!isNaN(parseInt(b.order,10))?parseInt(b.order,10):1000;if(count1<count2){return 1}if(count1>count2){return -1}if(order1>order2){return 1}if(order1<order2){return -1}return 0}bf_reactions.data.sort(compare)};this.calculation_reaction_height=function(data,index){if(typeof data[index-1]=="undefined"){data[index].height=bf_reactions.bar_max_height}else{if(data[index].count==0){data[index].height=0}else{var steps=(bf_reactions.extra_steps*(1-(data[index].count/data[index-1].count))).toFixed(0);var dif_steps=Math.min(parseInt(steps)+bf_reactions.min_step_difference,data[index-1].count-data[index].count);bf_reactions.extra_steps-=Math.min(steps,dif_steps);data[index].height=data[index-1].height-(bf_reactions.step_height*dif_steps)}}return Math.min(data[index].height,data[index].count*bf_reactions.step_height)};this._calculate_extra_steps=function(){var dif_values={};var min_count_steps=0;var max_count_step=bf_reactions.bar_max_height/bf_reactions.step_height;bf_reactions.data.each(function(el,key){if(typeof dif_values[el.count]=="undefined"){if(typeof dif_values[1+parseInt(el.count,10)]!="undefined"){min_count_steps++}else{min_count_steps+=bf_reactions.min_step_difference}dif_values[el.count]=parseInt(el.count,10)}});bf_reactions.extra_steps=max_count_step-min_count_steps};this.grow_up_css=function(el){if(typeof bf_reactions.els[el.up(".reaction").id]=="undefined"){return false}var reaction=bf_reactions.els[el.up(".reaction").id];if(!reaction.button.hasClassName("voted")){reaction.button.addClassName("voted");reaction.jump_bar.setStyle({height:(reaction.height+bf_reactions.step_height)+"px",visibility:"hidden"});var animationEvent=bf_reactions.whichAnimationEvent();animationEvent&&reaction.jump_bar.addEventListener(animationEvent,function(){reaction.jump_bar.removeClassName("animated").removeClassName("bounceInUp")});setTimeout(function(){reaction.jump_bar.addClassName("animated").addClassName("bounceInUp");setTimeout(function(){reaction.bar.addClassName("hidden");reaction.jump_bar.setStyle({visibility:"visible"});reaction.jump_bar.insert(reaction.bar.innerHTML);reaction.jump_bar.select(".reaction-count").first().innerHTML=reaction.count_react+1},360)},10)}};this.whichAnimationEvent=function(){var t;var el=document.createElement("fakeelement");var transitions={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in transitions){if(el.style[t]!==undefined){return transitions[t]}}}};BF_Reactions_Slider=function(a){this.el=null;this.reactions=[];this.slider_wrapper_width=0;this.slider_wrapper_class="slider_wrapper";this.reactions_width=0;this.index_first_visible_el=0;this.overlay=null;this.arrow_left=null;this.arrow_right=null;this.slider_animating=false;this.transform=0;this.init(a)};BF_Reactions_Slider.prototype.init=function(b){if(typeof b.el=="undefined"||!b.el){return false}if(typeof b.reactions_class=="undefined"||!b.reactions_class){b.reactions_class="reaction"}var c=this;this.el=b.el;this.reactions=this.el.select("."+b.reactions_class);this.slider_wrapper=this.el.select(".slider_wrapper").first();this.overlay=this.el.select(".overlay").first();this.arrow_left=this.el.select(".arrow.left").first();this.arrow_right=this.el.select(".arrow.right").first();this.slider_wrapper_width=this.el.getLayout().get("width")-68;this.reactions_width=0;this.reactions.each(function(d){c.reactions_width+=d.getLayout().get("margin-box-width")});var a=this.slider_wrapper_width;if(this.slider_wrapper_width+this.reactions[this.index_first_visible_el].getLayout().get("margin-box-width")>this.reactions_width){a=this.slider_wrapper_width+(this.reactions_width-this.slider_wrapper_width)}else{this._show_right_arrow()}this.el.select("."+this.slider_wrapper_class).first().setStyle({width:a+"px"});this.add_slider_overlay();this.arrow_left.observe("click",function(d){c.max_slide_css(d)});this.arrow_right.observe("click",function(d){c.max_slide_css(d)})};BF_Reactions_Slider.prototype._hide_right_arrow=function(){this.arrow_right.addClassName("hidden")};BF_Reactions_Slider.prototype._hide_left_arrow=function(){this.arrow_left.addClassName("hidden")};BF_Reactions_Slider.prototype._show_right_arrow=function(){this.arrow_right.removeClassName("hidden")};BF_Reactions_Slider.prototype._show_left_arrow=function(){this.arrow_left.removeClassName("hidden")};BF_Reactions_Slider.prototype.add_slider_overlay=function(){var d=0;var b=true;this.overlay.addClassName("hidden");var a=this.el.select("."+this.slider_wrapper_class).first().offsetWidth;for(var c=this.index_first_visible_el;c<this.reactions.length;c++){d+=this.reactions[c].getLayout().get("margin-box-width");if(d==a){b=false}else{if(d>a){this.overlay.setStyle({width:(this.reactions[c].getLayout().get("margin-box-width")+a-d)+"px"}).removeClassName("hidden");break}}}};BF_Reactions_Slider.prototype._set_slider_wrapper_width=function(a){this.slider_wrapper.setStyle({width:a+"px"})};BF_Reactions_Slider.prototype.max_slide_css=function(g){_this=this;if(this.slider_animating){return false}this.slider_animating=true;this.transform=0;this.not_supported_transition_event="not_supported:transition";var f=g.target,b=0,d=0,a=this.slider_wrapper_width;for(var c=0;c<this.index_first_visible_el;c++){b+=this.reactions[c].getLayout().get("margin-box-width")}if(f.hasClassName("right")){for(var c=this.index_first_visible_el;c<=this.reactions.length-1;c++){if(this.reactions_width<=b+d+this.slider_wrapper_width){this.index_first_visible_el=c;break}d+=this.reactions[c].getLayout().get("margin-box-width");if(d>=a){this.index_first_visible_el=c;break}}}else{for(var c=this.index_first_visible_el-1;c>=0;c--){d+=this.reactions[c].getLayout().get("margin-box-width");if(d>=a){this.index_first_visible_el=c+1;break}if(c==0){this.index_first_visible_el=0}}}for(var c=0;c<this.index_first_visible_el;c++){this.transform+=this.reactions[c].getLayout().get("margin-box-width")}this.el.select(".reactions").first().observe(this.whichTransitionEvent(),this.after_animation);this.el.select(".reactions").first().setStyle({"-ms-transform":"translateX(-"+this.transform+"px)","-webkit-transform":"translateX(-"+this.transform+"px)",transform:"translateX(-"+this.transform+"px)",});if(this.transform+this.slider_wrapper_width+this.reactions[this.index_first_visible_el].getLayout().get("margin-box-width")>this.reactions_width){this._hide_right_arrow()}else{this._set_slider_wrapper_width(a);this.add_slider_overlay()}if(this.transform!=0){this._show_left_arrow()}else{this._hide_left_arrow()}if(this.whichTransitionEvent()==this.not_supported_transition_event){this.el.select(".reactions").first().fire(this.not_supported_transition_event)}};BF_Reactions_Slider.prototype.after_animation=function(){if(_this.transform+_this.slider_wrapper_width+_this.reactions[_this.index_first_visible_el].getLayout().get("margin-box-width")>_this.reactions_width){_this._set_slider_wrapper_width(_this.slider_wrapper_width+(_this.reactions_width-(_this.transform+_this.slider_wrapper_width)));_this.add_slider_overlay()}else{_this._show_right_arrow()}_this.slider_animating=false;_this.el.select(".reactions").first().stopObserving(_this.whichTransitionEvent(),_this.after_animation);EventManager.fire("reaction_slider:animation_end")};BF_Reactions_Slider.prototype.whichTransitionEvent=function(){var a;var b=document.createElement("fakeelement");var c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c){if(b.style[a]!==undefined){return c[a]}}return this.not_supported_transition_event};var bf_reactions=new BF_Reactions();BuzzLoader.register(function(){bf_reactions.init({reactions_id:"reactions"})},5);var Bookmarks=function(){var a=this;this.initializedGoogleCallback=false;this.maxBookmarkCount=1000;this.ajaxUrl="/buzzfeed/api/bookmarks";this.bookmarkContainerClass="bookmark_share";this.bookmarksData={userId:"",bookmarks:{},showPromo:true,hasBookmarks:false,addAfterLogin:0,sync_id:0};this.templates={post_button:'<a class="bf_dom shareBtn big square" rel:gt_cat="Buzz:sharing-upper" rel:gt_act="bookmark" rel:bf_bucket="add_bookmark" href="javascript:;">						<div class="fa fa-bookmark"></div>						<div class="label">Bookmark it</div>					</a>					<div class="bookmark-tooltip" style="display:none;"></div>',tooltips:{new_tooltip:"<b>NEW!</b> <a>Click to bookmark</a>",bookmarked_tooltip:"<b>"+local.t("Bookmarked!")+'</b><a class="bf_dom view-bookmarks" rel:gt_cat="Buzz:sharing-upper" rel:gt_act="view-bookmarks" href="#">'+local.t("View bookmarks")+"</a>"},bmtools:'<div class="bmtools"  rel:gt_cat="BuzzBookmarks:feed" >								<a class="bf_dom bm-tool-track bm-tool bookmark-share fa fa-share" href="javascript:;" rel:bf_bucket="share_bookmark"></a>								<a class="bf_dom bm-tool-track bm-tool bookmark-delete fa fa-trash-o" href="javascript:;"  rel:bf_bucket="delete_bookmark_confirm"></a>								<div class="clear"></div>								<div class="bookmark-delete-confirm bm-tool-track bf_dom" style="display: none;"><span>Are you sure?</span><a class="cancel-delete-bookmark bf_dom bm-tool-track" rel:bf_bucket="cancel_delete_bookmark">No</a><a class="delete-bookmark bf_dom bm-tool-track" rel:bf_bucket="delete_bookmark">Yes</a></div>							</div>',bookmark_item:'<article>											<header>												<div class="thumb-unit"><a href="'+BF_STATIC.web_root+'/#{username}/#{uri}" class="title" ><img src="#{image}" width="125" height="83" alt="" /></a></div>												<hgroup><h2><a href="'+BF_STATIC.web_root+'/#{username}/#{uri}" class="title" >#{title}</a></h2></hgroup>											</header>											<p class="small-meta"><span class="time-image icon"></span><span class="time-ago">Saved #{ago} ago</span></p>										</article>',bookmark_share:"<div class=\"bookmark-share-block bm-tool-track social_share_icons\" style=\"display: none;\" rel:bf_bucket=\"hide_bookmark_share\" ><ul class=\"social_share_icons_list\">						<li class=\"share_facebook\">								<img src=\"#{share_gif}\" onload=\"sharing.buttons.facebook_share({'replace': this,'url': '#{share_url}','type': '#{type}','icon': '&#xf09a;'  });\" />						</li>						<li class=\"share_twitter\">								<img src=\"#{share_gif}\" onload=\"sharing.buttons.twitter({'replace': this,'type': '#{type}','via': '#{via}','url': '#{buzz_id}','blurb': '#{blurb}' ,'icon': ' &#xf099;'});\" />						</li>						<li class=\"share_email\">							<a class=\"bm-tool-track\" target=\"_self\" href=\"mailto:?subject=#{blurb}&body=#{emailbody}\"><i class = \"fa\" > &#xf003;</i></a>						</li>						<li class=\"share_pinterest\"><img src=\"#{share_gif}\" onload=\"sharing.buttons.pinterest({'replace': this,'type': 'longform', 'icon': ' &#xf0d2;'});\" />						</li>						<li class=\"share_google\"><img src=\"#{share_gif}\" onload=\"sharing.buttons.googleplus({'replace': this,'url': '#{share_url}',  'icon': ' &#xf0d5;' });\" />						</li>					</ul>				</div>",share_gif:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",bookmark_spinner:'<div id="bookmark_overlay"><div class="bookmarks-loader-content">Syncing bookmarks...</div><div class="bookmark-loader loader-6"></div></div>',bookmark_popup_container:'<div class="bookmark-white-overlay" style="display: none;"><div id="bookmark-popup" style="display: none;"><a href="javascript:;" class="bookmark-popup-close bf_dom fa fa-times" rel:bf_bucket="close_bookmark_popup" ></a><div class="bookmark-popup-content"></div></div></div>',bookmark_popups:{saved:'<div class="bmkp-title">'+local.t("Bookmark saved!")+'</div><div class="bmkp-content">'+local.t("Your bookmarked stories are saved to your")+' <a class="bookmark-acc-link">'+local.t("BuzzFeed account")+'</a>.</div><div id="bookmarks-promo"><a href="/tools/mobile-ios">'+local.t("Download")+"</a> "+local.t("the Buzzfeed app for<br />iOS or Android and sign in to<br />access your bookmarks on the go!")+"</div>",login:'<div class="bmkp-title">'+local.t("See your bookmarks from anywhere!")+'</div>							<div class="bmkp-content bkm-account"><div class="bmkp-icon"></div><div class="bmkp-text">'+local.t("Bookmarked stories are saved to your BuzzFeed account")+'</div></div>							<div class="bmkp-content bml-app"><div class="bmkp-icon"></div><div class="bmkp-text">'+local.t("Save them for later or view them on<br />the go with the BuzzFeed app.")+'<a href="/tools/mobile-ios" class="bf_dom" rel:gt_cat="MobileBuzzBookmark:pop-up" rel:gt_act="app-promo" >'+local.t("Download the app!")+'</a></div></div>							<div class="bmkp-content bkm-share">							<a rel:gt_act="initial-fb-sign-header" rel:bf_bucket="signin_with_facebook" class="fb-button bf_dom" href="javascript:;"><div class="fb-icon fa fa-facebook"></div><div class="fb-label" id="initial_fb_text">'+local.t("Sign in with Facebook")+'</div></a>              <a rel:gt_act="googleplus-signin-header" rel:bf_bucket="gplus_login" class="bf-gplus-button bf_dom"><span id="g-signin-button"></span><div class="gplus-icon fa fa-google-plus"></div><div class="gplus-label" id="initial_gplus_text">'+local.t("Sign in with Google")+'</div></a>              </div>              <div class="bmkp-content bkm-another-signin"><a id="bookmark-more-signin" class="bf_dom"rel:bf_bucket="bookmark_more_signin">'+local.t("More Sign In Options")+"</a></div>"}};this.init=function(){if(document.location.href.match("/_draft/")||document.location.href.match("/_buzz_preview")){return false}this.initHandlers();this.build()};this.initHandlers=function(){universal_dom.assign_handler({bucket:"add_bookmark",event:"click",handler:this.addBookmark.bind(this)});universal_dom.assign_handler({bucket:"close_bookmark_popup",event:"click",handler:this.closePopup.bind(this)});universal_dom.assign_handler({bucket:"gplus_login",event:"click",handler:this.gPlusLogin.bind(this)});universal_dom.assign_handler({bucket:"bookmark_more_signin",event:"click",handler:this.openMoreSignIn.bind(this)});universal_dom.assign_handler({bucket:"delete_bookmark_confirm",event:"click",handler:this.deleteBookmarkConfirm.bind(this)});universal_dom.assign_handler({bucket:"cancel_delete_bookmark",event:"click",handler:this.cancelDeleteBookmark.bind(this)});universal_dom.assign_handler({bucket:"delete_bookmark",event:"click",handler:this.deleteBookmark.bind(this)});universal_dom.assign_handler({bucket:"share_bookmark",event:"click",handler:this.shareBookmark.bind(this)});universal_dom.assign_handler({bucket:"hide_bookmark_promo",event:"click",handler:this.hideBookmarkPromo.bind(this)});universal_dom.assign_handler({bucket:"signin_with_facebook",event:"click",handler:this.onFacebookSignIn.bind(this)})};this.build=function(){this.user=new BF_User();var c=store.get("bookmark_data");if(!c){c=this.defaultData(0)}if(this.user.isLoggedIn()&&c.userId!==this.user.getUserInfo().userid&&c.userId||!this.user.isLoggedIn()){c=this.defaultData(this.user.getUserInfo().userid)}this.setBookmarkUserData(c);if(BF_STATIC.tt_page=="User"&&document.location.pathname.match(/\/bookmarks/)){if(this.user.isLoggedIn()&&document.location.pathname.match(this.user.getUserInfo().username)){if(this.bookmarksData.showPromo){$("bookmarks-promo").show()}this.showUserBookmarks()}else{$("bookmark_overlay").hide();$("bookmarks-unauthorized").show();$("bookmarks-container").hide()}}else{if(BF_STATIC.tt_page=="Buzz"){for(var b=0;b<$$("header div.square_shares").length;b++){if(!$$("header div.square_shares")[b].hasClassName("hidden")){$$("header div.square_shares")[b].addClassName("shown")}}this.showPostBookmarkButton("header div.square_shares.shown > .horizontal-share-buttons",false);if($("inline_shares_box")){this.showPostBookmarkButton("#inline_shares_box .social_share_icons_list",true)}}else{if(BF_STATIC.tt_page=="Videos"){this.showPostBookmarkButton(".video-splash-share .bottom-share-buttons",false)}}}if((typeof $$(".rerank_cta")[0]!="undefined"||!$$(".rerank_cta")[0].hasClassName("hidden"))&&this.container.select(".bookmark-tooltip").length&&this.container.select(".bookmark-tooltip")[0].visible()){this.hideTooltips()}Event.observe($$(".video-splash-share .bookmark_share a")[0],"click",function(){a.addBookmark()});Event.observe($$("#bookmark-popup .bookmark-popup-close")[0],"click",function(){a.closePopup()});Event.observe($$("#bookmark-popup .fb-button")[0],"click",function(){a.onFacebookSignIn()})};this.showPostBookmarkButton=function(b,e){if(!$$(b).length){return}$$("body")[0].insert(this.templates.bookmark_popup_container);this.container=$$(b)[0];var d=this.container.select(".clear");if(!d.length){return}var c=this.templates.post_button;if(e){c='<li class="'+this.bookmarkContainerClass+'">'+c+"</li>"}else{c='<div class="'+this.bookmarkContainerClass+'">'+c+"</div>"}d[0].insert({before:c});if(this.user.isLoggedIn()&&this.bookmarksData.addAfterLogin&&this.bookmarksData.addAfterLogin==BF_STATIC.campaignid){this.addBookmark(this.bookmarksData.addAfterLogin)}else{this.showTooltips("start")}universal_dom.update($s(".bookmark_share a.shareBtn"))};this.gPlusLogin=function(){if(typeof(gapi)!=undefined&&typeof(gapi.auth)!=undefined){a.initializedGoogleCallback=false;var b={clientid:BF_STATIC.google_plus_client_id,redirecturi:"postmessage",accesstype:"offline",cookiepolicy:"single_host_origin",callback:a.onGoogleSignIn,apppackagename:"com.buzzfeed.android"};gapi.auth.signIn(b)}};this.defaultData=function(b){return{userId:b,bookmarks:{},showPromo:true,hasBookmarks:false,addAfterLogin:0,sync_id:0}};this.openPopup=function(d){var b=$$("#bookmark-popup .bookmark-popup-content");if(!b.length){return false}b[0].innerHTML=this.templates.bookmark_popups[d];universal_dom.update($$(".bookmark-popup-close")[0]);$("bookmark-popup").className="";$("bookmark-popup").addClassName(d);$("bookmark-popup").show();$s(".bookmark-white-overlay").show();if(d==="login"){signin.wrap=$("bookmark-popup");signin.signin_page=false;universal_dom.update(b[0]);if(BF_STATIC.tt_page=="Videos"||BF_STATIC.language!=="en"){$s("#bookmark-popup .bf-gplus-button").hide();if(BF_STATIC.tt_page=="Videos"){$("bookmark-popup").addClassName("video-bookmark")}}}else{var c=BF_STATIC.web_root+"/bookmarks/"+this.user.getUserInfo().username;$s(".bookmark-acc-link").setAttribute("href",c)}};this.closePopup=function(b){$("bookmark-popup").hide();if(typeof b!=="boolean"||!b){$s(".bookmark-white-overlay").hide()}this.removeSpinner()};this.openMoreSignIn=function(){var b={};b.signin_type="initial";b.location="header";b.keydown_disabled=true;b.mousedown_disabled=true;b.close_disabled=true;b.bookmark_overlay=true;signin.open(b);this.closePopup(true)};this.setBookmarkUserData=function(c){var d=false,b;for(b in c){if(c[b]!==this.bookmarksData[b]){this.bookmarksData[b]=c[b];d=true}}if(d){store.set("bookmark_data",this.bookmarksData)}};this.showUserBookmarks=function(){new Ajax.Request(this.ajaxUrl,{method:"get",parameters:{sync_id:a.bookmarksData.sync_id},onComplete:function(c){if(c.status===304){a.drawBookmarkList(a.bookmarksData.bookmarks)}else{var b=c.responseText.evalJSON();if(b.success){a.setBookmarkUserData({bookmarks:b.bookmarks,sync_id:b.sync_id});a.drawBookmarkList(b.bookmarks)}else{console.error("added ajax error",b.error)}}}})};this.drawBookmarkList=function(g){if(g.length){$("bookmarks-count").innerHTML=g.length;var f=document.createElement("ul");f.className="flow bookmarks_list bf_dom";f.id="bookmarks_list";var e=new Template(a.templates.bookmark_item);var j=new Template(a.templates.bookmark_share);for(var d=0;d<g.length;d++){var c=g[d];var b=document.createElement("li");b.id="post-"+c.buzz_id;b.className="post bf_dom";b.setAttribute("rel:buzz_id",c.buzz_id);c.ago=this.getDateAgo(c.date_added);b.setAttribute("rel:ptool","true");b.setAttribute("rel:bf_bucket","post");if(c.image==null){c.image="/static/images/public/backgrounds/trans.gif"}var h={share_gif:a.templates.share_gif,type:"longform",buzz_id:c.buzz_id,via:"buzzfeed",blurb:c.title.replaceAll('"',"%22").replaceAll("&#39;","%27").replaceAll("&%2339;","%27").replaceAll("'","%27").replaceAll("&amp;","&#38;"),share_url:"http://"+document.domain+BF_STATIC.web_root+"/"+c.username+"/"+c.uri};h.emailbody=encodeURIComponent("Hey, I saw this on BuzzFeed and thought of you.")+"%0D%0A %0D%0A"+encodeURIComponent(h.share_url);b.innerHTML=e.evaluate(c)+this.templates.bmtools;b.select(".bmtools")[0].insert(j.evaluate(h));f.appendChild(b)}$("bookmarks-container").update(f);a.prepareTools()}else{$("bookmarks-count").innerHTML="0";$("bookmarks-container").insert('<div class="default-text">You don\'t have bookmarks yet</div>')}$("bookmark_overlay").hide()};this.getDateAgo=function(d){var c=new Date(0);c.setUTCSeconds(d);var e=Math.floor((new Date()-c)/1000);var b=Math.floor(e/31536000);if(b>=1){return b+" year"+(b>1?"s":"")}b=Math.floor(e/2592000);if(b>=1){return b+" month"+(b>1?"s":"")}b=Math.floor(e/86400);if(b>=1){return b+" day"+(b>1?"s":"")}b=Math.floor(e/3600);if(b>=1){return b+" hour"+(b>1?"s":"")}b=Math.floor(e/60);if(b>=1){return b+" minute"+(b>1?"s":"")}return Math.floor(e)+" seconds"};this.hideTooltips=function(){var b=this.container.select(".bookmark-tooltip");if(!b.length){return}b[0].hide()};this.showTooltips=function(c){var d=this.container.select(".bookmark-tooltip");if(!d.length){return false}d=d[0];d.innerHTML="";if(c=="start"){if(new Date(2014,8,15)>new Date()&&!this.bookmarksData.hasBookmarks){d.insert(this.templates.tooltips.new_tooltip);if(this.container.getAttribute("class")!=="social_share_icons_list"){d.show()}}}if(c=="bookmarked"){d.insert(this.templates.tooltips.bookmarked_tooltip);d.addClassName("bookmarked");d.removeClassName("standart-bookmarked");if(this.bookmarksData.hasBookmarks){this.container.select(".bookmark-tooltip .view-bookmarks")[0].hide();d.addClassName("standart-bookmarked")}else{var b=BF_STATIC.web_root+"/bookmarks/"+this.user.getUserInfo().username;this.container.select(".bookmark-tooltip .view-bookmarks")[0].setAttribute("href",b)}d.show()}};this.onFacebookSignIn=function(){this.spinner();bf_login.loggedInCallbacks.push(function(){a.removeSpinner();if(signin.spin_el){signin.spin_el.hide()}});facebook.FB_login(false,this.removeSpinner.bind(this))};this.onGoogleSignIn=function(b){if(!a.initializedGoogleCallback){a.spinner()}if(!b.status["signed_in"]){a.removeSpinner();a.closePopup();return}else{if(b.status["signed_in"]&&!a.initializedGoogleCallback){new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:{googleplus:"1",otc:b.code},onSuccess:function(c){a.removeSpinner();gplus._result(c);a.closePopup()},onFailure:function(c){a.removeSpinner();return}})}}a.initializedGoogleCallback=true};this.spinner=function(){signin.spinner()};this.removeSpinner=function(){if(signin.spin_el){signin.spin_el.hide()}};this.addBookmark=function(d){this.hideTooltips();if(this.user.isLoggedIn()){var c=0;if(BF_STATIC.tt_page=="Videos"){c=videopromo.buzz_id}else{c=BF_STATIC.campaignid}if(!c){console.error("add error - wrong buzz_id");return false}if(d&&typeof d!=="object"){c=d}else{if(d&&typeof d==="object"){var b=d.target.up("div").up();if(b!==this.container){this.container=b}}}new Ajax.Request(this.ajaxUrl,{method:"post",parameters:{buzz_id:c},onComplete:function(f){var e=f.responseText.evalJSON();if(e.success){if(a.maxBookmarkCount-e.bookmarks_remaining==1&&!a.bookmarksData.hasBookmarks){a.openPopup("saved")}a.showTooltips("bookmarked");a.setBookmarkUserData({hasBookmarks:true,addAfterLogin:0});a.container.down(".bookmark_share").addClassName("disabled")}else{console.error("added ajax error",e.error)}}})}else{a.setBookmarkUserData({addAfterLogin:BF_STATIC.campaignid});this.openPopup("login")}};this.shareBookmark=function(c){var b=Event.element(c);this.safeVisibilityToggle($(b).up(".bmtools").select(".bookmark-delete-confirm"),false);this.safeVisibilityToggle($(b).up("div").select(".bookmark-share-block"),true);return false};this.safeVisibilityToggle=function(b,c){if(!b.length){return false}if(c){b[0].show()}else{b[0].hide()}};this.hideBookmarkShare=function(b){$(b).hide()};this.hideBookmarkDeleteDialog=function(b){$(b).hide()};this.deleteBookmarkConfirm=function(c){var b=Event.element(c);this.safeVisibilityToggle($(b).up(".bmtools").select(".bookmark-delete-confirm"),true);this.safeVisibilityToggle($(b).up("div").select(".bookmark-share-block"),false);return false};this.cancelDeleteBookmark=function(c){var b=Event.element(c);this.safeVisibilityToggle($(b).up(".bmtools").select(".bookmark-delete-confirm"),false);return false};this.deleteBookmark=function(d){var c=Event.element(d);$(c).up(".bmtools").hide();var b=$(c).getAttribute("rel:buzz_id");if(!b){console.error("delete error - wrong buzz_id");return false}this.safeVisibilityToggle($(c).up(".bmtools").select(".bookmark-delete-confirm"),false);new Ajax.Request(this.ajaxUrl,{method:"post",parameters:{buzz_id:b,_method:"delete"},onComplete:function(f){var e=f.responseText.evalJSON();if(e.success){$("post-"+b).remove();$("bookmarks-count").innerHTML=$("bookmarks-count").innerHTML-1}else{console.error("delete ajax error",e.error)}}});return false};this.prepareTools=function(){var b=$$("#bookmarks_list > li");if(b.length){b.each(function(c){c.select(".bm-tool-track").each(function(d){d.setAttribute("rel:buzz_id",c.getAttribute("rel:buzz_id"));universal_dom.update(d)});c.select(".inlineShareBtn").each(function(d){universal_dom.update(d)});c.select(".shareBtn").each(function(d){universal_dom.update(d)})})}$$(".bookmark-delete-confirm").each(function(c){$(c).observe("mouseleave",function(){a.hideBookmarkDeleteDialog(c)})});$$(".bookmark-share-block").each(function(c){$(c).observe("mouseleave",function(){a.hideBookmarkShare(c)})})};this.hideBookmarkPromo=function(){$("bookmarks-promo").hide();this.setBookmarkUserData({showPromo:false})}};if(BF_STATIC.tt_page=="User"||BF_STATIC.tt_page=="Buzz"||BF_STATIC.tt_page=="Videos"){var bookmarks=new Bookmarks;BuzzLoader.register(bookmarks.init.bind(bookmarks),6)}var BF_share_bar_scroller=function(){var a=this,b;this.showShareBar=function(){if(!b||draft_no_scroll){return}var c=$s(".square_shares:not(.hidden) .upper-share-buttons"),h=$s(".square_shares:not(.hidden) .bottom-share-buttons"),f=document.viewport.getScrollOffsets().top,d=f+BF_UTIL.browser.dimensions.height(),g=c.cumulativeOffset().top+c.offsetHeight,e=h.cumulativeOffset().top;if(f>=g){if(d<=e){b.addClassName("social_share_icons_sticky_pos")}else{b.removeClassName("social_share_icons_sticky_pos")}}else{b.removeClassName("social_share_icons_sticky_pos")}};this.init=function(){b=$("inline_shares_box");a.showShareBar()}};var share_bar_scroller=new BF_share_bar_scroller();Event.observe(window,"scroll",share_bar_scroller.showShareBar);BuzzLoader.register(share_bar_scroller.init,5);BF_STICKING_RIGHTCOL=function(){this.init=function(){(function a(){if($$(".js-rightcol--sticking, .js-rightcol--control").length){if($$(".js-rightcol--sticking").length){this.el=$$(".js-rightcol--sticking")[0];Event.observe(window,"scroll",this.onScroll.bind(this));this.onScroll.call(this)}}else{setTimeout(a,200)}}).call(this)};this.onScroll=function(){var d=this.el.getHeight()+this.el.positionedOffset().top;var b=document.viewport.getScrollOffsets().top+document.viewport.getHeight();var c=b-d;if(c>150||parseInt(this.el.style.marginTop)>0){this.el.style.marginTop=(parseInt(this.el.style.marginTop)||0)+(c-150)+"px";if(parseInt(this.el.style.marginTop)<0){this.el.style.marginTop=0}}var a=$$(".bottom_shares, #social-actions, #preFacebookComment").last().positionedOffset().top;d=this.el.getHeight()+this.el.positionedOffset().top;c=a-d;if(d>a){this.el.style.marginTop=(parseInt(this.el.style.marginTop)||0)+c+"px"}}};var bf_sticking_rightcol=new BF_STICKING_RIGHTCOL();BuzzLoader.register(function(){bf_sticking_rightcol.init()},1);